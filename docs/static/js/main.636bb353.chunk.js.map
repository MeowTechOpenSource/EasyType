{"version":3,"sources":["view/Editor/index.module.css","view/Canvas/index.module.css","view/Notation/index.module.css","store/state.js","store/history.js","util/notation.js","util/paragraph.js","util/editor.js","util/version.js","util/placement.js","store/global.js","util/tone-convert.js","util/file.js","menu/editor.js","view/Canvas/index.js","view/ConfigModal/index.js","component/PopoverOnSvg/container.js","component/PopoverOnSvg/index.js","component/EditableContent/index.js","view/Row/index.js","util/html-escape.js","view/Text/index.js","view/Header/LeftInfoBlock/index.js","view/Header/RightInfoBlock/index.js","view/Header/Title/index.js","view/Header/PageNumber/index.js","view/Header/index.js","view/HelpModal/index.js","view/Header/LeftInfoBlock/custom.js","menu/paragraph.js","menu/notation.js","view/Notation/index.js","view/Paragraph/index.js","view/Editor/index.js","util/load-example.js","App.js","reportWebVitals.js","index.js","view/HelpModal/index.module.css","component/PopoverOnSvg/index.module.css","component/EditableContent/index.module.css"],"names":["module","exports","globalState","observable","selectedNotationKey","lastSelectedNotationKey","shouldNotationBlurAfterClick","tieSourceKey","helpDialogVisible","configDialogVisible","clipboardContent","storeHistory","cursor","_isEqual","objA","objB","cacheSet","Set","_isCommonObject","obj","Promise","Map","WeakMap","WeakSet","some","c","_deepEqual","obj1","obj2","has","add","keys1","Object","keys","keys2","length","every","key","go","span","newCursor","Math","min","max","assign","globalStore","executeAction","actionFunc","args","apply","this","current","toJS","splice","wrappedAction","name","func","realArgs","bind","undefined","shift","action","runInWrappedAction","runInAction","call","unwrappedAction","notations","notes","isNote","notationOrNote","includes","note","createNotation","initial","n","type","String","random","octave","dotted","underline","breakUnderline","prefixSups","topDecorators","tieTo","cloneNotation","notation","origin","JSON","parse","stringify","placeTie","state","findParagraphAndNotation","sourceNotation","sourceParagraph","paragraph","message","warn","createParagraph","p","alignJustify","createBeat","showndata","createParagraphWithNotations","N","initialData","version","canvasWidth","canvasHeight","defaultFontSize","defaultSubFontSize","title","tone","marginHorizontal","marginTop","gapAfterTitle","gapAfterHeader","gapBetweenParagraph","gapBetweenNotation","beat","speed","authors","showheaders","getDefaultGlobalData","getDefaultGlobalDataWidthNotations","d","paragraphs","res","store","i","notationIndex","findIndex","paragraphIndex","canvas","context2D","defaultFontFamily","measureSvgEl","measureTextEl","resetGlobalData","globalData","transaction","remove","GlobalContext","React","createContext","_calcTextWidth","fontSize","text","document","createElement","getContext","window","getComputedStyle","body","fontFamily","font","_initializeCanvas","measureText","width","_calcTextBox","createElementNS","style","visibility","appendChild","textContent","getBBox","_hasTie","nn","placement","maxContentWidth","minTieHeight","maxTieHeight","maxTieBezierOffset","underlineStepOffsetY","underlineInitialOffsetY","xHeight","octaveStepOffsetY","octaveInitialOffsetAbove","octaveInitialOffsetBelow","titleOffsetY","headerOffsetY","leftInfoBlockHeight","titleOffset","leftInfoBlockOffset","rightInfoBlockOffset","baseFontData","data","xWidth","height","baseSubFontData","subXHeight","subXWidth","calcTextWidth","calcSubTextWidth","calcParagraphContentHeight","noteHeightMap","map","octaveOffsetY","supOffsetY","offsets","noteOffsetTop","noteOffsetBottom","push","oc","underlineOffsetY","octaveInitialOffsetY","abs","octaveOffsetYAbove","topDecoratorOffset","maxOffsetY","minOffsetY","calcNotationHeight","aboveOffsetMap","calcNotationAboveOffset","belowOffsetMap","v","calcParagraphAboveOffset","reduce","prev","curr","calcNotationPrefixOffset","prefixes","join","octaveOffset","calcNotationWidth","noteWidth","noteToLevelMap","levelToNoteMap","bumpSharpToLevelMap","levelToBumpSharpMap","toneToLevelMap","C","D","E","F","G","A","B","convertTone","deltaVolume","forEach","trunc","newLevel","next","filter","unshift","convertToneTo","destTone","split","at","startsWith","read","file","resolve","reject","reader","FileReader","readAsText","onloadend","result","a","error","saveFile","Blob","downloadLink","download","href","URL","createObjectURL","click","revokeObjectURL","SubMenu","Menu","handleOpenFile","ev","loadFile","target","files","handleExportFile","domtoimage","toPng","getElementById","bgcolor","then","dataUrl","console","log","handleEditMenu","checked","Modal","info","content","Group","onChange","checkedValues","value","onOk","para","handleClick","handleKeyPress","inputKey","toLowerCase","shiftKey","ctrl","ctrlKey","navigator","userAgent","metaKey","indexOf","tieDesc","nextNotation","prevNotation","newNotation","nextParagraph","prevParagraph","currNotation","currParagraph","preventDefault","cloneParagraph","input","accept","onchange","fileMenu","Item","icon","PlusOutlined","onClick","FolderOpenOutlined","opacity","left","top","position","SaveOutlined","editMenu","UndoOutlined","RedoOutlined","MenuUnfoldOutlined","EyeOutlined","EyeInvisibleOutlined","HighlightOutlined","observer","children","props","id","xmlns","className","Styles","svg","onContextMenu","ImmediateNumberConfigInput","propertyName","handleChange","Number","ImmediateNumberConfigItem","label","ConfigModal","container","visible","onVisibleChange","handleClose","useCallback","resetConfig","onCancel","footer","labelAlign","labelCol","textAlign","borderLeft","borderRight","pointerEvents","placeholder","disabled","dirty","memoizedRect","x","y","getPopoverContainer","addEventListener","getContainerOffset","rect","getBoundingClientRect","PopoverOnSvg","renderContent","renderPopover","darkMode","globalClassName","offset","trigger","autoHide","showArrow","onVisibilityChange","triggerBoxRef","useRef","bottom","right","initFlagRef","triggerRef","popoverRef","useState","innerVisible","setInnerVisible","lastContextCord","setLastContextCord","forceUpdate","popoverClassNames","popover","Boolean","arrowClassNames","arrow","headerClassNames","header","offsetX","offsetY","mergedStyles","transform","arrowStyles","makeOffset","changeVisibility","shouldShow","newVisibility","setTimeout","handleContextMenu","pageX","pageY","useEffect","handler","parentElement","button","removeEventListener","box","test","minHeight","endsWith","ref","onMouseEnter","onMouseLeave","createPortal","defaultProps","memo","EditableContent","initialValue","inputType","options","overlay","popoverProps","inputValue","setInputValue","popoverVisible","setPopoverVisible","useImperativeHandle","showPopover","hidePopover","handleVisibilityChange","handleInput","handleConfirm","handleHideContextMenu","handleCancel","renderTextInputPopover","autoFocus","onPressEnter","buttonGroup","renderSelectionPopover","menu","op","option","menuItem","forwardRef","Row","editable","escapeHtml","createTextNode","innerHTML","replace","Text","dominantBaseline","stroke","fontWeight","fill","dangerouslySetInnerHTML","__html","tones","t","handleChangeTone","handleChangeSpeed","handleChangeBeat","parseInt","P","textAnchor","x1","y1","x2","y2","authorContextMenu","DeleteOutlined","index","blockContextMenu","handleSelectMenu","find","m","handleSelectBlockMenu","handleChangeAuthor","confirm","okText","cancelText","author","handleChangeTitle","handleChangePageNo","page","KeyboardDescItem","kbd","desc","listItem","HelpModal","list","tonedata","beatdata","speeddata","datas","toString","getParagraphMenuOptions","handleMenu","idx","EnterOutlined","danger","getNotationContextMenu","hasTie","separator","minWidth","mode","StopOutlined","RadiusSettingOutlined","Notation","underlineOffset","octaveInitialOffset","octaveStepOffset","selectedNotation","sups","s","slice","renderPrefixSups","renderNote","cx","cy","r","len","isInteger","Array","composeArray","widthCache","itemFlexOffset","realWidth","calcParagraphWidth","noteOffsets","_","accumulate","renderUnderLine","fromIndex","toIndex","renderParagraphMask","ties","offsetMap","j","get","set","bezierX1","bezierX2","bezierX4","bezierX3","bezierY","renderTie","renderTies","lines","helpMap","baseOffsetY","renderUnderlines","heightCache","handleChangeConfigModalVisibility","handleChangeHelpModalVisibility","headerWrapper","FileTextOutlined","EditOutlined","SettingOutlined","QuestionOutlined","InfoCircleOutlined","location","search","default","App","loadExample","Provider","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.636bb353.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"headerWrapper\":\"Editor_headerWrapper__3UcXJ\",\"header\":\"Editor_header__2OTLs\",\"container\":\"Editor_container__1osQd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"svg\":\"Canvas_svg__BAvnD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"selectedNotation\":\"Notation_selectedNotation__sXzY1\"};","import { observable } from \"mobx\";\r\n\r\n// 非持久化全局状态\r\nlet globalState = observable({\r\n  // 当前选中的符号\r\n  selectedNotationKey: null,\r\n  // 记录上次选中的符号，之后可恢复焦点\r\n  lastSelectedNotationKey: null,\r\n  // 当前点击事件是否应该让符号失去焦点。应该在符号自身和菜单等点击事件中将其置为false\r\n  shouldNotationBlurAfterClick: true,\r\n  // 正在操作的连音线起点\r\n  tieSourceKey: null,\r\n  // 帮助弹窗是否可见\r\n  helpDialogVisible: false,\r\n  // 配置项弹窗是否可见\r\n  configDialogVisible: false,\r\n  // 复制剪贴的内容\r\n  clipboardContent: null,\r\n});\r\n\r\nexport default globalState;\r\n","import { action, runInAction, toJS } from \"mobx\";\r\nimport globalStore from \"./global\";\r\n\r\nconst storeHistory = [];\r\nlet cursor = -1;\r\n\r\n// ENHANCE: 使用性能更好的方案\r\n// 比较历史记录\r\nfunction _isEqual(objA, objB) {\r\n  const cacheSet = new Set();\r\n  function _isCommonObject(obj) {\r\n    if (typeof obj !== \"object\" || obj === null) {\r\n      return false;\r\n    }\r\n    const unRegularConstructors = [Promise, Map, Set, WeakMap, WeakSet];\r\n    return !unRegularConstructors.some((c) => obj instanceof c);\r\n  }\r\n  function _deepEqual(obj1, obj2) {\r\n    if (!_isCommonObject(obj1) || !_isCommonObject(obj2)) {\r\n      return obj1 === obj2;\r\n    }\r\n    if (obj1 === obj2) {\r\n      return true;\r\n    }\r\n    if (cacheSet.has(obj1) || cacheSet.has(obj2)) {\r\n      return false;\r\n    }\r\n    cacheSet.add(obj1);\r\n    cacheSet.add(obj2);\r\n    const keys1 = Object.keys(obj1);\r\n    const keys2 = Object.keys(obj2);\r\n    if (keys1.length !== keys2.length) {\r\n      return false;\r\n    }\r\n    return keys1.every((key) => _deepEqual(obj1[key], obj2[key]));\r\n  }\r\n  return _deepEqual(objA, objB);\r\n}\r\n\r\n// 在历史记录中漫游\r\nfunction go(span) {\r\n  const newCursor = Math.min(\r\n    Math.max(0, cursor + span),\r\n    storeHistory.length - 1\r\n  );\r\n  if (newCursor === cursor) {\r\n    return;\r\n  }\r\n  cursor = newCursor;\r\n  Object.assign(globalStore, storeHistory[newCursor]);\r\n}\r\n\r\nfunction clearHistory() {\r\n  storeHistory.length = 0;\r\n  cursor = -1;\r\n}\r\n\r\n// 包装mobx的action以实现历史记录\r\nfunction executeAction(actionFunc, ...args) {\r\n  actionFunc.apply(this, args);\r\n  const current = toJS(globalStore);\r\n  if (!_isEqual(storeHistory[cursor], current)) {\r\n    storeHistory[++cursor] = current;\r\n    storeHistory.length = cursor + 1;\r\n    if (storeHistory.length > 256) {\r\n      storeHistory.splice(0, 256 - storeHistory.length);\r\n    }\r\n  }\r\n}\r\nfunction wrappedAction(...args) {\r\n  let name, func;\r\n  if (typeof args[0] === \"function\") {\r\n    func = args[0];\r\n  } else {\r\n    name = args[0];\r\n    func = args[1];\r\n  }\r\n  const realArgs = [name, executeAction.bind(this, func)];\r\n  if (name === undefined) {\r\n    realArgs.shift();\r\n  }\r\n  return action.apply(this, realArgs);\r\n}\r\nfunction runInWrappedAction(func) {\r\n  runInAction(() => {\r\n    executeAction.call(this, func);\r\n  });\r\n}\r\n\r\n// 不需要记录历史记录的时候直接使用原action\r\nconst unwrappedAction = action;\r\nconst runInUnwrappedAction = runInAction;\r\n\r\nexport {\r\n  go,\r\n  clearHistory,\r\n  wrappedAction,\r\n  runInWrappedAction,\r\n  unwrappedAction,\r\n  runInUnwrappedAction,\r\n};\r\n","import { message } from \"antd\";\r\nimport { toJS } from \"mobx\";\r\nimport state from \"../store/state\";\r\nimport { wrappedAction } from \"../store/history\";\r\nimport { findParagraphAndNotation } from \"./editor\";\r\n\r\nconst notations = {\r\n  zero: \"0\",\r\n  do: \"1\",\r\n  re: \"2\",\r\n  mi: \"3\",\r\n  fa: \"4\",\r\n  sol: \"5\",\r\n  la: \"6\",\r\n  si: \"7\",\r\n  extend: \"─\",\r\n  separator: \"│\",\r\n  crackerOpen: \"(\",\r\n  crackerClose: \")\",\r\n};\r\nconst notes = [\r\n  notations.zero,\r\n  notations.do,\r\n  notations.re,\r\n  notations.mi,\r\n  notations.fa,\r\n  notations.sol,\r\n  notations.la,\r\n  notations.si,\r\n];\r\nconst separators = [\"│\", \"‖\"];\r\n\r\nfunction isNote(notationOrNote) {\r\n  return notes.includes(notationOrNote?.note || notationOrNote);\r\n}\r\nfunction isPauseNote(notationOrNote) {\r\n  return notations.zero === (notationOrNote?.note || notationOrNote);\r\n}\r\nfunction isSeparator(notationOrNote) {\r\n  return separators.includes(notationOrNote?.note || notationOrNote);\r\n}\r\n// 创建符号\r\nfunction createNotation(initial) {\r\n  const n = {\r\n    type: \"notation\",\r\n    key: `n_${String(Math.random())}`,\r\n    note: \"0\",\r\n    octave: 0,\r\n    dotted: false,\r\n    underline: 0,\r\n    breakUnderline: false,\r\n    prefixSups: [],\r\n    topDecorators: [],\r\n    tieTo: null,\r\n  };\r\n  if (initial) {\r\n    Object.assign(n, initial);\r\n  }\r\n  return n;\r\n}\r\nfunction cloneNotation(notation) {\r\n  const origin = JSON.parse(JSON.stringify(toJS(notation)));\r\n  delete origin.key;\r\n  const n = createNotation(origin);\r\n  return n;\r\n}\r\n\r\n// 放置连音线\r\nconst placeTie = wrappedAction((notation) => {\r\n  if (state.tieSourceKey) {\r\n    // 处理连音线\r\n    if (state.tieSourceKey === notation.key) {\r\n      state.tieSourceKey = null;\r\n      // NOTICE: 如果要添加其他逻辑注意这里的return\r\n      return;\r\n    }\r\n    const {\r\n      notation: sourceNotation,\r\n      paragraph: sourceParagraph,\r\n    } = findParagraphAndNotation(state.tieSourceKey);\r\n    if (!sourceNotation) {\r\n      state.tieSourceKey = null;\r\n      return;\r\n    }\r\n    if (!sourceParagraph.notations.includes(notation)) {\r\n      message.warn(\"只允许相同段落的音符相连！\");\r\n    } else if (!isNote(notation)) {\r\n      message.warn(\"只允许在音符上添加连音线！\");\r\n    } else {\r\n      sourceNotation.tieTo = notation.key;\r\n      notation.tieTo = sourceNotation.key;\r\n    }\r\n    state.tieSourceKey = null;\r\n  }\r\n});\r\n\r\nexport {\r\n  notations,\r\n  isNote,\r\n  isPauseNote,\r\n  isSeparator,\r\n  createNotation,\r\n  cloneNotation,\r\n  placeTie,\r\n};\r\n","import { toJS } from \"mobx\";\r\nimport { cloneNotation, createNotation, notations as N } from \"./notation\";\r\nimport store from \"../store/global\";\r\n// 新建段落\r\nfunction createParagraph(initial) {\r\n  const p = {\r\n    type: \"paragraph\",\r\n    key: `p_${String(Math.random())}`,\r\n    // 符号列表\r\n    notations: [],\r\n    // 是否两端对齐\r\n    alignJustify: null,\r\n  };\r\n  if (initial) {\r\n    Object.assign(p, initial);\r\n  }\r\n  return p;\r\n}\r\nfunction createBeat(initial) {\r\n  const p = {\r\n    type: \"beatsp\",\r\n    key: `b_${String(Math.random())}`,\r\n    // 符号列表\r\n    notations: [],\r\n    showndata: [],\r\n    // 是否两端对齐\r\n    alignJustify: null,\r\n  };\r\n  if (initial) {\r\n    Object.assign(p, initial);\r\n  }\r\n  return p;\r\n}\r\nfunction createParagraphWithNotations() {\r\n  return createParagraph({\r\n    notations: [\r\n      createNotation({ note: \"0\" }),\r\n      createNotation({ note: \"0\" }),\r\n      createNotation({ note: \"0\" }),\r\n      createNotation({ note: \"0\" }),\r\n      createNotation({ note: N.separator }),\r\n    ],\r\n  });\r\n}\r\nfunction cloneParagraph(paragraph) {\r\n  const origin = JSON.parse(JSON.stringify(toJS(paragraph)));\r\n  delete origin.key;\r\n  origin.notations = paragraph.notations.map((n) => cloneNotation(n));\r\n  return createParagraph(origin);\r\n}\r\n\r\nexport { createParagraph, createParagraphWithNotations, cloneParagraph, createBeat };\r\n","import { remove, transaction } from \"mobx\";\r\nimport state from \"../store/state\";\r\nimport store from \"../store/global\";\r\nimport { clearHistory, unwrappedAction } from \"../store/history\";\r\nimport { createParagraphWithNotations } from \"../util/paragraph\";\r\nimport { VERSION } from \"./version\";\r\n\r\nconst initialData = {\r\n  version: VERSION,\r\n  canvasWidth: 896,\r\n  canvasHeight: 1024,\r\n  defaultFontSize: 16,\r\n  defaultSubFontSize: 12,\r\n  title: \"無標題\",\r\n  tone: \"C\",\r\n  marginHorizontal: 64,\r\n  marginTop: 32,\r\n  gapAfterTitle: 16,\r\n  gapAfterHeader: 32,\r\n  gapBetweenParagraph: 32,\r\n  gapBetweenNotation: 16,\r\n  beat: [4, 4],\r\n  speed: 75,\r\n  authors: [\"佚名 作詞\", \"EasyType 製譜\"],\r\n  notations: [],\r\n  showheaders:true\r\n};\r\n\r\nfunction getDefaultGlobalData() {\r\n  return JSON.parse(JSON.stringify(initialData));\r\n}\r\nfunction getDefaultGlobalDataWidthNotations() {\r\n  const d = getDefaultGlobalData();\r\n  d.paragraphs = [createParagraphWithNotations()];\r\n  return d;\r\n}\r\n\r\n// 根据key查找符号在全局记录中的位置\r\nfunction findParagraphAndNotation(key) {\r\n  let res = {};\r\n  const paras = store.paragraphs || [];\r\n  paras.some((p, i) => {\r\n    const notationIndex = (p.notations || []).findIndex((n) => n.key === key);\r\n    if (notationIndex !== -1) {\r\n      res.notation = p.notations[notationIndex];\r\n      res.notationIndex = notationIndex;\r\n      res.paragraph = p;\r\n      res.paragraphIndex = i;\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n  return res;\r\n}\r\n\r\nconst resetGlobalData = unwrappedAction((globalData) => {\r\n  if (!globalData) {\r\n    globalData = getDefaultGlobalDataWidthNotations();\r\n  }\r\n  state.lastSelectedNotationKey = state.selectedNotationKey = state.tieSourceKey = null;\r\n  clearHistory();\r\n  transaction(() => {\r\n    for (const key of Object.keys(store)) {\r\n      remove(store, key);\r\n    }\r\n    Object.assign(store, globalData);\r\n  });\r\n});\r\n\r\nexport {\r\n  getDefaultGlobalData,\r\n  findParagraphAndNotation,\r\n  getDefaultGlobalDataWidthNotations,\r\n  resetGlobalData,\r\n};\r\n","const VERSION = 3;\r\nconst VERSIONNAME = \"1.5.0\"\r\nexport { VERSION,VERSIONNAME };","import { observable } from \"mobx\";\r\nimport store from \"../store/global\";\r\n\r\n// ENHANCE: 通过mobx的computed机制缓存一些计算值\r\n\r\nlet canvas, context2D, defaultFontFamily;\r\nlet measureSvgEl, measureTextEl;\r\n\r\nfunction _initializeCanvas(fontSize) {\r\n  if (!canvas) {\r\n    canvas = document.createElement(\"canvas\");\r\n    context2D = canvas.getContext(\"2d\");\r\n    defaultFontFamily = window.getComputedStyle(document.body).fontFamily;\r\n  }\r\n  context2D.font = `${\r\n    fontSize || store.defaultFontSize\r\n  }px ${defaultFontFamily}`;\r\n}\r\n\r\nfunction _calcTextWidth(fontSize, text) {\r\n  _initializeCanvas(fontSize);\r\n  return context2D.measureText(text).width;\r\n}\r\n\r\nfunction _calcTextBox(fontSize, text) {\r\n  if (!measureSvgEl) {\r\n    measureSvgEl = document.createElementNS(\r\n      \"http://www.w3.org/2000/svg\",\r\n      \"svg\"\r\n    );\r\n    measureTextEl = document.createElementNS(\r\n      \"http://www.w3.org/2000/svg\",\r\n      \"text\"\r\n    );\r\n    measureTextEl.style.visibility = \"hidden\";\r\n    measureSvgEl.appendChild(measureTextEl);\r\n    document.body.appendChild(measureSvgEl);\r\n  }\r\n  measureTextEl.style.fontSize = fontSize + \"px\";\r\n  measureTextEl.textContent = text;\r\n  return measureTextEl.getBBox();\r\n}\r\n\r\n// 判断段落中的音符是否有连音线\r\nfunction _hasTie(paragraph) {\r\n  const notations = paragraph?.notations || [];\r\n  return notations.some(\r\n    (n, i) => n.tieTo && notations.findIndex((nn) => nn.key === n.tieTo) > i\r\n  );\r\n}\r\n\r\nconst placement = observable({\r\n  get maxContentWidth() {\r\n    return Math.max(store.canvasWidth - store.marginHorizontal * 2, 0);\r\n  },\r\n  get minTieHeight() {\r\n    return 8;\r\n  },\r\n  get maxTieHeight() {\r\n    return 20;\r\n  },\r\n  get maxTieBezierOffset() {\r\n    return 25;\r\n  },\r\n  get underlineStepOffsetY() {\r\n    return 3;\r\n  },\r\n  get underlineInitialOffsetY() {\r\n    return this.xHeight / 2 - 3;\r\n  },\r\n  get octaveStepOffsetY() {\r\n    return 5;\r\n  },\r\n  get octaveInitialOffsetAbove() {\r\n    return placement.xHeight / 2 + 2;\r\n  },\r\n  get octaveInitialOffsetBelow() {\r\n    return placement.xHeight / 2 - 2;\r\n  },\r\n  get titleOffsetY() {\r\n    const titleHeight = 32;\r\n    return store.marginTop + titleHeight + store.gapAfterTitle;\r\n  },\r\n  get headerOffsetY() {\r\n    const leftInfoBlockHeight = this.xHeight * 2;\r\n    const titleOffset = this.titleOffsetY;\r\n    const leftInfoBlockOffset = titleOffset + leftInfoBlockHeight;\r\n    const rightInfoBlockOffset =\r\n      titleOffset + this.xHeight * store.authors.length;\r\n    return (\r\n      Math.max(titleOffset, leftInfoBlockOffset, rightInfoBlockOffset) +\r\n      store.gapAfterHeader\r\n    );\r\n  },\r\n  get baseFontData() {\r\n    const data = _calcTextBox(store.defaultFontSize, \"x\");\r\n    return {\r\n      xWidth: data.width,\r\n      xHeight: data.height,\r\n    };\r\n  },\r\n  get baseSubFontData() {\r\n    const data = _calcTextBox(store.defaultSubFontSize, \"x\");\r\n    return {\r\n      xWidth: data.width,\r\n      xHeight: data.height,\r\n    };\r\n  },\r\n  get xHeight() {\r\n    return this.baseFontData.xHeight;\r\n  },\r\n  get xWidth() {\r\n    return this.baseFontData.xWidth;\r\n  },\r\n  get subXHeight() {\r\n    return this.baseSubFontData.xHeight;\r\n  },\r\n  get subXWidth() {\r\n    return this.baseSubFontData.xWidth;\r\n  },\r\n});\r\n\r\nconst calcTextWidth = _calcTextWidth.bind(null, store.defaultFontSize);\r\nconst calcSubTextWidth = _calcTextWidth.bind(null, store.defaultSubFontSize);\r\n\r\n// 计算段落占的空间高\r\nfunction calcParagraphHeight(paragraph) {\r\n  return calcParagraphContentHeight(paragraph) + store.gapBetweenParagraph;\r\n}\r\n// 计算段落内容的高度\r\nfunction calcParagraphContentHeight(paragraph) {\r\n  const notations = paragraph.notations || [];\r\n  if (notations.length === 0) {\r\n    return placement.xHeight;\r\n  }\r\n  let tieHeight = 0;\r\n  if (_hasTie(paragraph)) {\r\n    // FIXME: 应该计算连音线高度\r\n    // tieHeight = placement.maxTieHeight;\r\n  }\r\n  // 段落高度不是最高的音符的高度，而是上边偏移最大的音符的上部分偏移量+下边偏移最\r\n  // 大的音符的下部分偏移量\r\n  const noteHeightMap = notations.map((n) => calcNotationHeight(n));\r\n  const aboveOffsetMap = notations.map((n) => calcNotationAboveOffset(n));\r\n  const belowOffsetMap = noteHeightMap.map((v, i) => v - aboveOffsetMap[i]);\r\n  const maxNoteOffset =\r\n    Math.max(...belowOffsetMap) + Math.max(...aboveOffsetMap);\r\n  return tieHeight + maxNoteOffset;\r\n}\r\n\r\n// 计算一行中所有音符的宽度和\r\nfunction calcParagraphWidth(paragraph) {\r\n  const notations = paragraph.notations || [];\r\n  if (notations.length === 0) {\r\n    return 0;\r\n  }\r\n  return (\r\n    notations\r\n      .map((n) => calcNotationWidth(n))\r\n      .reduce((prev, curr) => prev + curr, 0) - store.gapBetweenNotation\r\n  );\r\n}\r\n\r\n// 计算段落中的音符中心以上偏移量的最大值\r\nfunction calcParagraphAboveOffset(paragraph) {\r\n  const notations = paragraph.notations || [];\r\n  if (notations.length === 0) {\r\n    return placement.xHeight / 2;\r\n  }\r\n  let tieHeight = 0;\r\n  if (_hasTie(paragraph)) {\r\n    // FIXME: 应该计算连音线高度\r\n    // tieHeight = placement.maxTieHeight;\r\n  }\r\n  const notationOffset = notations\r\n    .map((n) => calcNotationAboveOffset(n))\r\n    .reduce((prev, curr) => Math.max(prev, curr), placement.xHeight / 2);\r\n  return notationOffset + tieHeight;\r\n}\r\n\r\n// 计算音符中心位置左边的宽度\r\nfunction calcNotationPrefixOffset(notation) {\r\n  const prefixes = notation.prefixSups || [];\r\n  return calcSubTextWidth(prefixes.join(\"\")) + prefixes.length * 2;\r\n}\r\n\r\n// 计算音符中心位置以上的高度\r\nfunction calcNotationAboveOffset(notation) {\r\n  const offsets = [0];\r\n  const noteOffsetTop = placement.xHeight / 2;\r\n  offsets.push(noteOffsetTop);\r\n  let octaveOffset = 0;\r\n  if (notation.octave > 0) {\r\n    octaveOffset =\r\n      placement.octaveInitialOffsetAbove +\r\n      placement.octaveStepOffsetY * Math.abs(notation.octave);\r\n  }\r\n  offsets.push(octaveOffset);\r\n  const topDecoratorOffset =\r\n    octaveOffset +\r\n    placement.subXHeight * (notation.topDecorators?.length | 0) -\r\n    2;\r\n  offsets.push(topDecoratorOffset);\r\n  return Math.max(...offsets);\r\n}\r\n\r\n// 计算音符总体宽度\r\nfunction calcNotationWidth(notation) {\r\n  const noteWidth = calcTextWidth(notation.note) + store.gapBetweenNotation;\r\n  const dotWidth = 8;\r\n  const prefixWidth = calcNotationPrefixOffset(notation);\r\n  return prefixWidth + noteWidth + (notation.dotted ? dotWidth : 0);\r\n}\r\n\r\n// 计算音符自身高度，包含其装饰符，八度点等，不包括连音符\r\nfunction calcNotationHeight(notation) {\r\n  // 以音符中心为基准线，分别计算正方向和负方向的最大偏移，二者之和为音符自身高度\r\n  // 0保证取正方向偏移最值时不会取到负值，负方向亦然\r\n  const offsets = [0];\r\n  let noteOffsetTop = placement.xHeight / 2,\r\n    noteOffsetBottom = -placement.xHeight / 2,\r\n    octaveOffsetY,\r\n    supOffsetY;\r\n  offsets.push(noteOffsetTop, noteOffsetBottom);\r\n  const oc = notation.octave | 0;\r\n  const underlineOffsetY =\r\n    notation.underline > 0\r\n      ? placement.underlineInitialOffsetY +\r\n        placement.underlineStepOffsetY * (notation.underline | 0)\r\n      : 0;\r\n  offsets.push(underlineOffsetY);\r\n  const octaveInitialOffsetY =\r\n    notation.octave > 0\r\n      ? -placement.octaveInitialOffsetAbove\r\n      : placement.octaveInitialOffsetBelow + underlineOffsetY;\r\n  if (oc > 0) {\r\n    octaveOffsetY = octaveInitialOffsetY - 5 * Math.abs(oc);\r\n  } else if (oc < 0) {\r\n    octaveOffsetY = octaveInitialOffsetY + 5 * Math.abs(oc);\r\n  } else {\r\n    octaveOffsetY = 0;\r\n  }\r\n  offsets.push(octaveOffsetY);\r\n  // 前置上标的top偏移，其定位基准为字符中心，y位置为(-P.subXHeight + 4)，再\r\n  // 加上基准以上的半个字符的高度，得到前置上标的最大纵向偏移\r\n  supOffsetY = notation.prefixSups?.length ? placement.subXHeight - 4 : 0;\r\n  offsets.push(supOffsetY);\r\n  // 顶部装饰符在高八度点之上\r\n  let octaveOffsetYAbove = 0;\r\n  if (notation.octave > 0) {\r\n    octaveOffsetYAbove =\r\n      placement.octaveInitialOffsetAbove -\r\n      placement.octaveStepOffsetY * notation.octave;\r\n  }\r\n  const topDecoratorOffset =\r\n    octaveOffsetYAbove -\r\n    placement.subXHeight * (notation.topDecorators?.length | 0) -\r\n    2;\r\n  offsets.push(topDecoratorOffset);\r\n  const maxOffsetY = Math.max(...offsets);\r\n  const minOffsetY = Math.min(...offsets);\r\n  return maxOffsetY - minOffsetY;\r\n}\r\n\r\nexport default placement;\r\nexport {\r\n  calcNotationWidth,\r\n  calcNotationPrefixOffset,\r\n  calcNotationAboveOffset,\r\n  calcParagraphWidth,\r\n  calcParagraphHeight,\r\n  calcParagraphContentHeight,\r\n  calcParagraphAboveOffset,\r\n  calcTextWidth,\r\n  calcSubTextWidth,\r\n};\r\n","import React from \"react\";\r\nimport { observable } from \"mobx\";\r\nimport { getDefaultGlobalDataWidthNotations } from \"../util/editor\";\r\n\r\n// 全局数据及配置，需要持久化\r\nconst globalStore = observable(getDefaultGlobalDataWidthNotations());\r\n\r\nconst GlobalContext = React.createContext(globalStore);\r\n\r\nexport default globalStore;\r\nexport { GlobalContext };\r\n","import store from \"../store/global\";\r\nimport { wrappedAction } from \"../store/history\";\r\nimport { isNote, isPauseNote } from \"./notation\";\r\n\r\n// 音符到音数\r\nconst noteToLevelMap = {\r\n  1: 0,\r\n  2: 2,\r\n  3: 4,\r\n  4: 5,\r\n  5: 7,\r\n  6: 9,\r\n  7: 11,\r\n};\r\n// 音数到音符\r\nconst levelToNoteMap = {\r\n  0: 1,\r\n  1: 1,\r\n  2: 2,\r\n  3: 2,\r\n  4: 3,\r\n  5: 4,\r\n  6: 4,\r\n  7: 5,\r\n  8: 5,\r\n  9: 6,\r\n  10: 7,\r\n  11: 7,\r\n};\r\n// 升降到音数\r\nconst bumpSharpToLevelMap = {\r\n  \"♭\": -1,\r\n  \"♯\": 1,\r\n};\r\n// 音数到升降\r\nconst levelToBumpSharpMap = {\r\n  1: \"♯\",\r\n  3: \"♯\",\r\n  6: \"♯\",\r\n  8: \"♯\",\r\n  10: \"♭\",\r\n};\r\n\r\nconst toneToLevelMap = {\r\n  C: 0,\r\n  D: 2,\r\n  E: 4,\r\n  F: 5,\r\n  G: 7,\r\n  A: 9,\r\n  B: 11,\r\n};\r\n\r\n/**\r\n * 整体转调\r\n * @param {number} deltaVolume 要调整的音数\r\n */\r\nconst convertTone = wrappedAction(function (deltaVolume) {\r\n  deltaVolume = deltaVolume | 0;\r\n  store.paragraphs.forEach((p) => {\r\n    p.notations.forEach((n) => {\r\n      if (isNote(n) && !isPauseNote(n)) {\r\n        n.octave += Math.trunc(deltaVolume / 12);\r\n        let newLevel =\r\n          noteToLevelMap[n.note] +\r\n          (deltaVolume % 12) +\r\n          (n.prefixSups || []).reduce(\r\n            (prev, next) => prev + (bumpSharpToLevelMap[next] | 0),\r\n            0\r\n          );\r\n        if (newLevel >= 12) {\r\n          n.octave += 1;\r\n          newLevel -= 12;\r\n        } else if (newLevel < 0) {\r\n          n.octave -= 1;\r\n          newLevel += 12;\r\n        }\r\n        n.note = String(levelToNoteMap[newLevel]);\r\n        n.prefixSups = (n.prefixSups || []).filter(\r\n          (c) => c !== \"♯\" && c !== \"♭\"\r\n        );\r\n        if (levelToBumpSharpMap[newLevel]) {\r\n          n.prefixSups.unshift(levelToBumpSharpMap[newLevel]);\r\n        }\r\n      }\r\n    });\r\n  });\r\n});\r\n\r\n// 转到1 = *\r\nconst convertToneTo = wrappedAction((destTone) => {\r\n  let deltaVolume = -(\r\n    toneToLevelMap[destTone.split(\"\").at(-1)] -\r\n    toneToLevelMap[store.tone.split(\"\").at(-1)]\r\n  );\r\n  if (destTone.startsWith(\"♭\") || store.tone.startsWith(\"♯\")) {\r\n    deltaVolume -= 1;\r\n  }\r\n  if (destTone.startsWith(\"♯\") || store.tone.startsWith(\"♭\")) {\r\n    deltaVolume += 1;\r\n  }\r\n  convertTone(deltaVolume);\r\n  store.tone = destTone;\r\n});\r\n\r\nexport { convertTone, convertToneTo };\r\n","import { message } from \"antd\";\r\nimport { toJS } from \"mobx\";\r\nimport store from \"../store/global\";\r\nimport domtoimage from \"dom-to-image-more\";\r\nimport { VERSION } from \"./version\";\r\nimport { resetGlobalData } from \"./editor\";\r\n\r\nfunction read(file) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsText(file, \"utf8\");\r\n    reader.onloadend = () => {\r\n      resolve(JSON.parse(reader.result));\r\n    };\r\n  });\r\n}\r\n\r\nasync function loadFile(file) {\r\n  const data = await read(file);\r\n  if (!(data.version <= VERSION)) {\r\n    message.error(\"不支持的文件格式，请使用最新版本\");\r\n    return;\r\n  }\r\n  resetGlobalData(data);\r\n}\r\n\r\nfunction saveFile() {\r\n  const data = new Blob([JSON.stringify(toJS(store))], {\r\n    type: \"application/json\",\r\n  });\r\n  const downloadLink = document.createElement(\"a\");\r\n  downloadLink.download = (store.title || \"未标题\") + \".json\";\r\n  downloadLink.href = URL.createObjectURL(data);\r\n  downloadLink.click();\r\n  URL.revokeObjectURL(downloadLink.href);\r\n}\r\n\r\nfunction exportFile() {\r\n  // console.log(document.getElementById('temp_svg'))\r\n  domtoimage.toPng(document.getElementById(\"svg-data\"),{ bgcolor: \"white\" })\r\n    .then(function (dataUrl) {\r\n      console.log(\"called\")\r\n      const downloadLink = document.createElement(\"a\");\r\n      downloadLink.download = (store.title || \"未标题\") + \".png\";\r\n      downloadLink.href = dataUrl;\r\n      downloadLink.click();\r\n    });\r\n\r\n\r\n}\r\n\r\nexport { saveFile, loadFile, exportFile };\r\n","import {\r\n  FolderOpenOutlined,\r\n  HighlightOutlined,\r\n  MenuUnfoldOutlined,\r\n  PlusOutlined,\r\n  RedoOutlined,\r\n  SaveOutlined,\r\n  UndoOutlined,\r\n  EyeFilled,\r\n  EyeInvisibleOutlined,\r\n  EyeOutlined\r\n} from \"@ant-design/icons\";\r\nimport { Menu, Modal, Radio, Checkbox } from \"antd\";\r\nimport state from \"../store/state\";\r\nimport store from \"../store/global\";\r\nimport {\r\n  cloneNotation,\r\n  createNotation,\r\n  isNote,\r\n  notations as N,\r\n  placeTie,\r\n} from \"../util/notation\";\r\nimport {\r\n  cloneParagraph,\r\n  createParagraph,\r\n  createBeat,\r\n  createParagraphWithNotations,\r\n} from \"../util/paragraph\";\r\nimport { convertTone, convertToneTo } from \"../util/tone-convert\";\r\nimport { exportFile, loadFile, saveFile } from \"../util/file\";\r\nimport { findParagraphAndNotation, resetGlobalData } from \"../util/editor\";\r\nimport {\r\n  go,\r\n  runInWrappedAction,\r\n  unwrappedAction,\r\n  wrappedAction,\r\n} from \"../store/history\";\r\n\r\nconst { SubMenu } = Menu;\r\n\r\nconst handleOpenFile = unwrappedAction((ev) => {\r\n  const file = ev.target.files[0];\r\n  loadFile(file);\r\n});\r\nconst handleSaveFile = () => {\r\n  saveFile();\r\n};\r\nconst handleExportFile = unwrappedAction(() => {\r\n  exportFile();\r\n  // Modal.success({\r\n  //   content: 'Export OK',\r\n  // });\r\n  // state.selectedNotationKey = null;\r\n  // console.log(\"123\")\r\n  // try{\r\n  //   exportFile();\r\n  // }\r\n  // catch (e){\r\n  //   console.log(e)\r\n  // }\r\n});\r\nconst handleCreate = () => {\r\n  resetGlobalData();\r\n};\r\nconst handleNewPage = () => {\r\n  //New page\r\n  console.log(\"New page added.\")\r\n}\r\nconst handleEditMenu = wrappedAction(({ key }) => {\r\n  switch (key) {\r\n    case \"undo\":\r\n      go(-1);\r\n      break;\r\n    case \"redo\":\r\n      go(1);\r\n      break;\r\n    case \"reset-title\":\r\n      runInWrappedAction(() => {\r\n        store.title = \"【歌曲名稱】\";\r\n      });\r\n      break;\r\n    case \"reset-authors\":\r\n      store.authors = [\r\n        \"【作曲者】  作曲\",\r\n        \"【填詞者】  填詞\",\r\n        \"【記譜者】  記譜\",\r\n      ];\r\n      break;\r\n    case \"show-header\": {\r\n      store.authors = [\r\n        \"【作曲者】  作曲\",\r\n        \"【填詞者】  填詞\",\r\n        \"【記譜者】  記譜\",\r\n      ];\r\n      store.showheaders = true;\r\n      break;\r\n    }\r\n    case \"del-header\": {\r\n      store.authors = []\r\n      store.showheaders = false;\r\n      break;\r\n    }\r\n    case \"add-paragraph\": {\r\n      store.paragraphs.push(createParagraphWithNotations());\r\n      break;\r\n    }\r\n    case \"add-beatcfg\": {\r\n      var checked = []\r\n      const onChange = (checkedValues) => {\r\n        checked = checkedValues;\r\n      };\r\n      Modal.info({\r\n        title: '添加滑音符號(BETA)',\r\n        content: (\r\n          <Checkbox.Group onChange={onChange}>\r\n            <Checkbox value={0}>調子</Checkbox>\r\n            <Checkbox value={1}>節拍</Checkbox>\r\n            <Checkbox value={2}>速度</Checkbox>\r\n          </Checkbox.Group>\r\n        ),\r\n        onOk() {\r\n          if (checked.length == 0) {\r\n            Modal.error({\r\n              title: '錯誤',\r\n              content: '沒有選擇滑音符號',\r\n            });\r\n          }\r\n          else {\r\n            const para = createParagraph({\r\n              notations: [\r\n                createBeat({ showndata: checked })\r\n              ],\r\n            });\r\n            store.paragraphs.push(para);\r\n          }\r\n        },\r\n      });\r\n\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n});\r\nconst handleConvertMenu = ({ key }) => {\r\n  switch (true) {\r\n    case key.startsWith(\"convertTo\"):\r\n      const destTone = key.split(\"-\", 2)[1];\r\n      convertToneTo(destTone);\r\n      break;\r\n    case key === \"convert-up\":\r\n      convertTone(2);\r\n      break;\r\n    case key === \"convert-down\":\r\n      convertTone(-2);\r\n      break;\r\n    case key === \"convert-up8\":\r\n      convertTone(12);\r\n      break;\r\n    case key === \"convert-down8\":\r\n      convertTone(-12);\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n};\r\n\r\n// 画布上的点击事件\r\nconst handleClick = wrappedAction((ev) => {\r\n  if (state.shouldNotationBlurAfterClick && state.selectedNotationKey) {\r\n    state.lastSelectedNotationKey = state.selectedNotationKey;\r\n    state.selectedNotationKey = null;\r\n  }\r\n  state.shouldNotationBlurAfterClick = true;\r\n});\r\nfunction macOS() {\r\n  return navigator.userAgent.includes(\"Mac OS X\");\r\n}\r\nconst handleKeyPress = wrappedAction((ev) => {\r\n  const inputKey = ev.key.toLowerCase();\r\n  const shift = ev.shiftKey;\r\n  var ctrl = ev.ctrlKey;\r\n  if (macOS()){\r\n    ctrl = ev.metaKey;\r\n  }\r\n  if (state.selectedNotationKey) {\r\n    // 仅选中符号时作用\r\n    if (state.helpDialogVisible || state.configDialogVisible) {\r\n      return;\r\n    }\r\n    const {\r\n      paragraph,\r\n      notation,\r\n      paragraphIndex,\r\n      notationIndex,\r\n    } = findParagraphAndNotation(state.selectedNotationKey);\r\n    if (!notation) {\r\n      return;\r\n    }\r\n    switch (true) {\r\n      case isNote(inputKey) && !ctrl && !shift:\r\n        notation.note = inputKey;\r\n        break;\r\n      case inputKey === \"(\" && !ctrl:\r\n        notation.note = N.crackerOpen;\r\n        break;\r\n      case inputKey === \")\" && !ctrl:\r\n        notation.note = N.crackerClose;\r\n        break;\r\n      case inputKey === \"-\" && !ctrl && !shift:\r\n        notation.note = N.extend;\r\n        break;\r\n      case inputKey === \"|\" && !ctrl:\r\n        notation.note = N.separator;\r\n        break;\r\n      case inputKey === \"u\" && !ctrl && !shift:\r\n        notation.underline += 1;\r\n        break;\r\n      case inputKey === \"u\" && !ctrl && shift:\r\n        notation.underline -= 1;\r\n        notation.underline = Math.max(0, notation.underline);\r\n        break;\r\n      case inputKey === \".\" && !ctrl && !shift:\r\n        notation.dotted = !notation.dotted;\r\n        break;\r\n      case inputKey === \"8\" && !ctrl && !shift:\r\n        notation.octave += 1;\r\n        break;\r\n      case inputKey === \"*\" && !ctrl:\r\n        notation.octave -= 1;\r\n        break;\r\n      case inputKey === \"#\" && !ctrl:\r\n        if (notation.prefixSups.indexOf(\"♯\") !== 0) {\r\n          if (notation.prefixSups[0] === \"♭\") {\r\n            notation.prefixSups.shift();\r\n          }\r\n          notation.prefixSups.unshift(\"♯\");\r\n        } else {\r\n          notation.prefixSups.shift();\r\n        }\r\n        break;\r\n      case inputKey === \"b\" && !ctrl && !shift: {\r\n        if (notation.prefixSups.indexOf(\"♭\") !== 0) {\r\n          if (notation.prefixSups[0] === \"♯\") {\r\n            notation.prefixSups.shift();\r\n          }\r\n          notation.prefixSups.unshift(\"♭\");\r\n        } else {\r\n          notation.prefixSups.shift();\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"a\" && !ctrl && !shift: {\r\n        if (!state.tieSourceKey) {\r\n          state.tieSourceKey = notation.key;\r\n        } else if (state.tieSourceKey === notation.key) {\r\n          state.tieSourceKey = null;\r\n        } else {\r\n          placeTie(notation);\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"a\" && !ctrl && shift: {\r\n        if (notation.tieTo) {\r\n          const { notation: tieDesc } = findParagraphAndNotation(\r\n            notation.tieTo\r\n          );\r\n          if (tieDesc) {\r\n            tieDesc.tieTo = null;\r\n          }\r\n          notation.tieTo = null;\r\n          break;\r\n        }\r\n      }\r\n      case inputKey === \"!\" && !ctrl: {\r\n        notation.breakUnderline = !notation.breakUnderline;\r\n        break;\r\n      }\r\n      case inputKey === \"~\" && !ctrl: {\r\n        if (notation.topDecorators.includes(\"~\")) {\r\n          notation.topDecorators.splice(notation.topDecorators.indexOf(\"~\"), 1);\r\n        } else {\r\n          notation.topDecorators.push(\"~\");\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"enter\" && !ctrl && !shift: {\r\n        if (paragraph.notations[notationIndex + 1]) {\r\n          state.selectedNotationKey =\r\n            paragraph.notations[notationIndex + 1].key;\r\n        } else {\r\n          const nextNotation = createNotation();\r\n          paragraph.notations.push(nextNotation);\r\n          state.selectedNotationKey = nextNotation.key;\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"l\" && !ctrl && !shift: {\r\n        const nextNotation =\r\n          paragraph.notations[notationIndex + 1] ||\r\n          store.paragraphs[paragraphIndex + 1].notations?.at(0);\r\n        if (nextNotation) {\r\n          state.selectedNotationKey = nextNotation.key;\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"enter\" && !ctrl && shift: {\r\n        if (paragraph.notations[notationIndex - 1]) {\r\n          state.selectedNotationKey =\r\n            paragraph.notations[notationIndex - 1].key;\r\n        }\r\n        break;\r\n      }\r\n\r\n      case inputKey === \"h\" && !ctrl && !shift: {\r\n        const prevNotation =\r\n          paragraph.notations[notationIndex - 1] ||\r\n          store.paragraphs[paragraphIndex - 1].notations?.at(-1);\r\n        if (prevNotation) {\r\n          state.selectedNotationKey = prevNotation.key;\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"enter\" && ctrl && !shift: {\r\n        const newNotation = createNotation();\r\n        if (\r\n          notationIndex === paragraph.notations.length - 1 &&\r\n          paragraphIndex === store.paragraphs.length - 1\r\n        ) {\r\n          // 在最后一个音符时ctrl+enter插入新段落并创建符号\r\n          store.paragraphs.push(createParagraph({ notations: [newNotation] }));\r\n          state.selectedNotationKey = store.paragraphs\r\n            .at(-1)\r\n            .notations.at(0).key;\r\n        } else {\r\n          paragraph.notations.splice(notationIndex + 1, 0, newNotation);\r\n          state.selectedNotationKey = newNotation.key;\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"j\" && !ctrl && !shift: {\r\n        const nextParagraph = store.paragraphs[paragraphIndex + 1];\r\n        if (nextParagraph?.notations?.length) {\r\n          const nextNotation =\r\n            nextParagraph.notations[notationIndex] ||\r\n            nextParagraph.notations.at(-1);\r\n          state.selectedNotationKey = nextNotation.key;\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"k\" && !ctrl && !shift: {\r\n        const prevParagraph = store.paragraphs[paragraphIndex - 1];\r\n        if (prevParagraph?.notations?.length) {\r\n          const prevNotation =\r\n            prevParagraph.notations[notationIndex] ||\r\n            prevParagraph.notations.at(-1);\r\n          state.selectedNotationKey = prevNotation.key;\r\n        }\r\n        break;\r\n      }\r\n      case inputKey === \"backspace\" && !ctrl && !shift:\r\n      case inputKey === \"delete\" && !ctrl && !shift: {\r\n        paragraph.notations.splice(notationIndex, 1);\r\n        const currNotation =\r\n          paragraph.notations[notationIndex] ||\r\n          paragraph.notations[notationIndex - 1];\r\n        state.selectedNotationKey = currNotation?.key;\r\n        break;\r\n      }\r\n      case inputKey === \"backspace\" && !ctrl && shift:\r\n      case inputKey === \"delete\" && !ctrl && shift: {\r\n        store.paragraphs.splice(paragraphIndex, 1);\r\n        const currParagraph =\r\n          store.paragraphs[paragraphIndex] || store.paragraphs.at(-1);\r\n        const currNotation =\r\n          currParagraph?.notations?.at(notationIndex) ||\r\n          currParagraph?.notations?.at(-1);\r\n        state.selectedNotationKey = currNotation?.key;\r\n        break;\r\n      }\r\n      case inputKey === \"=\" && !ctrl && !shift: {\r\n        if (typeof paragraph.alignJustify !== \"boolean\") {\r\n          paragraph.alignJustify = !(\r\n            paragraphIndex ===\r\n            store.paragraphs.length - 1\r\n          );\r\n        }\r\n        paragraph.alignJustify = !paragraph.alignJustify;\r\n        break;\r\n      }\r\n      case inputKey === \"c\" && ctrl && !shift: {\r\n        ev.preventDefault();\r\n        state.clipboardContent = notation;\r\n        break;\r\n      }\r\n      case inputKey === \"c\" && ctrl && shift: {\r\n        ev.preventDefault();\r\n        state.clipboardContent = paragraph;\r\n        break;\r\n      }\r\n      case inputKey === \"v\" && ctrl && !shift: {\r\n        ev.preventDefault();\r\n        if (state.clipboardContent) {\r\n          switch (state.clipboardContent.type) {\r\n            case \"notation\":\r\n              paragraph.notations.splice(\r\n                notationIndex + 1,\r\n                0,\r\n                cloneNotation(state.clipboardContent)\r\n              );\r\n              break;\r\n            case \"paragraph\":\r\n              store.paragraphs.splice(\r\n                paragraphIndex + 1,\r\n                0,\r\n                cloneParagraph(state.clipboardContent)\r\n              );\r\n              break;\r\n            default:\r\n              state.clipboardContent = null;\r\n          }\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n    }\r\n  } else {\r\n    // 仅未选中符号时\r\n    switch (true) {\r\n      case [\"h\", \"j\", \"k\", \"l\"].includes(inputKey): {\r\n        const { notation: n } = findParagraphAndNotation(\r\n          state.lastSelectedNotationKey\r\n        );\r\n        state.selectedNotationKey = (\r\n          n || store.paragraphs?.at(0)?.notations?.at(0)\r\n        )?.key;\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n  // 全局\r\n  switch (true) {\r\n    case inputKey === \"z\" && ctrl && !shift:\r\n      go(-1);\r\n      break;\r\n    case inputKey === \"y\" && ctrl && !shift:\r\n    case inputKey === \"z\" && ctrl && shift:\r\n      go(1);\r\n      break;\r\n    case inputKey === \"s\" && ctrl && !shift: {\r\n      ev.preventDefault();\r\n      saveFile();\r\n      break;\r\n    }\r\n    case inputKey === \"o\" && ctrl && !shift: {\r\n      ev.preventDefault();\r\n      const input = document.createElement(\"input\");\r\n      input.type = \"file\";\r\n      input.accept = \".json\";\r\n      input.onchange = handleOpenFile;\r\n      input.click();\r\n      break;\r\n    }\r\n    case inputKey === \"?\" && !ctrl: {\r\n      if (state.helpDialogVisible) {\r\n        state.helpDialogVisible = false;\r\n      } else {\r\n        state.configDialogVisible = false;\r\n        state.helpDialogVisible = true;\r\n      }\r\n      break;\r\n    }\r\n    case inputKey === \"b\" && !shift: {\r\n      const para = createParagraph({\r\n        notations: [\r\n          createBeat({})\r\n        ],\r\n      });\r\n      store.paragraphs.push(para);\r\n      break;\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n});\r\n\r\nconst fileMenu = (\r\n  <Menu>\r\n    <Menu.Item key=\"create\" icon={<PlusOutlined />} onClick={handleCreate}>\r\n      新增\r\n    </Menu.Item>\r\n    <Menu.Item key=\"open\" icon={<FolderOpenOutlined />}>\r\n      開啟\r\n      <input\r\n        onChange={handleOpenFile}\r\n        accept=\".json\"\r\n        type=\"file\"\r\n        title=\"\"\r\n        style={{\r\n          opacity: 0,\r\n          cursor: \"pointer\",\r\n          width: \"100%\",\r\n          left: 0,\r\n          top: 0,\r\n          height: \"100%\",\r\n          position: \"absolute\",\r\n        }}\r\n      />\r\n    </Menu.Item>\r\n    <Menu.Item key=\"save\" icon={<SaveOutlined />} onClick={handleSaveFile}>\r\n      儲存文件\r\n    </Menu.Item>\r\n    <Menu.Item key=\"export\" icon={<SaveOutlined />} onClick={handleExportFile}>\r\n      導出為圖片\r\n    </Menu.Item>\r\n  </Menu>\r\n);\r\nconst editMenu = (\r\n  <Menu onClick={handleEditMenu}>\r\n    <Menu.Item key=\"undo\" icon={<UndoOutlined />}>\r\n      復原\r\n    </Menu.Item>\r\n    <Menu.Item key=\"redo\" icon={<RedoOutlined />}>\r\n      重做\r\n    </Menu.Item>\r\n    <Menu.Item key=\"add-paragraph\" icon={<MenuUnfoldOutlined />}>\r\n      添加段落\r\n    </Menu.Item>\r\n    <Menu.Item key=\"add-beatcfg\" icon={<MenuUnfoldOutlined />}>\r\n      添加滑音符號 (BETA)\r\n    </Menu.Item>\r\n    <Menu.Item key=\"show-header\" icon={<EyeOutlined />}>\r\n      展示標題信息\r\n    </Menu.Item>\r\n    <Menu.Item key=\"del-header\" icon={<EyeInvisibleOutlined />}>\r\n      隱藏標題信息\r\n    </Menu.Item>\r\n    <Menu.Item key=\"reset-title\" icon={<HighlightOutlined />}>\r\n      重設歌曲名稱\r\n    </Menu.Item>\r\n    <Menu.Item key=\"reset-authors\" icon={<HighlightOutlined />}>\r\n      重設作者信息\r\n    </Menu.Item>\r\n  </Menu>\r\n);\r\n\r\nconst convertMenu = (\r\n  <Menu key=\"tone\" onClick={handleConvertMenu}>\r\n    <SubMenu key=\"convertTo\" title=\"转到...\">\r\n      <Menu.Item key=\"convertTo-C\">1 = C</Menu.Item>\r\n      <Menu.Item key=\"convertTo-D\">1 = D</Menu.Item>\r\n      <Menu.Item key=\"convertTo-E\">1 = E</Menu.Item>\r\n      <Menu.Item key=\"convertTo-F\">1 = F</Menu.Item>\r\n      <Menu.Item key=\"convertTo-G\">1 = G</Menu.Item>\r\n      <Menu.Item key=\"convertTo-A\">1 = A</Menu.Item>\r\n      <Menu.Item key=\"convertTo-B\">1 = B</Menu.Item>\r\n      <Menu.Item key=\"convertTo-♭D\">\r\n        1 = <sup>♭</sup>D\r\n      </Menu.Item>\r\n      <Menu.Item key=\"convertTo-♭E\">\r\n        1 = <sup>♭</sup>E\r\n      </Menu.Item>\r\n      <Menu.Item key=\"convertTo-♭G\">\r\n        1 = <sup>♭</sup>G\r\n      </Menu.Item>\r\n      <Menu.Item key=\"convertTo-♭A\">\r\n        1 = <sup>♭</sup>A\r\n      </Menu.Item>\r\n      <Menu.Item key=\"convertTo-♭B\">\r\n        1 = <sup>♭</sup>B\r\n      </Menu.Item>\r\n    </SubMenu>\r\n    <Menu.Item key=\"convert-up\">升高一个音</Menu.Item>\r\n    <Menu.Item key=\"convert-down\">降低一个音</Menu.Item>\r\n    <Menu.Item key=\"convert-up8\">升高一个八度</Menu.Item>\r\n    <Menu.Item key=\"convert-down8\">降低一个八度</Menu.Item>\r\n  </Menu>\r\n);\r\n\r\nexport { fileMenu, editMenu, convertMenu, handleKeyPress, handleClick };\r\n","import { observer } from \"mobx-react-lite\";\r\nimport store from \"../../store/global\";\r\nimport Styles from \"./index.module.css\";\r\n\r\n// ENHANCE: 增加整体缩放能力\r\n\r\n// FIXME: 修改获取svg元素的方式\r\nfunction Canvas({ children, ...props }) {\r\n  return (\r\n    <div id=\"svg-data\">\r\n      <svg\r\n        id=\"temp_svg\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        className={Styles.svg}\r\n        // viewBox={`0 0 ${store.canvasWidth} ${store.canvasHeight}`}\r\n        width={store.canvasWidth}\r\n        height={store.canvasHeight}\r\n        onContextMenu={(ev) => ev.preventDefault()}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </svg>\r\n    \r\n    </div>\r\n  );\r\n}\r\n\r\nexport default observer(Canvas);\r\n","import { Button, Form, Input, Modal } from \"antd\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { useCallback } from \"react\";\r\nimport store from \"../../store/global\";\r\nimport { getDefaultGlobalData } from \"../../util/editor\";\r\nimport { unwrappedAction } from \"../../store/history\";\r\n\r\nconst ImmediateNumberConfigInput = observer(({ propertyName, ...props }) => {\r\n  // ENHANCE: 防抖处理\r\n  const handleChange = unwrappedAction((ev) => {\r\n    const v = Number(ev.target.value) | 0;\r\n    store[propertyName] = v;\r\n  });\r\n  return (\r\n    <Input value={store[propertyName]} onChange={handleChange} {...props} />\r\n  );\r\n});\r\nfunction ImmediateNumberConfigItem({ propertyName, label, ...props }) {\r\n  return (\r\n    <Form.Item label={label} {...props}>\r\n      <ImmediateNumberConfigInput propertyName={propertyName} />\r\n    </Form.Item>\r\n  );\r\n}\r\n\r\nfunction ConfigModal({ visible, onVisibleChange }) {\r\n  const handleClose = useCallback(() => {\r\n    onVisibleChange?.call(null, false);\r\n  }, [onVisibleChange]);\r\n  const resetConfig = unwrappedAction(() => {\r\n    const {\r\n      canvasWidth,\r\n      canvasHeight,\r\n      marginTop,\r\n      marginHorizontal,\r\n      gapBetweenParagraph,\r\n      gapBetweenNotation,\r\n    } = getDefaultGlobalData();\r\n    Object.assign(store, {\r\n      canvasWidth,\r\n      canvasHeight,\r\n      marginTop,\r\n      marginHorizontal,\r\n      gapBetweenParagraph,\r\n      gapBetweenNotation,\r\n    });\r\n  });\r\n\r\n  return (\r\n    <Modal\r\n      style={{ top: 20 }}\r\n      visible={visible}\r\n      title=\"設置\"\r\n      onCancel={handleClose}\r\n      footer={[\r\n        <Button key=\"reset\" onClick={resetConfig}>\r\n          重置為默認設置\r\n        </Button>,\r\n        <Button key=\"close\" type=\"primary\" onClick={handleClose}>\r\n          關閉\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Form labelAlign=\"right\" labelCol={{ span: 4 }}>\r\n        <Form.Item label=\"畫布大小\">\r\n          <Input.Group>\r\n            <ImmediateNumberConfigInput\r\n              propertyName=\"canvasWidth\"\r\n              style={{ width: \"45%\", textAlign: \"center\" }}\r\n            />\r\n\r\n            <Input\r\n              className=\"site-input-split\"\r\n              style={{\r\n                width: \"10%\",\r\n                borderLeft: 0,\r\n                borderRight: 0,\r\n                textAlign: \"center\",\r\n                pointerEvents: \"none\",\r\n              }}\r\n              placeholder=\"x\"\r\n              disabled\r\n            />\r\n            <ImmediateNumberConfigInput\r\n              propertyName=\"canvasHeight\"\r\n              style={{ width: \"45%\", textAlign: \"center\" }}\r\n            />\r\n          </Input.Group>\r\n        </Form.Item>\r\n        <ImmediateNumberConfigItem label=\"頂部邊距\" propertyName=\"marginTop\" />\r\n        <ImmediateNumberConfigItem\r\n          label=\"左右邊距\"\r\n          propertyName=\"marginHorizontal\"\r\n        />\r\n        <ImmediateNumberConfigItem\r\n          label=\"段間距\"\r\n          propertyName=\"gapBetweenParagraph\"\r\n        />\r\n        <ImmediateNumberConfigItem\r\n          label=\"音符間距\"\r\n          propertyName=\"gapBetweenNotation\"\r\n        />\r\n      </Form>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nexport default ConfigModal;\r\n","let dirty = false;\r\nlet memoizedRect = { x: 0, y: 0 };\r\nlet container;\r\n\r\nfunction getPopoverContainer() {\r\n  if (!container) {\r\n    container = document.createElement(\"div\");\r\n    container.id = \"svg-popover-container\";\r\n    container.style = `\r\n      position: absolute;\r\n      left: 0;\r\n      top: 0;\r\n    `;\r\n    document.body.appendChild(container);\r\n    document.addEventListener(\"scroll\", () => void (dirty = true));\r\n  }\r\n  return container;\r\n}\r\n\r\nfunction getContainerOffset() {\r\n  if (dirty) {\r\n    const rect = getPopoverContainer().getBoundingClientRect();\r\n    memoizedRect = {\r\n      x: -rect.x,\r\n      y: -rect.y,\r\n    };\r\n    dirty = false;\r\n  }\r\n  return memoizedRect;\r\n}\r\n\r\nexport { getPopoverContainer, getContainerOffset };\r\n","import React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport Styles from \"./index.module.css\";\r\nimport { getContainerOffset, getPopoverContainer } from \"./container\";\r\n\r\n// ENHANCE: smart placement\r\nfunction PopoverOnSvg({\r\n  children,\r\n  renderContent,\r\n  renderPopover,\r\n  darkMode,\r\n  globalClassName,\r\n  offset,\r\n  placement,\r\n  style,\r\n  title,\r\n  trigger,\r\n  visible,\r\n  autoHide,\r\n  showArrow,\r\n  onVisibilityChange,\r\n}) {\r\n  const triggerBoxRef = useRef({\r\n    x: 0,\r\n    y: 0,\r\n    width: 0,\r\n    height: 0,\r\n    top: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    right: 0,\r\n  });\r\n  const initFlagRef = useRef(false);\r\n  const triggerRef = useRef();\r\n  const popoverRef = useRef();\r\n  // initially, always set innerVisible to false. If the prop *visible* is\r\n  // true, we'll update it after dom mounted, because we cannot calculate\r\n  // correct position of popover before react mounting it.\r\n  const [innerVisible, setInnerVisible] = useState(false);\r\n  const [lastContextCord, setLastContextCord] = useState({ x: 0, y: 0 });\r\n  const [, forceUpdate] = useState();\r\n  const popoverClassNames = [Styles.popover, globalClassName].filter(Boolean);\r\n  const arrowClassNames = [Styles.arrow];\r\n  const headerClassNames = [Styles.header];\r\n  let offsetX = (offset && offset.x) || 0;\r\n  let offsetY = (offset && offset.y) || 0;\r\n  let mergedStyles = {\r\n    transform: \"\",\r\n  };\r\n  const arrowStyles = {};\r\n  placement = placement.toLowerCase();\r\n\r\n  const makeOffset = function (x, y = 0) {\r\n    offsetX += x;\r\n    offsetY += y;\r\n  };\r\n  const changeVisibility = useCallback(\r\n    function (shouldShow) {\r\n      shouldShow = shouldShow ?? !innerVisible;\r\n      let newVisibility = visible === undefined ? shouldShow : visible;\r\n      if (newVisibility) {\r\n        if (!triggerRef.current) {\r\n          setTimeout(changeVisibility, 0);\r\n          return;\r\n        }\r\n        // re-get box of trigger element\r\n        triggerBoxRef.current = triggerRef.current.getBoundingClientRect();\r\n      }\r\n      setInnerVisible(newVisibility);\r\n      // FIXME: visible由false变为true时React Warning: Cannot update a component (`EditableContent`) while rendering a different component (`PopoverOnSvg`).\r\n      onVisibilityChange && onVisibilityChange(shouldShow);\r\n    },\r\n    [visible, innerVisible, onVisibilityChange]\r\n  );\r\n  const handleContextMenu = useCallback(\r\n    (ev) => {\r\n      setLastContextCord({ x: ev.pageX, y: ev.pageY });\r\n      ev.preventDefault();\r\n      changeVisibility(true);\r\n    },\r\n    [changeVisibility]\r\n  );\r\n  useEffect(() => {\r\n    initFlagRef.current = true;\r\n  }, []);\r\n  useEffect(() => {\r\n    if (autoHide === false) {\r\n      return;\r\n    }\r\n    const handler = (ev) => {\r\n      if (ev.type === \"keydown\" && ev.key === \"Escape\") {\r\n        changeVisibility(false);\r\n      } else if (ev.type === \"mouseup\") {\r\n        for (let target = ev.target; target; target = target.parentElement) {\r\n          if (target === popoverRef.current) {\r\n            return;\r\n          } else if (target === triggerRef.current) {\r\n            if (trigger === \"context\" && ev.button !== 2) {\r\n              continue;\r\n            } else if (trigger === \"click\" && ev.button !== 0) {\r\n              continue;\r\n            }\r\n            return;\r\n          }\r\n        }\r\n        changeVisibility(false);\r\n      }\r\n    };\r\n    if (innerVisible) {\r\n      document.addEventListener(\"mouseup\", handler);\r\n      document.addEventListener(\"keydown\", handler);\r\n    }\r\n    return () => {\r\n      document.removeEventListener(\"mouseup\", handler);\r\n      document.removeEventListener(\"keydown\", handler);\r\n    };\r\n  }, [innerVisible, autoHide, changeVisibility, trigger]);\r\n\r\n  if (visible !== undefined && visible !== innerVisible) {\r\n    if (initFlagRef.current) {\r\n      changeVisibility();\r\n    } else {\r\n      setTimeout(() => {\r\n        // this is the first-time render, trigger dom has not mounted, so we\r\n        // have to delay the rendering\r\n        forceUpdate([]);\r\n      }, 0);\r\n    }\r\n  }\r\n  if (trigger !== \"context\") {\r\n    const box = triggerBoxRef.current;\r\n    switch (true) {\r\n      case /^(left|right)(top|center|bottom)?$/i.test(placement):\r\n        mergedStyles.minHeight = \"32px\";\r\n        if (placement.startsWith(\"right\")) {\r\n          mergedStyles.left = box.right + \"px\";\r\n        } else {\r\n          mergedStyles.left = box.left + \"px\";\r\n          mergedStyles.transform += \" translate(-100%, 0)\";\r\n        }\r\n        if (placement.endsWith(\"top\")) {\r\n          mergedStyles.top = box.top + \"px\";\r\n          mergedStyles.transform += \" translate(0, 0)\";\r\n          arrowStyles.top = \"16px\";\r\n        } else if (placement.endsWith(\"bottom\")) {\r\n          mergedStyles.top = box.bottom + \"px\";\r\n          mergedStyles.transform += \" translate(0, -100%)\";\r\n          arrowStyles.bottom = \"0\";\r\n        } else {\r\n          mergedStyles.top = box.y + box.height / 2 + \"px\";\r\n          mergedStyles.transform += \" translate(0, -50%)\";\r\n          arrowStyles.top = \"50%\";\r\n        }\r\n        break;\r\n      case /^(top|bottom)(left|center|right)?$/i.test(placement):\r\n      default:\r\n        if (placement.startsWith(\"bottom\")) {\r\n          mergedStyles.top = box.bottom + \"px\";\r\n        } else {\r\n          mergedStyles.top = box.y + \"px\";\r\n          mergedStyles.transform += \" translate(0, -100%)\";\r\n        }\r\n        if (placement.endsWith(\"left\")) {\r\n          mergedStyles.left = box.left + \"px\";\r\n          arrowStyles.left = \"16px\";\r\n        } else if (placement.endsWith(\"right\")) {\r\n          mergedStyles.left = box.right + \"px\";\r\n          mergedStyles.transform += \" translate(-100%, 0)\";\r\n          arrowStyles.right = \"0\";\r\n        } else {\r\n          mergedStyles.left = box.right - box.width / 2 + \"px\";\r\n          mergedStyles.transform += \" translateX(0%)\";\r\n          arrowStyles.left = \"50%\";\r\n        }\r\n        break;\r\n    }\r\n    switch (true) {\r\n      case !showArrow:\r\n        break;\r\n      case placement.startsWith(\"left\"):\r\n        makeOffset(-8);\r\n        arrowClassNames.push(\"left\");\r\n        break;\r\n      case placement.startsWith(\"right\"):\r\n        makeOffset(8);\r\n        arrowClassNames.push(\"right\");\r\n        break;\r\n      case placement.startsWith(\"bottom\"):\r\n        makeOffset(0, 8);\r\n        arrowClassNames.push(\"bottom\");\r\n        break;\r\n      case placement.startsWith(\"top\"):\r\n      default:\r\n        makeOffset(0, -8);\r\n        arrowClassNames.push(\"top\");\r\n        break;\r\n    }\r\n    makeOffset(getContainerOffset().x, getContainerOffset().y);\r\n    mergedStyles.transform += ` translate(${offsetX}px, ${offsetY}px)`;\r\n  } else {\r\n    mergedStyles.left = lastContextCord.x;\r\n    mergedStyles.top = lastContextCord.y;\r\n    mergedStyles.transform = `translate(${offsetX}px, ${offsetY}px)`;\r\n  }\r\n  if (darkMode) {\r\n    popoverClassNames.push(\"dark\");\r\n    arrowClassNames.push(\"dark\");\r\n    headerClassNames.push(\"dark\");\r\n  }\r\n  mergedStyles = Object.assign(mergedStyles, style);\r\n  return (\r\n    <>\r\n      []\r\n      <g\r\n        type=\"noop\"\r\n        ref={triggerRef}\r\n        onClick={trigger === \"click\" ? () => changeVisibility() : undefined}\r\n        onMouseEnter={\r\n          trigger === \"hover\" ? () => changeVisibility(true) : undefined\r\n        }\r\n        onMouseLeave={\r\n          trigger === \"hover\" ? () => changeVisibility(false) : undefined\r\n        }\r\n        onContextMenu={trigger === \"context\" ? handleContextMenu : undefined}\r\n      >\r\n        {children}\r\n      </g>\r\n      \r\n      {innerVisible &&\r\n        createPortal(\r\n          <div\r\n            ref={popoverRef}\r\n            className={popoverClassNames.join(\" \")}\r\n            style={mergedStyles}\r\n          >\r\n            {renderPopover ? (\r\n              typeof renderPopover === \"function\" ? (\r\n                renderPopover()\r\n              ) : (\r\n                renderPopover\r\n              )\r\n            ) : (\r\n              <>\r\n                {showArrow && (\r\n                  <div\r\n                    className={arrowClassNames.join(\" \")}\r\n                    style={arrowStyles}\r\n                  ></div>\r\n                )}\r\n                {title && (\r\n                  <header className={headerClassNames.join(\" \")}>\r\n                    {title}\r\n                  </header>\r\n                )}\r\n                <div className={title ? Styles.content : null}>\r\n                  {typeof renderContent === \"function\"\r\n                    ? renderContent()\r\n                    : renderContent ?? null}\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>,\r\n          getPopoverContainer()\r\n        )}\r\n    </>\r\n  );\r\n}\r\n\r\nPopoverOnSvg.defaultProps = {\r\n  trigger: \"click\",\r\n  placement: \"top\",\r\n  showArrow: true,\r\n};\r\n\r\nexport default React.memo(PopoverOnSvg);\r\n","import React, { useCallback, useImperativeHandle, useState } from \"react\";\r\nimport { Button, Input, Menu } from \"antd\";\r\nimport PopoverOnSvg from \"../PopoverOnSvg\";\r\nimport Styles from \"./index.module.css\";\r\n\r\nconst EditableContent = function (\r\n  {\r\n    children,\r\n    title,\r\n    initialValue,\r\n    inputType,\r\n    // ENHANCE: 去除这个prop，使用overlay代替\r\n    options,\r\n    // 选择模式要渲染的菜单，如果没有提供则根据options生成\r\n    overlay,\r\n    onChange,\r\n    popoverProps,\r\n  },\r\n  ref\r\n) {\r\n  const [inputValue, setInputValue] = useState(initialValue);\r\n  const [popoverVisible, setPopoverVisible] = useState(false);\r\n  useImperativeHandle(\r\n    ref,\r\n    () => ({\r\n      showPopover: setPopoverVisible.bind(null, true),\r\n      hidePopover: setPopoverVisible.bind(null, false),\r\n    }),\r\n    []\r\n  );\r\n  const handleVisibilityChange = useCallback(\r\n    function (value) {\r\n      setPopoverVisible(value);\r\n      if (!value) {\r\n        setInputValue(initialValue);\r\n      }\r\n    },\r\n    [initialValue]\r\n  );\r\n  const handleInput = useCallback(function (ev) {\r\n    setInputValue(ev.target.value);\r\n  }, []);\r\n  const handleConfirm = useCallback(\r\n    async function (value) {\r\n      const v = value === undefined ? inputValue : value;\r\n      const success = await (onChange && onChange(v));\r\n      success !== false && setPopoverVisible(false);\r\n    },\r\n    [inputValue, onChange]\r\n  );\r\n  const handleHideContextMenu = useCallback(() => {\r\n    setPopoverVisible(false);\r\n  }, []);\r\n  const handleCancel = useCallback(\r\n    function () {\r\n      setInputValue(initialValue);\r\n      setPopoverVisible(false);\r\n    },\r\n    [initialValue]\r\n  );\r\n  const renderTextInputPopover = useCallback(\r\n    () => (\r\n      <>\r\n        <Input\r\n          autoFocus\r\n          value={inputValue}\r\n          onChange={handleInput}\r\n          onPressEnter={() => handleConfirm()}\r\n        />\r\n        <div className={Styles.buttonGroup}>\r\n          <Button\r\n            type=\"primary\"\r\n            className={Styles.button}\r\n            onClick={() => handleConfirm()}\r\n          >\r\n            確定\r\n          </Button>\r\n          <Button onClick={handleCancel}>取消</Button>\r\n        </div>\r\n      </>\r\n    ),\r\n    [inputValue, handleInput, handleConfirm, handleCancel]\r\n  );\r\n  const renderSelectionPopover = useCallback(() => {\r\n    if (overlay) {\r\n      return <div onClick={handleHideContextMenu}>{overlay}</div>;\r\n    }\r\n    return (\r\n      <Menu className={Styles.menu}>\r\n        {(options || [])\r\n          .filter((op) => op.visible !== false)\r\n          .map((option) => (\r\n            <Menu.Item\r\n              icon={option.icon}\r\n              key={option.key}\r\n              className={\r\n                Styles.menuItem +\r\n                (option.key === initialValue ? \" selected\" : \"\")\r\n              }\r\n              onClick={() => handleConfirm(option.key)}\r\n            >\r\n              {option.text}\r\n            </Menu.Item>\r\n          ))}\r\n      </Menu>\r\n    );\r\n  }, [initialValue, options, handleConfirm, handleHideContextMenu, overlay]);\r\n  let renderContent, renderPopover;\r\n  switch (inputType) {\r\n    case \"select\":\r\n      renderContent = renderSelectionPopover;\r\n      break;\r\n    case \"number\":\r\n    case \"text\":\r\n    default:\r\n      renderContent = renderTextInputPopover;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <PopoverOnSvg\r\n      trigger={inputType === \"select\" ? \"context\" : \"click\"}\r\n      title={title}\r\n      renderContent={renderContent}\r\n      renderPopover={renderPopover}\r\n      visible={popoverVisible}\r\n      placement=\"bottom\"\r\n      onVisibilityChange={handleVisibilityChange}\r\n      {...popoverProps}\r\n    >\r\n      {children}\r\n    </PopoverOnSvg>\r\n    \r\n    </>\r\n    \r\n  );\r\n};\r\n\r\nexport default React.forwardRef(EditableContent);\r\n","export default function Row({\r\n  children,\r\n  type,\r\n  editable,\r\n  offset,\r\n  offsetX,\r\n  offsetY,\r\n  ...props\r\n}) {\r\n  offsetX = (offset?.x ?? offsetX) | 0;\r\n  offsetY = (offset?.y ?? offsetY) | 0;\r\n  return (\r\n    <g\r\n      type={type}\r\n      transform={`translate(${offsetX},${offsetY})`}\r\n      style={\r\n        editable\r\n          ? {\r\n              cursor: \"pointer\",\r\n            }\r\n          : null\r\n      }\r\n      {...props}\r\n    >\r\n      {children}\r\n    </g>\r\n  );\r\n}\r\n","// 为了解决svg text不渲染连续空格，对html转义并替换空格为 ;\r\nexport default function escapeHtml(text) {\r\n  const span = document.createElement(\"span\");\r\n  span.appendChild(document.createTextNode(text));\r\n  return span.innerHTML.replace(/\\s/g, \" \");\r\n}\r\n","import escapeHtml from \"../../util/html-escape\";\r\n\r\nexport default function Text({ children, editable, ...props }) {\r\n  if (typeof children === \"string\") {\r\n    return (\r\n      <text\r\n        x=\"0\"\r\n        y=\"0\"\r\n        style={\r\n          editable\r\n            ? {\r\n                cursor: \"pointer\",\r\n              }\r\n            : null\r\n        }\r\n        dominantBaseline=\"hanging\"\r\n        stroke=\"none\"\r\n        fontWeight=\"bold\"\r\n        fill=\"currentColor\"\r\n        dangerouslySetInnerHTML={{ __html: escapeHtml(children) }}\r\n        {...props}\r\n      ></text>\r\n    );\r\n  }\r\n  return (\r\n    <text\r\n      x=\"0\"\r\n      y=\"0\"\r\n      style={\r\n        editable\r\n          ? {\r\n              cursor: \"pointer\",\r\n            }\r\n          : null\r\n      }\r\n      dominantBaseline=\"hanging\"\r\n      stroke=\"none\"\r\n      fontWeight=\"bold\"\r\n      fill=\"currentColor\"\r\n      {...props}\r\n    >\r\n      {children}\r\n    </text>\r\n  );\r\n}\r\n","import { message } from \"antd\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport EditableContent from \"../../../component/EditableContent\";\r\nimport P from \"../../../util/placement\";\r\nimport store from \"../../../store/global\";\r\nimport { wrappedAction } from \"../../../store/history\";\r\nimport Row from \"../../Row\";\r\nimport Text from \"../../Text\";\r\n\r\nconst tones = [\r\n  \"C\",\r\n  \"D\",\r\n  \"E\",\r\n  \"F\",\r\n  \"G\",\r\n  \"A\",\r\n  \"B\",\r\n  \"♭C\",\r\n  \"♭D\",\r\n  \"♭E\",\r\n  \"♭F\",\r\n  \"♭G\",\r\n  \"♭A\",\r\n  \"♭B\",\r\n].map((t) => ({ key: t, text: t }));\r\nconst handleChangeTone = wrappedAction(function (value) {\r\n  store.tone = value;\r\n});\r\nconst handleChangeSpeed = wrappedAction(function (value) {\r\n  store.speed = value;\r\n});\r\nconst handleChangeBeat = wrappedAction(function (value) {\r\n  const beat = String(value).split(\"/\");\r\n  if (beat.length !== 2) {\r\n    message.error(\"請以【*/*】的格式輸入節拍！\");\r\n    return false;\r\n  }\r\n  const [c, t] = [parseInt(beat[0], 10), parseInt(beat[1], 10)];\r\n  if (c > 0 && t > 0) {\r\n    store.beat = [c, t];\r\n  } else {\r\n    message.error(\"請輸入大於0的拍數和時值！\");\r\n    return false;\r\n  }\r\n});\r\n\r\nfunction LeftInfoBlock() {\r\n  if (store.showheaders){\r\n    return (\r\n      <>\r\n        <EditableContent\r\n          inputType=\"select\"\r\n          initialValue={store.tone}\r\n          options={tones}\r\n          onChange={handleChangeTone}\r\n          popoverProps={{ trigger: \"click\" }}\r\n        >\r\n          <Row\r\n            type=\"tone\"\r\n            editable\r\n            offsetX={store.marginHorizontal}\r\n            offsetY={P.titleOffsetY}\r\n          >\r\n            <Text>1 = </Text>\r\n            {store.tone.startsWith(\"♭\") && (\r\n              <Text x=\"27\" y=\"-2\" fontSize={store.defaultSubFontSize}>\r\n                ♭\r\n              </Text>\r\n            )}\r\n  \r\n            <Text editable x={store.tone.startsWith(\"♭\") ? 36 : 29}>\r\n              {store.tone.at(-1)}\r\n            </Text>\r\n          </Row>\r\n        </EditableContent>\r\n        <EditableContent\r\n          title=\"節拍：\"\r\n          inputType=\"number\"\r\n          initialValue={store.beat.join(\"/\")}\r\n          onChange={handleChangeBeat}\r\n        >\r\n          <Row\r\n            type=\"beat\"\r\n            editable\r\n            offsetX={store.marginHorizontal + 64}\r\n            offsetY={P.titleOffsetY}\r\n          >\r\n            <Text x=\"0\" y=\"-8\" textAnchor=\"middle\">\r\n              {store.beat[0]}\r\n            </Text>\r\n            <Text x=\"0\" y=\"12\" textAnchor=\"middle\">\r\n              {store.beat[1]}\r\n            </Text>\r\n            <line x1=\"-8\" y1=\"8\" x2=\"8\" y2=\"8\" stroke=\"currentColor\" />\r\n          </Row>\r\n        </EditableContent>\r\n        <EditableContent\r\n          title=\"速度（bps）：\"\r\n          inputType=\"number\"\r\n          initialValue={store.speed}\r\n          onChange={handleChangeSpeed}\r\n        >\r\n          <Row\r\n            editable\r\n            type=\"speed\"\r\n            offsetX={store.marginHorizontal}\r\n            offsetY={P.titleOffsetY + 22}\r\n          >\r\n            <Text x=\"2\">♩</Text>\r\n            <Text x=\"16\">= {store.speed}</Text>\r\n          </Row>\r\n        </EditableContent>\r\n        \r\n      </>\r\n    );\r\n  }\r\n  else{\r\n    return <></>\r\n  }\r\n}\r\n\r\nexport default observer(LeftInfoBlock);\r\n","import { DeleteOutlined, PlusOutlined } from \"@ant-design/icons\";\r\nimport { Modal } from \"antd\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport EditableContent from \"../../../component/EditableContent\";\r\nimport P from \"../../../util/placement\";\r\nimport store from \"../../../store/global\";\r\nimport { wrappedAction } from \"../../../store/history\";\r\nimport Row from \"../../Row\";\r\nimport Text from \"../../Text\";\r\n\r\nconst authorContextMenu = [\r\n  {\r\n    key: \"create\",\r\n    text: \"添加\",\r\n    icon: <PlusOutlined />,\r\n    onClick: () => {\r\n      store.authors.push(\"作者信息\");\r\n    },\r\n  },\r\n  {\r\n    key: \"delete\",\r\n    text: \"刪除\",\r\n    icon: <DeleteOutlined />,\r\n    onClick: (index) => {\r\n      store.authors.splice(index, 1);\r\n    },\r\n  },\r\n  {\r\n    key: \"deleteall\",\r\n    text: \"刪除所有\",\r\n    icon: <DeleteOutlined />,\r\n    onClick: (index) => {\r\n      store.authors = [];\r\n    },\r\n  },\r\n];\r\nconst blockContextMenu = [\r\n  {\r\n    key: \"create\",\r\n    text: \"添加作者信息\",\r\n    icon: <PlusOutlined />,\r\n    onClick: () => {\r\n      store.authors.push(\"【記譜者】  記譜\");\r\n    },\r\n  },\r\n];\r\nconst handleSelectMenu = wrappedAction((index, value) => {\r\n  const menu = authorContextMenu.find((m) => m.key === value);\r\n  menu?.onClick(index);\r\n});\r\nconst handleSelectBlockMenu = wrappedAction((value) => {\r\n  const menu = blockContextMenu.find((m) => m.key === value);\r\n  menu?.onClick();\r\n});\r\nconst handleChangeAuthor = wrappedAction((index, value) => {\r\n  if (!value) {\r\n    return new Promise((resolve) => {\r\n      Modal.confirm({\r\n        title: \"你想刪除這個作者信息嗎？\",\r\n        okText: \"刪除\",\r\n        cancelText: \"取消\",\r\n        onOk: () => {\r\n          resolve(true);\r\n          store.authors.splice(index, 1);\r\n        },\r\n        onCancel: () => {\r\n          resolve(true);\r\n        },\r\n      });\r\n    });\r\n  }\r\n  store.authors[index] = value;\r\n});\r\n\r\nfunction RightInfoBlock() {\r\n  return (\r\n    <Row\r\n      type=\"authors\"\r\n      offsetX={store.canvasWidth - store.marginHorizontal}\r\n      offsetY={P.titleOffsetY}\r\n    >\r\n      <EditableContent\r\n        inputType=\"select\"\r\n        options={blockContextMenu}\r\n        popoverProps={{ trigger: \"context\" }}\r\n        onChange={handleSelectBlockMenu}\r\n      >\r\n        <rect\r\n          x={store.marginHorizontal - 150}\r\n          y=\"-64\"\r\n          width={150}\r\n          height={150}\r\n          fill={store.authors.length ? \"none\" : \"transparent\"}\r\n          // className={Styles.hotCorner}\r\n        ></rect>\r\n      </EditableContent>\r\n      {store.authors.map((author, i) => (\r\n        <EditableContent\r\n          key={i + author}\r\n          inputType=\"select\"\r\n          options={authorContextMenu}\r\n          popoverProps={{ trigger: \"context\" }}\r\n          onChange={handleSelectMenu.bind(null, i)}\r\n        >\r\n          <EditableContent\r\n            title=\"作者信息：\"\r\n            initialValue={author}\r\n            onChange={handleChangeAuthor.bind(null, i)}\r\n          >\r\n            <Text editable y={i * 22} textAnchor=\"end\">\r\n              {author}\r\n            </Text>\r\n          </EditableContent>\r\n        </EditableContent>\r\n      ))}\r\n    </Row>\r\n  );\r\n}\r\n\r\nexport default observer(RightInfoBlock);\r\n","import { observer } from \"mobx-react-lite\";\r\nimport { useRef } from \"react\";\r\nimport EditableContent from \"../../../component/EditableContent\";\r\nimport store from \"../../../store/global\";\r\nimport { wrappedAction } from \"../../../store/history\";\r\nimport Row from \"../../Row\";\r\nimport Text from \"../../Text\";\r\nconst handleChangeTitle = wrappedAction((value) => {\r\n  store.title = value;\r\n});\r\n\r\nfunction Title() {\r\n  const ref = useRef();\r\n  return (\r\n    <Row type=\"title\" offsetY={store.marginTop}>\r\n      <EditableContent\r\n        ref={ref}\r\n        title=\"歌曲名稱：\"\r\n        initialValue={store.title}\r\n        onChange={handleChangeTitle}\r\n      >\r\n        <Text\r\n          editable\r\n          x=\"50%\"\r\n          fontSize=\"32\"\r\n          fill=\"currentColor\"\r\n          stroke=\"none\"\r\n          textAnchor=\"middle\"\r\n        >\r\n          {store.title}\r\n        </Text>\r\n      </EditableContent>\r\n    </Row>\r\n  );\r\n}\r\n\r\nexport default observer(Title);\r\n","import { observer } from \"mobx-react-lite\";\r\nimport { useRef } from \"react\";\r\nimport EditableContent from \"../../../component/EditableContent\";\r\nimport store from \"../../../store/global\";\r\nimport { wrappedAction } from \"../../../store/history\";\r\nimport Row from \"../../Row\";\r\nimport Text from \"../../Text\";\r\nconst handleChangePageNo = wrappedAction((value) => {\r\n  store.page = value;\r\n});\r\n\r\n\r\nfunction PageNumber() {\r\n  const ref = useRef();\r\n  return (\r\n    <Row type=\"pageno\" offsetY={store.canvasHeight - 40}>\r\n      <EditableContent\r\n        ref={ref}\r\n        title=\"頁碼\"\r\n        initialValue={store.page}\r\n        onChange={handleChangePageNo}\r\n      >\r\n        <Text\r\n          editable\r\n          x=\"50%\"\r\n          fontSize=\"14\"\r\n          fill=\"currentColor\"\r\n          textAnchor=\"middle\"\r\n        >\r\n          {store.page}\r\n        </Text>\r\n      </EditableContent>\r\n    </Row>\r\n  );\r\n}\r\n\r\nexport default observer(PageNumber);\r\n","import React from \"react\";\r\nimport LeftInfoBlock from \"./LeftInfoBlock\";\r\nimport RightInfoBlock from \"./RightInfoBlock\";\r\nimport Title from \"./Title\";\r\nimport PageNumber from \"./PageNumber\";\r\nimport store from \"../../store/global\";\r\nimport { observer } from \"mobx-react-lite\";\r\nfunction Header() {\r\n  return (\r\n    <>\r\n      <Title></Title>\r\n      { store.showheaders && <LeftInfoBlock></LeftInfoBlock>}\r\n      <RightInfoBlock></RightInfoBlock>\r\n      <PageNumber></PageNumber>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default observer(Header);\r\n","import { Button, Modal } from \"antd\";\r\nimport { useCallback } from \"react\";\r\nimport Styles from \"./index.module.css\";\r\nfunction macOS() {\r\n  return navigator.userAgent.includes(\"Mac OS X\");\r\n}\r\nfunction KeyboardDescItem({ kbd, desc }) {\r\n  return (\r\n    <li className={Styles.listItem}>\r\n      <kbd className={Styles.kbd} style={{fontFamily: \"Consolas\"}}>{kbd}</kbd>\r\n      <span>{desc}</span>\r\n    </li>\r\n  );\r\n}\r\n\r\nfunction HelpModal({ visible, onVisibleChange }) {\r\n  var ctrl = \"Ctrl\";\r\n  if (macOS()){\r\n    ctrl = \"⌘\";\r\n  }\r\n  const handleClose = useCallback(() => {\r\n    onVisibleChange?.call(null, false);\r\n  }, [onVisibleChange]);\r\n\r\n  return (\r\n    <Modal\r\n      width=\"100%\"\r\n      height=\"90%\"\r\n      style={{ top: \"4%\" }}\r\n      visible={visible}\r\n      title=\"快捷鍵\"\r\n      onCancel={handleClose}\r\n      footer={\r\n        <Button key=\"close\" type=\"primary\" onClick={handleClose}>\r\n          確認\r\n        </Button>\r\n      }\r\n    >\r\n      <h3>全局</h3>\r\n      <ul className={Styles.list}>\r\n        <KeyboardDescItem kbd=\"?\" desc=\"顯示此頁面\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+Z\"} desc=\"復原\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+Shift+Z\"} desc=\"重做\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+O\"} desc=\"開啟\" />\r\n        <KeyboardDescItem kbd=\"h j k l\" desc=\"移動焦點\" />\r\n      </ul>\r\n      <h3>只選中符號時</h3>\r\n      <h4>輸入音符</h4>\r\n      直接按鍵盤上相應的按鍵即可輸入到當前符號。支持的音符符號有：\r\n      <p>\r\n        <kbd className={Styles.kbd}>0-7</kbd>\r\n        <kbd className={Styles.kbd}>─ ( )</kbd>\r\n      </p>\r\n      <h4>輸入輔助元素</h4>\r\n      <ul className={Styles.list}>\r\n        <KeyboardDescItem kbd=\"a\" desc=\"選擇連線停止符號\" />\r\n        <KeyboardDescItem kbd=\"A\" desc=\"刪除連音線\" />\r\n        <KeyboardDescItem kbd=\"|\" desc=\"輸入小節線\" />\r\n        <KeyboardDescItem kbd=\".\" desc=\"輸入附加點\" />\r\n        <KeyboardDescItem kbd=\"~\" desc=\"音符號\" />\r\n        <KeyboardDescItem kbd=\"u / U\" desc=\"增加減少時間線\" />\r\n        <KeyboardDescItem kbd=\"!\" desc=\"打斷增加時間線\" />\r\n        <KeyboardDescItem kbd=\"8 / *\" desc=\"八度圓點\" />\r\n        <KeyboardDescItem kbd=\"# / b\" desc=\"音標升/降\" />\r\n      </ul>\r\n      <h4>操作</h4>\r\n      <ul className={Styles.list}>\r\n      <KeyboardDescItem kbd=\"Enter\" desc=\"下一個音符\" />\r\n        <KeyboardDescItem kbd=\"Shift+Enter\" desc=\"上一個音符\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+Enter\"} desc=\"插入音符\" />\r\n        <KeyboardDescItem kbd=\"Delete\" desc=\"刪除音符\" />\r\n        <KeyboardDescItem kbd=\"Shift+Delete\" desc=\"刪除段落\" />\r\n        <KeyboardDescItem kbd=\"=\" desc=\"段落是否兩端對齊\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+C\"} desc=\"複製音符\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+Shift+C\"} desc=\"複製段落\" />\r\n        <KeyboardDescItem kbd={ctrl+\"+V\"} desc=\"貼上\" />\r\n      </ul>\r\n      <h2>提示</h2>\r\n      <ul className={Styles.list}>\r\n        <li>段落上可以右鍵彈出操作菜單</li>\r\n        <li>增加時間線默認連接，可在音符右鍵菜單中選擇打斷</li>\r\n      </ul>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nexport default HelpModal;\r\n","import { message } from \"antd\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport EditableContent from \"../../../component/EditableContent\";\r\nimport P from \"../../../util/placement\";\r\nimport store from \"../../../store/global\";\r\nimport { wrappedAction } from \"../../../store/history\";\r\nimport Row from \"../../Row\";\r\nimport Text from \"../../Text\";\r\n\r\nconst tones = [\r\n  \"C\",\r\n  \"D\",\r\n  \"E\",\r\n  \"F\",\r\n  \"G\",\r\n  \"A\",\r\n  \"B\",\r\n  \"♭C\",\r\n  \"♭D\",\r\n  \"♭E\",\r\n  \"♭F\",\r\n  \"♭G\",\r\n  \"♭A\",\r\n  \"♭B\",\r\n].map((t) => ({ key: t, text: t }));\r\n\r\nfunction LeftInfoBlock({ key, showndata }) {\r\n  function getData(){\r\n    if (showndata.includes(0)){\r\n      return 64\r\n    }\r\n    else{\r\n      return 6\r\n    }\r\n  }\r\n  function getData2(){\r\n    if (showndata.includes(0) && showndata.includes(1)){\r\n      return 22\r\n    }\r\n    else{\r\n      return 0\r\n    }\r\n  }\r\n  function getData3(){\r\n    if (showndata.includes(0)){\r\n      return 50\r\n    }\r\n    else if (showndata.includes(1)){\r\n      return 22\r\n    }\r\n    else{\r\n      return 0\r\n    }\r\n  }\r\n  if (store.tonedata[key] == undefined) {\r\n    store.tonedata[key] = 'C';\r\n    store.beatdata[key] = [4, 4]\r\n    store.speeddata[key] = '75'\r\n  }\r\n  var datas = []\r\n  if (showndata.includes(0)) {\r\n    datas.push(<EditableContent\r\n      inputType=\"select\"\r\n      initialValue={store.tonedata[key]}\r\n      options={tones}\r\n      onChange={function (value) { store.tonedata[key] = value; }}\r\n      popoverProps={{ trigger: \"click\" }}\r\n    >\r\n      <Row\r\n        type=\"tone\"\r\n        editable\r\n        offsetX={0}\r\n        offsetY={0}\r\n      >\r\n        <Text>1 = </Text>\r\n        {store.tonedata[key].startsWith(\"♭\") && (\r\n          <Text x=\"27\" y=\"-2\" fontSize={store.defaultSubFontSize}>\r\n            ♭\r\n          </Text>\r\n        )}\r\n\r\n        <Text editable x={store.tonedata[key].startsWith(\"♭\") ? 36 : 29}>\r\n          {store.tonedata[key].at(-1)}\r\n        </Text>\r\n      </Row>\r\n    </EditableContent>)\r\n  }\r\n  if (showndata.includes(1)) {\r\n    datas.push(<EditableContent\r\n      title=\"節拍：\"\r\n      inputType=\"number\"\r\n      initialValue={store.beatdata[key].join(\"/\")}\r\n      onChange={function (value) {\r\n        const beat = String(value).split(\"/\");\r\n        if (beat.length !== 2) {\r\n          message.error(\"請以【*/*】的格式輸入節拍！\");\r\n          return false;\r\n        }\r\n        const [c, t] = [parseInt(beat[0], 10), parseInt(beat[1], 10)];\r\n        if (c > 0 && t > 0) {\r\n          store.beatdata[key] = [c, t];\r\n        } else {\r\n          message.error(\"請輸入大於0的拍數和時值！\");\r\n          return false;\r\n        }\r\n      }}\r\n    >\r\n      <Row\r\n        type=\"beat\"\r\n        editable\r\n        offsetX={getData()}\r\n        offsetY={0}\r\n      >\r\n        <Text x=\"0\" y=\"-8\" textAnchor=\"middle\">\r\n          {store.beatdata[key][0]}\r\n        </Text>\r\n        <Text x=\"0\" y=\"12\" textAnchor=\"middle\">\r\n          {store.beatdata[key][1]}\r\n        </Text>\r\n        <line x1=\"-8\" y1=\"8\" x2=\"8\" y2=\"8\" stroke=\"currentColor\" />\r\n      </Row>\r\n    </EditableContent>)\r\n  }\r\n  if (showndata.includes(2)) {\r\n    datas.push(<EditableContent\r\n      title=\"速度（bps）：\"\r\n      inputType=\"number\"\r\n      initialValue={store.speeddata[key]}\r\n      onChange={function (value) { store.speeddata[key] = value }}\r\n    >\r\n      <Row\r\n        editable\r\n        type=\"speed\"\r\n        offsetX={getData3()}\r\n        offsetY={getData2()}\r\n      >\r\n        <Text x=\"2\">♩</Text>\r\n        <Text x=\"16\">= {store.speeddata[key]}</Text>\r\n      </Row>\r\n    </EditableContent>)\r\n  }\r\n  console.log(datas)\r\n  console.log(showndata.toString())\r\n  return <>{datas}</>;\r\n}\r\n\r\nexport default observer(LeftInfoBlock);\r\n","import { DeleteOutlined, EnterOutlined } from \"@ant-design/icons\";\r\nimport { Menu,Modal,Checkbox } from \"antd\";\r\nimport store from \"../store/global\";\r\nimport { createNotation, notations } from \"../util/notation\";\r\nimport { createBeat, createParagraph } from \"../util/paragraph\";\r\nimport { wrappedAction } from \"../store/history\";\r\n\r\nfunction getParagraphMenuOptions(paragraph) {\r\n  const handleMenu = wrappedAction(({ key }) => {\r\n    switch (key) {\r\n      case \"add\": {\r\n\r\n        const idx = store.paragraphs.findIndex((p) => p.key === paragraph.key);\r\n        const para = createParagraph({\r\n          notations: [\r\n\r\n            createNotation({ note: \"0\" }),\r\n            createNotation({ note: \"0\" }),\r\n            createNotation({ note: \"0\" }),\r\n            createNotation({ note: notations.separator }),\r\n          ],\r\n        });\r\n        if (idx !== -1) {\r\n          store.paragraphs.splice(idx + 1, 0, para);\r\n        } else {\r\n          store.paragraphs.push(para);\r\n        }\r\n        break;\r\n      }\r\n      case \"addz\": {\r\n        var checked = []\r\n        const onChange = (checkedValues) => {\r\n          checked = checkedValues;\r\n        };\r\n        Modal.info({\r\n          title: '添加滑音符號(BETA)',\r\n          content: (\r\n            <Checkbox.Group onChange={onChange}>\r\n              <Checkbox value={0}>調子</Checkbox>\r\n              <Checkbox value={1}>節拍</Checkbox>\r\n              <Checkbox value={2}>速度</Checkbox>\r\n            </Checkbox.Group>\r\n          ),\r\n          onOk() {\r\n            if (checked.length == 0) {\r\n              Modal.error({\r\n                title: '錯誤',\r\n                content: '沒有選擇滑音符號',\r\n              });\r\n            }\r\n            else {\r\n              const para = createParagraph({\r\n                notations: [\r\n                  createBeat({ showndata: checked })\r\n                ],\r\n              });\r\n              store.paragraphs.push(para);\r\n            }\r\n          },\r\n        });\r\n        break;\r\n      }\r\n      case \"delete\":\r\n        const idx = store.paragraphs.findIndex((p) => p.key === paragraph.key);\r\n        if (idx !== -1) {\r\n          store.paragraphs.splice(idx, 1);\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n\r\n  return (\r\n    <Menu onClick={handleMenu}>\r\n      <Menu.Item key=\"add\" icon={<EnterOutlined />}>\r\n        添加段落\r\n      </Menu.Item>\r\n      <Menu.Item key=\"addz\" icon={<EnterOutlined />}>\r\n        添加滑音符號 (BETA)\r\n      </Menu.Item>\r\n      <Menu.Item danger key=\"delete\" icon={<DeleteOutlined />}>\r\n        刪除段落\r\n      </Menu.Item>\r\n    </Menu>\r\n  );\r\n}\r\n\r\nexport { getParagraphMenuOptions };\r\n","import {\r\n  DeleteOutlined,\r\n  RadiusSettingOutlined,\r\n  StopOutlined,\r\n} from \"@ant-design/icons\";\r\nimport { Menu } from \"antd\";\r\nimport state from \"../store/state\";\r\nimport { findParagraphAndNotation } from \"../util/editor\";\r\nimport { isNote } from \"../util/notation\";\r\nimport { runInWrappedAction, wrappedAction } from \"../store/history\";\r\n\r\nconst getNotationContextMenu = (notation, paragraph) => {\r\n  const hasTie = notation.tieTo;\r\n  const handleMenu = wrappedAction(function ({ key }) {\r\n    switch (true) {\r\n      case key === \"tie\": {\r\n        if (!hasTie) {\r\n          state.tieSourceKey = notation.key;\r\n          return;\r\n        }\r\n        const { notation: tieDesc } = findParagraphAndNotation(notation.tieTo);\r\n        if (tieDesc) {\r\n          tieDesc.tieTo = null;\r\n        }\r\n        notation.tieTo = null;\r\n        break;\r\n      }\r\n      case key === \"break-underline\":\r\n        notation.breakUnderline = !notation.breakUnderline;\r\n        break;\r\n      case key.startsWith(\"separator-\"): {\r\n        const separator = key.split(\"-\", 2)[1];\r\n        notation.note = separator;\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n\r\n  return (\r\n    // ENHANCE: 分音符类型显示菜单项\r\n    <Menu onClick={handleMenu} style={{ minWidth: \"80px\" }} mode=\"vertical\">\r\n      {isNote(notation) && (\r\n        <Menu.Item key=\"break-underline\" icon={<StopOutlined />}>\r\n          {notation.breakUnderline\r\n            ? \"在此處延續增減時線\"\r\n            : \"在此處打斷增減時線\"}\r\n        </Menu.Item>\r\n      )}\r\n      {isNote(notation) && (\r\n        <Menu.Item\r\n          key=\"tie\"\r\n          icon={<RadiusSettingOutlined />}\r\n          notation={notation}\r\n        >\r\n          {notation.tieTo ? \"刪除连音线\" : \"從此處添加連音線到...\"}\r\n        </Menu.Item>\r\n      )}\r\n      <Menu.Item key=\"delete\" icon={<DeleteOutlined />}>\r\n        刪除符號\r\n      </Menu.Item>\r\n    </Menu>\r\n  );\r\n};\r\n\r\n// ENHANCE: 使用EditableContent组件的overlay属性传入菜单\r\n// 执行选项回调。。\r\nfunction handleNotationContext(options, key) {\r\n  runInWrappedAction(() => (state.shouldNotationBlurAfterClick = false));\r\n  const callback = options.find((ops) => ops.key === key)?.onClick;\r\n  callback && callback();\r\n}\r\n\r\nexport { getNotationContextMenu, handleNotationContext };\r\n","import { observer } from \"mobx-react-lite\";\r\nimport EditableContent from \"../../component/EditableContent\";\r\nimport state from \"../../store/state\";\r\nimport store from \"../../store/global\";\r\nimport P, { calcSubTextWidth } from \"../../util/placement\";\r\nimport { getNotationContextMenu } from \"../../menu/notation\";\r\nimport { notations, placeTie } from \"../../util/notation\";\r\nimport { wrappedAction } from \"../../store/history\";\r\nimport Row from \"../Row\";\r\nimport Text from \"../Text\";\r\nimport Styles from \"./index.module.css\";\r\n\r\nfunction composeArray(octave) {\r\n  const len = Math.abs(Number(octave));\r\n  if (!Number.isInteger(len)) {\r\n    return [];\r\n  }\r\n  return Array(len).fill(0, 0, len);\r\n}\r\n\r\nfunction Notation({ offsetX, notation, paragraph }) {\r\n  const handleClick = wrappedAction(() => {\r\n    state.selectedNotationKey = notation.key;\r\n    state.shouldNotationBlurAfterClick = false;\r\n    placeTie(notation);\r\n  });\r\n\r\n  const underlineOffset = P.underlineStepOffsetY * (notation.underline | 0);\r\n  const octaveInitialOffset =\r\n    notation.octave > 0\r\n      ? -P.octaveInitialOffsetAbove\r\n      : P.octaveInitialOffsetBelow + underlineOffset;\r\n  const octaveStepOffset = (notation.octave > 0 ? -1 : 1) * P.octaveStepOffsetY;\r\n  let topDecoratorOffset = 0;\r\n  if (notation.octave > 0) {\r\n    // 如果有高八度圆点，将顶部装饰符渲染到其上方\r\n    topDecoratorOffset = octaveStepOffset * Math.abs(notation.octave);\r\n  }\r\n\r\n  const renderPrefixSups = () => {\r\n    const sups = notation.prefixSups || [];\r\n    const rendered = sups.map((s, i) => (\r\n      <Text\r\n        key={i + s}\r\n        dominantBaseline=\"middle\"\r\n        textAnchor=\"middle\"\r\n        fontSize={store.defaultSubFontSize}\r\n        x={-P.xWidth - (calcSubTextWidth(sups.slice(0, i).join(\"\")) + 2 * i)}\r\n        y={-P.subXHeight / 2 + 2}\r\n      >\r\n        {s}\r\n      </Text>\r\n    ));\r\n    return rendered;\r\n  };\r\n\r\n  const renderTopDecorators = () => {\r\n    const decs = notation.topDecorators || [];\r\n    const rendered = decs.map((d, i) => (\r\n      <Text\r\n        key={i + d}\r\n        dominantBaseline=\"middle\"\r\n        textAnchor=\"middle\"\r\n        fontSize={store.defaultSubFontSize}\r\n        y={topDecoratorOffset - (i + 1) * P.subXHeight + 2}\r\n      >\r\n        {d}\r\n      </Text>\r\n    ));\r\n    return rendered;\r\n  };\r\n\r\n  const renderNote = () => {\r\n    let transform;\r\n    if (notation.note === notations.extend) {\r\n      // 延音符太长了缩短一点\r\n      transform = \"scale(0.8, 1)\";\r\n    }\r\n    return (\r\n      <Text dominantBaseline=\"middle\" textAnchor=\"middle\" transform={transform}>\r\n        {notation.note}\r\n      </Text>\r\n    );\r\n  };\r\n\r\n  const renderOctave = () => {\r\n    return composeArray(notation.octave).map((oc, i) => (\r\n      <circle\r\n        key={i}\r\n        type=\"octave\"\r\n        cx=\"0\"\r\n        cy={octaveInitialOffset + octaveStepOffset * i}\r\n        fill=\"currentColor\"\r\n        r=\"2\"\r\n      ></circle>\r\n    ));\r\n  };\r\n  return (\r\n    <EditableContent\r\n      inputType=\"select\"\r\n      popoverProps={{ trigger: \"context\" }}\r\n      overlay={getNotationContextMenu(notation, paragraph)}\r\n    >\r\n      <Row\r\n        editable\r\n        type=\"notation\"\r\n        offsetX={offsetX}\r\n        onClick={handleClick}\r\n        className={\r\n          state.selectedNotationKey === notation.key\r\n            ? Styles.selectedNotation\r\n            : \"\"\r\n        }\r\n      >\r\n        {renderPrefixSups()}\r\n        {renderTopDecorators()}\r\n        {renderNote()}\r\n        {notation.dotted && (\r\n          <circle\r\n            type=\"dot\"\r\n            cx={P.xWidth + 4}\r\n            cy=\"-2\"\r\n            r=\"2\"\r\n            fill=\"currentColor\"\r\n          ></circle>\r\n        )}\r\n        {renderOctave()}\r\n      </Row>\r\n    </EditableContent>\r\n  );\r\n}\r\n\r\nNotation.defaultProps = {\r\n  offsetX: 0,\r\n  offsetY: 0,\r\n};\r\n\r\nexport default observer(Notation);\r\n","import { observer } from \"mobx-react-lite\";\r\nimport LeftInfoBlock from \"../Header/LeftInfoBlock/custom\";\r\nimport store from \"../../store/global\";\r\nimport EditableContent from \"../../component/EditableContent\";\r\nimport P, {\r\n  calcNotationAboveOffset,\r\n  calcNotationPrefixOffset,\r\n  calcNotationWidth,\r\n  calcParagraphAboveOffset,\r\n  calcParagraphContentHeight,\r\n  calcParagraphWidth,\r\n} from \"../../util/placement\";\r\nimport { getParagraphMenuOptions } from \"../../menu/paragraph\";\r\nimport Notation from \"../Notation\";\r\nimport Row from \"../Row\";\r\n\r\nfunction Paragraph({ paragraph, offsetY, alignJustify }) {\r\n  const notations = paragraph.notations || [];\r\n  const widthCache = [];\r\n  let itemFlexOffset = 0;\r\n  if (alignJustify && paragraph.notations?.length > 1) {\r\n    const realWidth = calcParagraphWidth(paragraph);\r\n    itemFlexOffset =\r\n      (P.maxContentWidth - realWidth) / (paragraph.notations.length - 1);\r\n  }\r\n\r\n  // 计算前n个音符的宽度\r\n  const accumulate = (index) => {\r\n    let width = 0;\r\n    for (let i = 0; i < index; i++) {\r\n      const n = notations[i];\r\n      widthCache[i] = widthCache[i] || calcNotationWidth(n);\r\n      width += widthCache[i];\r\n    }\r\n    // 音符的定位基准是其中心，因此要加上当前音符的前缀部分偏移\r\n    width += calcNotationPrefixOffset(notations[index]);\r\n    return width;\r\n  };\r\n\r\n  // 缓存音符偏移量\r\n  const noteOffsets = notations.map((_, i) => {\r\n    return (\r\n      // 渲染音符时坐标为其中心，故偏移半个音符宽\r\n      P.xWidth / 2 +\r\n      // 偏移前面音符的宽度\r\n      accumulate(i) +\r\n      // 两端对齐时自动偏移\r\n      itemFlexOffset * i\r\n    );\r\n  });\r\n\r\n  // 绘制音符的增减时线\r\n  const renderUnderLine = (offsetY, fromIndex, toIndex) => {\r\n    return (\r\n      <line\r\n        key={`${fromIndex}_${toIndex}_${offsetY}`}\r\n        x1={noteOffsets[fromIndex] - P.xWidth}\r\n        x2={noteOffsets[toIndex] + P.xWidth}\r\n        y1={offsetY}\r\n        y2={offsetY}\r\n        stroke=\"currentColor\"\r\n      ></line>\r\n    );\r\n  };\r\n  const renderUnderlines = () => {\r\n    const lines = [];\r\n    // 记录音符当前需要绘制的增减时线的条数\r\n    let helpMap = notations.map((n) => (n.underline > 0 ? n.underline : 0));\r\n    let baseOffsetY = P.underlineInitialOffsetY;\r\n    while (helpMap.some((n) => n > 0)) {\r\n      let fromIndex = -1;\r\n      let toIndex = fromIndex;\r\n      for (let i = 0; i < notations.length; ++i) {\r\n        const n = notations[i];\r\n        if (helpMap[i] > 0) {\r\n          // 当前音符需要添加增减时线\r\n          if (fromIndex >= 0) {\r\n            // 其前面的音符也需要添加增减时线\r\n            if (n.breakUnderline) {\r\n              // 当前音符禁止和前面的增减时线连续，绘制前面的增减时线\r\n              lines.push(renderUnderLine(baseOffsetY, fromIndex, toIndex));\r\n              // 记录当前音符位置等待绘制\r\n              fromIndex = toIndex = i;\r\n            } else {\r\n              // 当前音符可能和下一个音符的增减时线连续，本次循环不绘制\r\n              toIndex = i;\r\n            }\r\n          } else {\r\n            fromIndex = toIndex = i;\r\n          }\r\n          if (i === notations.length - 1) {\r\n            // 已是最后一个音符，直接绘制增减时线\r\n            lines.push(renderUnderLine(baseOffsetY, fromIndex, toIndex));\r\n            fromIndex = toIndex = -1;\r\n          }\r\n          --helpMap[i];\r\n        } else {\r\n          // 当前音符不需要绘制增减时线\r\n          if (fromIndex >= 0) {\r\n            lines.push(renderUnderLine(baseOffsetY, fromIndex, toIndex));\r\n            fromIndex = toIndex = -1;\r\n          }\r\n        }\r\n      }\r\n      baseOffsetY += P.underlineStepOffsetY;\r\n    }\r\n    return lines;\r\n  };\r\n\r\n  // 渲染连音线\r\n  const renderTie = (offsetY, fromIndex, toIndex) => {\r\n    const bezierX1 = noteOffsets[fromIndex];\r\n    const bezierX2 = bezierX1 + 4;\r\n    const bezierX4 = noteOffsets[toIndex];\r\n    const bezierX3 = bezierX4 - 4;\r\n    const x = bezierX4 - bezierX1;\r\n    // ENHANCE: 优化贝赛尔曲线\r\n    let y =\r\n      0.000021917145491103032 * x * x * x -\r\n      0.0062948773732605465 * x * x +\r\n      0.6378785891964498 * x -\r\n      0.6843414475200537;\r\n    y = Math.max(Math.min(y, P.maxTieBezierOffset), P.minTieHeight);\r\n    const bezierY = offsetY - y;\r\n    return (\r\n      <path\r\n        key={`${fromIndex}_${toIndex}_${offsetY}`}\r\n        d={`M${bezierX1} ${offsetY} C${bezierX2} ${bezierY} ${bezierX3} ${bezierY} ${bezierX4} ${offsetY}`}\r\n        stroke=\"currentColor\"\r\n        fill=\"none\"\r\n      ></path>\r\n    );\r\n  };\r\n  const renderTies = () => {\r\n    const ties = [];\r\n    const offsetMap = new Map();\r\n    for (let i = 0; i < notations.length; ++i) {\r\n      const n = notations[i];\r\n      if (n.tieTo) {\r\n        const toIndex = notations.findIndex((nn) => nn.key === n.tieTo);\r\n        if (toIndex <= i) {\r\n          // tieTo属性应该是双向的，仅遍历到第一个节点时渲染\r\n          continue;\r\n        }\r\n        let minOffsetY = 0;\r\n        for (let j = i; j <= toIndex; ++j) {\r\n          let offset;\r\n          if (offsetMap.has(notations[j].key)) {\r\n            offset = offsetMap.get(notations[j].key);\r\n          } else {\r\n            offset = -calcNotationAboveOffset(notations[j]);\r\n            offsetMap.set(notations[j].key, offset);\r\n          }\r\n          minOffsetY = Math.min(minOffsetY, offset);\r\n        }\r\n        ties.push(renderTie(minOffsetY, i, toIndex));\r\n      }\r\n    }\r\n    return ties;\r\n  };\r\n\r\n  const renderParagraphMask = () => {\r\n    const height = calcParagraphContentHeight(paragraph);\r\n    return (\r\n      <EditableContent\r\n        inputType=\"select\"\r\n        overlay={getParagraphMenuOptions(paragraph)}\r\n      >\r\n        <rect\r\n          x={-P.xWidth / 2}\r\n          y={-calcParagraphAboveOffset(paragraph)}\r\n          width={P.maxContentWidth}\r\n          height={height}\r\n          fill=\"transparent\"\r\n        ></rect>\r\n      </EditableContent>\r\n    );\r\n  };\r\n  if (notations[0].type === \"beatsp\") {\r\n    store.tonedata[notations[0].key] = 'C'\r\n    return (\r\n      <Row type=\"paragraph\" offsetY={offsetY - 20}>\r\n        {renderParagraphMask()}\r\n        <LeftInfoBlock key={notations[0].key} showndata={notations[0].showndata}></LeftInfoBlock>\r\n      </Row>\r\n    );\r\n  }\r\n  return (\r\n    \r\n    <Row type=\"paragraph\" offsetY={offsetY}>\r\n      {renderParagraphMask()}\r\n      {renderTies()}\r\n      {paragraph.notations.map((n, i) => (\r\n        <Notation\r\n          key={n.key}\r\n          notation={n}\r\n          paragraph={paragraph}\r\n          offsetX={noteOffsets[i]}\r\n        />\r\n      ))}\r\n      {renderUnderlines()}\r\n    </Row>\r\n  );\r\n}\r\n\r\nexport default observer(Paragraph);\r\n","import { Button, Dropdown, Modal } from \"antd\";\r\nimport { VERSION, VERSIONNAME } from \"../../util/version\";\r\nimport {\r\n  EditOutlined,\r\n  FileTextOutlined,\r\n  QuestionOutlined,\r\n  InfoCircleOutlined,\r\n  RetweetOutlined,\r\n  SettingOutlined,\r\n} from \"@ant-design/icons\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { useEffect } from \"react\";\r\nimport state from \"../../store/state\";\r\nimport store from \"../../store/global\";\r\nimport P, {\r\n  calcParagraphAboveOffset,\r\n  calcParagraphHeight,\r\n} from \"../../util/placement\";\r\nimport {\r\n  convertMenu,\r\n  editMenu,\r\n  fileMenu,\r\n  handleClick,\r\n  handleKeyPress,\r\n} from \"../../menu/editor\";\r\nimport { unwrappedAction } from \"../../store/history\";\r\nimport Canvas from \"../Canvas\";\r\nimport ConfigModal from \"../ConfigModal\";\r\nimport Header from \"../Header\";\r\nimport HelpModal from \"../HelpModal\";\r\nimport Paragraph from \"../Paragraph\";\r\nimport Row from \"../Row\";\r\nimport Styles from \"./index.module.css\";\r\n\r\nfunction Editor() {\r\n  const heightCache = [];\r\n  function accumulate(index) {\r\n    const paragraphs = store.paragraphs || [];\r\n    let height = 0;\r\n    for (let i = 0; i < index; i++) {\r\n      const p = paragraphs[i];\r\n      heightCache[i] = heightCache[i] || calcParagraphHeight(p);\r\n      height += heightCache[i];\r\n    }\r\n    // 段落渲染定位基于段落中心，因此加上上半部分的偏移量\r\n    height += calcParagraphAboveOffset(paragraphs[index]);\r\n    return height;\r\n  }\r\n  const handleChangeConfigModalVisibility = unwrappedAction((visible) => {\r\n    state.configDialogVisible = visible;\r\n  });\r\n  const handleChangeHelpModalVisibility = unwrappedAction((visible) => {\r\n    state.helpDialogVisible = visible;\r\n  });\r\n  const handleShowConfigDialog = () => {\r\n    handleChangeConfigModalVisibility(true);\r\n  };\r\n  const handleShowHelpDialog = () => {\r\n    handleChangeHelpModalVisibility(true);\r\n  };\r\n  useEffect(() => {\r\n    document.addEventListener(\"keydown\", handleKeyPress);\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyPress);\r\n    };\r\n  }, []);\r\n  function getM(){\r\n    if (store.showheaders == true){\r\n      return P.headerOffsetY\r\n    }\r\n    else{\r\n      return P.headerOffsetY - 60\r\n    }\r\n  }\r\n  return (\r\n    <div\r\n      className={Styles.container}\r\n      style={{ width: store.canvasWidth + \"px\"}}\r\n    >\r\n      <div style={{}} className={Styles.headerWrapper}>\r\n        <div\r\n          className={Styles.header}\r\n          style={{ width: store.canvasWidth + \"px\" }}\r\n        >\r\n          <Dropdown overlay={fileMenu} placement=\"bottomLeft\">\r\n            <Button icon={<FileTextOutlined />} type=\"text\">\r\n              檔案\r\n            </Button>\r\n          </Dropdown>\r\n          <Dropdown overlay={editMenu} placement=\"bottomLeft\">\r\n            <Button icon={<EditOutlined />} type=\"text\">\r\n              編輯\r\n            </Button>\r\n          </Dropdown>\r\n          {/* <Dropdown overlay={convertMenu} placement=\"bottomLeft\">\r\n            <Button icon={<RetweetOutlined />} type=\"text\">\r\n              转调\r\n            </Button>\r\n          </Dropdown> */}\r\n          <Button\r\n            icon={<SettingOutlined />}\r\n            type=\"text\"\r\n            onClick={handleShowConfigDialog}\r\n          >\r\n            設置\r\n          </Button>\r\n          <Button\r\n            icon={<QuestionOutlined />}\r\n            type=\"text\"\r\n            onClick={handleShowHelpDialog}\r\n          >\r\n            快捷鍵\r\n          </Button>\r\n          <Button\r\n            icon={<InfoCircleOutlined />}\r\n            type=\"text\"\r\n            onClick={function(){\r\n              Modal.info({\r\n                title: '關於 EasyType',\r\n                content: (\r\n                  <div>\r\n                    <p>EasyType 版本: {VERSIONNAME}({VERSION})</p>\r\n                    <p>Copyright (c) 2022, Meow Tech Open Source. Based on Numerical Notation Editor, licensed under GNU v3 public license.</p>\r\n                  </div>\r\n                ),\r\n                onOk() {},\r\n              });\r\n            }}\r\n          >\r\n            關於\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      <Canvas onClick={handleClick}>\r\n        <Header />\r\n        \r\n        <Row offsetX={store.marginHorizontal} offsetY={getM()}>\r\n          {store.paragraphs.map((p, i) => {\r\n            //console.log(i)\r\n            let alignJustify = p.alignJustify;\r\n            if (typeof alignJustify !== \"boolean\") {\r\n              alignJustify = !(i === store.paragraphs.length - 1);\r\n            }\r\n            return (\r\n              <Paragraph\r\n                key={p.key}\r\n                paragraph={p}\r\n                offsetY={accumulate(i)}\r\n                alignJustify={alignJustify}\r\n              />\r\n            );\r\n          })}\r\n        </Row>\r\n        \r\n      </Canvas>\r\n      <ConfigModal\r\n        visible={state.configDialogVisible}\r\n        onVisibleChange={handleChangeConfigModalVisibility}\r\n      ></ConfigModal>\r\n      <HelpModal\r\n        visible={state.helpDialogVisible}\r\n        onVisibleChange={handleChangeHelpModalVisibility}\r\n      ></HelpModal>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default observer(Editor);\r\n","import { resetGlobalData } from \"./editor\";\r\n\r\nasync function loadExample() {\r\n  const regex = /(\\?|&)loadExample(&|$)/;\r\n  if (regex.test(window.location.search)) {\r\n    const data = await import(\"../example/烟雨.json\");\r\n    resetGlobalData(data.default);\r\n  }\r\n}\r\n\r\nexport { loadExample };\r\n","import { useEffect } from \"react\";\r\nimport Editor from \"./view/Editor\";\r\nimport globalStore, { GlobalContext } from \"./store/global\";\r\nimport store from \"./store/global\";\r\nimport { loadExample } from \"./util/load-example\";\r\n\r\n// ENHANCE: 替换掉antd组件库。。一堆莫名其妙的毛病\r\nfunction App() {\r\n  useEffect(() => {\r\n    loadExample();\r\n  }, []);\r\n  return (\r\n    <GlobalContext.Provider value={globalStore}>\r\n      <Editor></Editor>\r\n    </GlobalContext.Provider>\r\n  );\r\n}\r\nstore.tonedata = {}\r\nstore.beatdata = {}\r\nstore.speeddata = {}\r\nstore.page = 1\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n// import \"antd/dist/antd.css\";\r\nimport App from \"./App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport \"./index.css\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"HelpModal_list__jvqd7\",\"listItem\":\"HelpModal_listItem__1LT1r\",\"kbd\":\"HelpModal_kbd__10-uc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"popover\":\"PopoverOnSvg_popover__34WrV\",\"arrow\":\"PopoverOnSvg_arrow__3TVPU\",\"content\":\"PopoverOnSvg_content__diMkp\",\"header\":\"PopoverOnSvg_header__1LkMw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttonGroup\":\"EditableContent_buttonGroup__3CYtX\",\"button\":\"EditableContent_button__38O1R\",\"menu\":\"EditableContent_menu__1dXQb\",\"menuItem\":\"EditableContent_menuItem__2D_1f\"};"],"sourceRoot":""}