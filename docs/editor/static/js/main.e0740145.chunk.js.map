{"version":3,"sources":["view/Editor/index.module.css","view/Canvas/index.module.css","view/Notation/index.module.css","store/state.js","store/history.js","util/notation.js","util/paragraph.js","util/version.js","util/editor.js","util/placement.js","store/global.js","util/tone-convert.js","util/dom-to-image.js","util/file.js","menu/editor.js","view/Canvas/index.js","view/ConfigModal/index.js","component/PopoverOnSvg/container.js","component/PopoverOnSvg/index.js","component/EditableContent/index.js","view/Row/index.js","util/html-escape.js","view/Text/index.js","view/Header/LeftInfoBlock/index.js","view/Header/RightInfoBlock/index.js","view/Header/Title/index.js","view/Header/index.js","view/HelpModal/index.js","menu/paragraph.js","menu/notation.js","view/Notation/index.js","view/Paragraph/index.js","view/Editor/index.js","util/load-example.js","App.js","reportWebVitals.js","index.js","view/HelpModal/index.module.css","component/PopoverOnSvg/index.module.css","component/EditableContent/index.module.css"],"names":["module","exports","globalState","observable","selectedNotationKey","lastSelectedNotationKey","shouldNotationBlurAfterClick","tieSourceKey","helpDialogVisible","configDialogVisible","clipboardContent","storeHistory","cursor","_isEqual","objA","objB","cacheSet","Set","_isCommonObject","obj","Promise","Map","WeakMap","WeakSet","some","c","_deepEqual","obj1","obj2","has","add","keys1","Object","keys","keys2","length","every","key","go","span","newCursor","Math","min","max","assign","globalStore","executeAction","actionFunc","args","apply","this","current","toJS","splice","wrappedAction","name","func","realArgs","bind","undefined","shift","action","runInWrappedAction","runInAction","call","unwrappedAction","notations","notes","isNote","notationOrNote","includes","note","createNotation","initial","n","type","String","random","octave","dotted","underline","breakUnderline","prefixSups","topDecorators","tieTo","cloneNotation","notation","origin","JSON","parse","stringify","createParagraph","p","alignJustify","createParagraphWithNotations","N","initialData","version","canvasWidth","canvasHeight","defaultFontSize","defaultSubFontSize","title","tone","marginHorizontal","marginTop","gapAfterTitle","gapAfterHeader","gapBetweenParagraph","gapBetweenNotation","beat","speed","authors","getDefaultGlobalData","getDefaultGlobalDataWidthNotations","d","paragraphs","findParagraphAndNotation","res","store","i","notationIndex","findIndex","paragraph","paragraphIndex","canvas","context2D","defaultFontFamily","measureSvgEl","measureTextEl","resetGlobalData","globalData","state","transaction","remove","GlobalContext","React","createContext","_calcTextWidth","fontSize","text","document","createElement","getContext","window","getComputedStyle","body","fontFamily","font","_initializeCanvas","measureText","width","_calcTextBox","createElementNS","style","visibility","appendChild","textContent","getBBox","_hasTie","nn","placement","maxContentWidth","minTieHeight","maxTieHeight","maxTieBezierOffset","underlineStepOffsetY","underlineInitialOffsetY","xHeight","octaveStepOffsetY","octaveInitialOffsetAbove","octaveInitialOffsetBelow","titleOffsetY","headerOffsetY","leftInfoBlockHeight","titleOffset","leftInfoBlockOffset","rightInfoBlockOffset","baseFontData","data","xWidth","height","baseSubFontData","subXHeight","subXWidth","calcTextWidth","calcSubTextWidth","calcParagraphContentHeight","noteHeightMap","map","octaveOffsetY","supOffsetY","offsets","noteOffsetTop","noteOffsetBottom","push","oc","underlineOffsetY","octaveInitialOffsetY","abs","octaveOffsetYAbove","topDecoratorOffset","maxOffsetY","minOffsetY","calcNotationHeight","aboveOffsetMap","calcNotationAboveOffset","belowOffsetMap","v","calcParagraphAboveOffset","reduce","prev","curr","calcNotationPrefixOffset","prefixes","join","octaveOffset","calcNotationWidth","noteWidth","noteToLevelMap","levelToNoteMap","bumpSharpToLevelMap","levelToBumpSharpMap","toneToLevelMap","C","D","E","F","G","A","B","convertTone","deltaVolume","forEach","trunc","newLevel","next","filter","unshift","convertToneTo","destTone","split","at","startsWith","util","escape","string","replace","parseExtension","mimeType","url","extension","toLowerCase","WOFF","JPEG","woff","woff2","ttf","eot","png","jpg","jpeg","gif","tiff","svg","mimes","dataAsUrl","content","isDataUrl","search","canvasToBlob","toBlob","resolve","binaryString","atob","toDataURL","binaryArray","Uint8Array","charCodeAt","Blob","resolveUrl","baseUrl","doc","implementation","createHTMLDocument","base","head","a","href","getAndEncode","TIMEOUT","domtoimage","impl","options","cacheBust","test","Date","getTime","placeholder","request","XMLHttpRequest","onreadystatechange","done","ontimeout","timeout","responseType","open","send","imagePlaceholder","readyState","status","encoder","FileReader","onloadend","result","readAsDataURL","response","fail","message","console","error","uid","index","fourRandomChars","pow","toString","slice","delay","ms","arg","setTimeout","asArray","arrayLike","array","escapeXhtml","makeImage","uri","reject","image","Image","onload","onerror","src","node","leftBorder","px","rightBorder","scrollWidth","topBorder","bottomBorder","scrollHeight","match","exec","styleProperty","value","getPropertyValue","parseFloat","newUtil","inliner","URL_REGEX","inlineAll","get","nothingToInline","then","readUrls","urls","inline","shouldProcess","dataUrl","RegExp","urlAsRegex","newInliner","fontFaces","resolveAll","readAll","webFonts","all","webFont","cssStrings","styleSheets","cssRules","sheet","e","log","rule","CSSRule","FONT_FACE_RULE","rules","newWebFont","webFontRule","parentStyleSheet","cssText","newFontFaces","images","Element","inlineBackground","HTMLImageElement","newImage","childNodes","child","background","inlined","setProperty","getPropertyPriority","element","newImages","dpi","devicePixelRatio","defaultOptions","toSvg","toPng","draw","toJpeg","quality","toPixelData","getImageData","copyOptions","cloneNode","embedFonts","inlineImages","clone","bgcolor","backgroundColor","property","setAttribute","XMLSerializer","serializeToString","xhtml","foreignObject","makeSvgDataUri","domNode","scale","ctx","fillStyle","fillRect","newCanvas","drawImage","root","HTMLCanvasElement","original","children","cloneChildrenInOrder","parent","childClone","cloneChildren","cloneStyle","clonePseudoElements","copyUserInput","fixSvg","copyStyle","source","target","copyProperties","clonePseudoElement","className","styleElement","formatPseudoElementStyle","selector","formatCssText","formatCssProperties","createTextNode","formatProperty","HTMLTextAreaElement","innerHTML","HTMLInputElement","SVGElement","SVGRectElement","attribute","getAttribute","processClone","styleNode","read","file","reader","readAsText","saveFile","downloadLink","download","URL","createObjectURL","click","revokeObjectURL","SubMenu","Menu","handleOpenFile","ev","loadFile","files","handleExportFile","querySelector","handleEditMenu","handleClick","handleKeyPress","inputKey","shiftKey","ctrl","ctrlKey","indexOf","nextNotation","prevNotation","newNotation","nextParagraph","prevParagraph","currNotation","currParagraph","preventDefault","cloneParagraph","input","accept","onchange","fileMenu","Item","icon","PlusOutlined","onClick","FolderOpenOutlined","onChange","opacity","left","top","position","SaveOutlined","editMenu","UndoOutlined","RedoOutlined","MenuUnfoldOutlined","HighlightOutlined","convertMenu","observer","props","id","xmlns","Styles","onContextMenu","ImmediateNumberConfigInput","propertyName","handleChange","Number","ImmediateNumberConfigItem","label","ConfigModal","container","visible","onVisibleChange","handleClose","useCallback","resetConfig","onCancel","footer","labelAlign","labelCol","Group","textAlign","borderLeft","borderRight","pointerEvents","disabled","dirty","memoizedRect","x","y","getPopoverContainer","addEventListener","getContainerOffset","rect","getBoundingClientRect","PopoverOnSvg","renderContent","renderPopover","darkMode","globalClassName","offset","trigger","autoHide","showArrow","onVisibilityChange","triggerBoxRef","useRef","bottom","right","initFlagRef","triggerRef","popoverRef","useState","innerVisible","setInnerVisible","lastContextCord","setLastContextCord","forceUpdate","popoverClassNames","popover","Boolean","arrowClassNames","arrow","headerClassNames","header","offsetX","offsetY","mergedStyles","transform","arrowStyles","makeOffset","changeVisibility","shouldShow","newVisibility","handleContextMenu","pageX","pageY","useEffect","handler","parentElement","button","removeEventListener","box","minHeight","endsWith","ref","onMouseEnter","onMouseLeave","createPortal","defaultProps","memo","EditableContent","initialValue","inputType","overlay","popoverProps","inputValue","setInputValue","popoverVisible","setPopoverVisible","useImperativeHandle","showPopover","hidePopover","handleVisibilityChange","handleInput","handleConfirm","handleHideContextMenu","handleCancel","renderTextInputPopover","autoFocus","onPressEnter","buttonGroup","renderSelectionPopover","menu","op","option","menuItem","forwardRef","Row","editable","escapeHtml","Text","dominantBaseline","stroke","fontWeight","fill","dangerouslySetInnerHTML","__html","tones","t","handleChangeTone","handleChangeSpeed","handleChangeBeat","parseInt","P","textAnchor","x1","y1","x2","y2","authorContextMenu","DeleteOutlined","blockContextMenu","handleSelectMenu","find","m","handleSelectBlockMenu","handleChangeAuthor","Modal","confirm","okText","cancelText","onOk","author","handleChangeTitle","Header","KeyboardDescItem","kbd","desc","listItem","HelpModal","list","getParagraphMenuOptions","handleMenu","idx","para","EnterOutlined","danger","getNotationContextMenu","hasTie","tieDesc","separator","minWidth","StopOutlined","RadiusSettingOutlined","Notation","sourceNotation","sourceParagraph","warn","underlineOffset","octaveInitialOffset","octaveStepOffset","selectedNotation","sups","s","renderPrefixSups","renderNote","cx","cy","r","len","isInteger","Array","composeArray","widthCache","itemFlexOffset","realWidth","calcParagraphWidth","noteOffsets","_","accumulate","renderUnderLine","fromIndex","toIndex","renderParagraphMask","ties","offsetMap","j","set","bezierX1","bezierX2","bezierX4","bezierX3","bezierY","renderTie","renderTies","lines","helpMap","baseOffsetY","renderUnderlines","heightCache","handleChangeConfigModalVisibility","handleChangeHelpModalVisibility","headerWrapper","FileTextOutlined","EditOutlined","RetweetOutlined","SettingOutlined","QuestionOutlined","location","default","App","loadExample","Provider","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.e0740145.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"headerWrapper\":\"Editor_headerWrapper__2rEBR\",\"header\":\"Editor_header__2Qcr4\",\"container\":\"Editor_container__3rhfS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"svg\":\"Canvas_svg__2w1z4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"selectedNotation\":\"Notation_selectedNotation__3wsjJ\"};","import { observable } from \"mobx\";\n\n// 非持久化全局状态\nlet globalState = observable({\n  // 当前选中的符号\n  selectedNotationKey: null,\n  // 记录上次选中的符号，之后可恢复焦点\n  lastSelectedNotationKey: null,\n  // 当前点击事件是否应该让符号失去焦点。应该在符号自身和菜单等点击事件中将其置为false\n  shouldNotationBlurAfterClick: true,\n  // 正在操作的连音线起点\n  tieSourceKey: null,\n  // 帮助弹窗是否可见\n  helpDialogVisible: false,\n  // 配置项弹窗是否可见\n  configDialogVisible: false,\n  // 复制剪贴的内容\n  clipboardContent: null,\n});\n\nexport default globalState;\n","import { action, runInAction, toJS } from \"mobx\";\nimport globalStore from \"./global\";\n\nconst storeHistory = [];\nlet cursor = -1;\n\n// ENHANCE: 使用性能更好的方案\n// 比较历史记录\nfunction _isEqual(objA, objB) {\n  const cacheSet = new Set();\n  function _isCommonObject(obj) {\n    if (typeof obj !== \"object\" || obj === null) {\n      return false;\n    }\n    const unRegularConstructors = [Promise, Map, Set, WeakMap, WeakSet];\n    return !unRegularConstructors.some((c) => obj instanceof c);\n  }\n  function _deepEqual(obj1, obj2) {\n    if (!_isCommonObject(obj1) || !_isCommonObject(obj2)) {\n      return obj1 === obj2;\n    }\n    if (obj1 === obj2) {\n      return true;\n    }\n    if (cacheSet.has(obj1) || cacheSet.has(obj2)) {\n      return false;\n    }\n    cacheSet.add(obj1);\n    cacheSet.add(obj2);\n    const keys1 = Object.keys(obj1);\n    const keys2 = Object.keys(obj2);\n    if (keys1.length !== keys2.length) {\n      return false;\n    }\n    return keys1.every((key) => _deepEqual(obj1[key], obj2[key]));\n  }\n  return _deepEqual(objA, objB);\n}\n\n// 在历史记录中漫游\nfunction go(span) {\n  const newCursor = Math.min(\n    Math.max(0, cursor + span),\n    storeHistory.length - 1\n  );\n  if (newCursor === cursor) {\n    return;\n  }\n  cursor = newCursor;\n  Object.assign(globalStore, storeHistory[newCursor]);\n}\n\nfunction clearHistory() {\n  storeHistory.length = 0;\n  cursor = -1;\n}\n\n// 包装mobx的action以实现历史记录\nfunction executeAction(actionFunc, ...args) {\n  actionFunc.apply(this, args);\n  const current = toJS(globalStore);\n  if (!_isEqual(storeHistory[cursor], current)) {\n    storeHistory[++cursor] = current;\n    storeHistory.length = cursor + 1;\n    if (storeHistory.length > 256) {\n      storeHistory.splice(0, 256 - storeHistory.length);\n    }\n  }\n}\nfunction wrappedAction(...args) {\n  let name, func;\n  if (typeof args[0] === \"function\") {\n    func = args[0];\n  } else {\n    name = args[0];\n    func = args[1];\n  }\n  const realArgs = [name, executeAction.bind(this, func)];\n  if (name === undefined) {\n    realArgs.shift();\n  }\n  return action.apply(this, realArgs);\n}\nfunction runInWrappedAction(func) {\n  runInAction(() => {\n    executeAction.call(this, func);\n  });\n}\n\n// 不需要记录历史记录的时候直接使用原action\nconst unwrappedAction = action;\nconst runInUnwrappedAction = runInAction;\n\nexport {\n  go,\n  clearHistory,\n  wrappedAction,\n  runInWrappedAction,\n  unwrappedAction,\n  runInUnwrappedAction,\n};\n","import { toJS } from \"mobx\";\n\nconst notations = {\n  zero: \"0\",\n  do: \"1\",\n  re: \"2\",\n  mi: \"3\",\n  fa: \"4\",\n  sol: \"5\",\n  la: \"6\",\n  si: \"7\",\n  extend: \"─\",\n  separator: \"│\",\n};\nconst notes = [\n  notations.zero,\n  notations.do,\n  notations.re,\n  notations.mi,\n  notations.fa,\n  notations.sol,\n  notations.la,\n  notations.si,\n];\nconst separators = [\"│\", \"‖\"];\n\nfunction isNote(notationOrNote) {\n  return notes.includes(notationOrNote?.note || notationOrNote);\n}\nfunction isPauseNote(notationOrNote) {\n  return notations.zero === (notationOrNote?.note || notationOrNote);\n}\nfunction isSeparator(notationOrNote) {\n  return separators.includes(notationOrNote?.note || notationOrNote);\n}\n// 创建符号\nfunction createNotation(initial) {\n  const n = {\n    type: \"notation\",\n    key: `n_${String(Math.random())}`,\n    note: \"0\",\n    octave: 0,\n    dotted: false,\n    underline: 0,\n    breakUnderline: false,\n    prefixSups: [],\n    topDecorators: [],\n    tieTo: null,\n  };\n  if (initial) {\n    Object.assign(n, initial);\n  }\n  return n;\n}\nfunction cloneNotation(notation) {\n  const origin = JSON.parse(JSON.stringify(toJS(notation)));\n  delete origin.key;\n  const n = createNotation(origin);\n  return n;\n}\n\nexport {\n  notations,\n  isNote,\n  isPauseNote,\n  isSeparator,\n  createNotation,\n  cloneNotation,\n};\n","import { toJS } from \"mobx\";\nimport { cloneNotation, createNotation, notations as N } from \"./notation\";\n\n// 新建段落\nfunction createParagraph(initial) {\n  const p = {\n    type: \"paragraph\",\n    key: `p_${String(Math.random())}`,\n    // 符号列表\n    notations: [],\n    // 是否两端对齐\n    alignJustify: null,\n  };\n  if (initial) {\n    Object.assign(p, initial);\n  }\n  return p;\n}\nfunction createParagraphWithNotations() {\n  return createParagraph({\n    notations: [\n      createNotation({ note: \"0\" }),\n      createNotation({ note: \"0\" }),\n      createNotation({ note: \"0\" }),\n      createNotation({ note: \"0\" }),\n      createNotation({ note: N.separator }),\n    ],\n  });\n}\nfunction cloneParagraph(paragraph) {\n  const origin = JSON.parse(JSON.stringify(toJS(paragraph)));\n  delete origin.key;\n  origin.notations = paragraph.notations.map((n) => cloneNotation(n));\n  return createParagraph(origin);\n}\n\nexport { createParagraph, createParagraphWithNotations, cloneParagraph };\n","const VERSION = 1;\n\nexport { VERSION };\n","import { remove, transaction } from \"mobx\";\nimport state from \"../store/state\";\nimport store from \"../store/global\";\nimport { clearHistory, unwrappedAction } from \"../store/history\";\nimport { createParagraphWithNotations } from \"../util/paragraph\";\nimport { VERSION } from \"./version\";\n\nconst initialData = {\n  version: VERSION,\n  canvasWidth: 896,\n  canvasHeight: 1024,\n  defaultFontSize: 16,\n  defaultSubFontSize: 12,\n  title: \"无标题\",\n  tone: \"C\",\n  marginHorizontal: 64,\n  marginTop: 32,\n  gapAfterTitle: 16,\n  gapAfterHeader: 32,\n  gapBetweenParagraph: 32,\n  gapBetweenNotation: 16,\n  beat: [4, 4],\n  speed: 75,\n  authors: [\"佚名  作词\", \"简谱编辑器  制谱\"],\n  notations: [],\n};\n\nfunction getDefaultGlobalData() {\n  return JSON.parse(JSON.stringify(initialData));\n}\nfunction getDefaultGlobalDataWidthNotations() {\n  const d = getDefaultGlobalData();\n  d.paragraphs = [createParagraphWithNotations()];\n  return d;\n}\n\n// 根据key查找符号在全局记录中的位置\nfunction findParagraphAndNotation(key) {\n  let res = {};\n  const paras = store.paragraphs || [];\n  paras.some((p, i) => {\n    const notationIndex = (p.notations || []).findIndex((n) => n.key === key);\n    if (notationIndex !== -1) {\n      res.notation = p.notations[notationIndex];\n      res.notationIndex = notationIndex;\n      res.paragraph = p;\n      res.paragraphIndex = i;\n      return true;\n    }\n    return false;\n  });\n  return res;\n}\n\nconst resetGlobalData = unwrappedAction((globalData) => {\n  if (!globalData) {\n    globalData = getDefaultGlobalDataWidthNotations();\n  }\n  state.lastSelectedNotationKey = state.selectedNotationKey = state.tieSourceKey = null;\n  clearHistory();\n  transaction(() => {\n    for (const key of Object.keys(store)) {\n      remove(store, key);\n    }\n    Object.assign(store, globalData);\n  });\n});\n\nexport {\n  getDefaultGlobalData,\n  findParagraphAndNotation,\n  getDefaultGlobalDataWidthNotations,\n  resetGlobalData,\n};\n","import { observable } from \"mobx\";\nimport store from \"../store/global\";\n\n// ENHANCE: 通过mobx的computed机制缓存一些计算值\n\nlet canvas, context2D, defaultFontFamily;\nlet measureSvgEl, measureTextEl;\n\nfunction _initializeCanvas(fontSize) {\n  if (!canvas) {\n    canvas = document.createElement(\"canvas\");\n    context2D = canvas.getContext(\"2d\");\n    defaultFontFamily = window.getComputedStyle(document.body).fontFamily;\n  }\n  context2D.font = `${\n    fontSize || store.defaultFontSize\n  }px ${defaultFontFamily}`;\n}\n\nfunction _calcTextWidth(fontSize, text) {\n  _initializeCanvas(fontSize);\n  return context2D.measureText(text).width;\n}\n\nfunction _calcTextBox(fontSize, text) {\n  if (!measureSvgEl) {\n    measureSvgEl = document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"svg\"\n    );\n    measureTextEl = document.createElementNS(\n      \"http://www.w3.org/2000/svg\",\n      \"text\"\n    );\n    measureTextEl.style.visibility = \"hidden\";\n    measureSvgEl.appendChild(measureTextEl);\n    document.body.appendChild(measureSvgEl);\n  }\n  measureTextEl.style.fontSize = fontSize + \"px\";\n  measureTextEl.textContent = text;\n  return measureTextEl.getBBox();\n}\n\n// 判断段落中的音符是否有连音线\nfunction _hasTie(paragraph) {\n  const notations = paragraph?.notations || [];\n  return notations.some(\n    (n, i) => n.tieTo && notations.findIndex((nn) => nn.key === n.tieTo) > i\n  );\n}\n\nconst placement = observable({\n  get maxContentWidth() {\n    return Math.max(store.canvasWidth - store.marginHorizontal * 2, 0);\n  },\n  get minTieHeight() {\n    return 8;\n  },\n  get maxTieHeight() {\n    return 20;\n  },\n  get maxTieBezierOffset() {\n    return 25;\n  },\n  get underlineStepOffsetY() {\n    return 3;\n  },\n  get underlineInitialOffsetY() {\n    return this.xHeight / 2 - 3;\n  },\n  get octaveStepOffsetY() {\n    return 5;\n  },\n  get octaveInitialOffsetAbove() {\n    return placement.xHeight / 2 + 2;\n  },\n  get octaveInitialOffsetBelow() {\n    return placement.xHeight / 2 - 2;\n  },\n  get titleOffsetY() {\n    const titleHeight = 32;\n    return store.marginTop + titleHeight + store.gapAfterTitle;\n  },\n  get headerOffsetY() {\n    const leftInfoBlockHeight = this.xHeight * 2;\n    const titleOffset = this.titleOffsetY;\n    const leftInfoBlockOffset = titleOffset + leftInfoBlockHeight;\n    const rightInfoBlockOffset =\n      titleOffset + this.xHeight * store.authors.length;\n    return (\n      Math.max(titleOffset, leftInfoBlockOffset, rightInfoBlockOffset) +\n      store.gapAfterHeader\n    );\n  },\n  get baseFontData() {\n    const data = _calcTextBox(store.defaultFontSize, \"x\");\n    return {\n      xWidth: data.width,\n      xHeight: data.height,\n    };\n  },\n  get baseSubFontData() {\n    const data = _calcTextBox(store.defaultSubFontSize, \"x\");\n    return {\n      xWidth: data.width,\n      xHeight: data.height,\n    };\n  },\n  get xHeight() {\n    return this.baseFontData.xHeight;\n  },\n  get xWidth() {\n    return this.baseFontData.xWidth;\n  },\n  get subXHeight() {\n    return this.baseSubFontData.xHeight;\n  },\n  get subXWidth() {\n    return this.baseSubFontData.xWidth;\n  },\n});\n\nconst calcTextWidth = _calcTextWidth.bind(null, store.defaultFontSize);\nconst calcSubTextWidth = _calcTextWidth.bind(null, store.defaultSubFontSize);\n\n// 计算段落占的空间高\nfunction calcParagraphHeight(paragraph) {\n  return calcParagraphContentHeight(paragraph) + store.gapBetweenParagraph;\n}\n// 计算段落内容的高度\nfunction calcParagraphContentHeight(paragraph) {\n  const notations = paragraph.notations || [];\n  if (notations.length === 0) {\n    return placement.xHeight;\n  }\n  let tieHeight = 0;\n  if (_hasTie(paragraph)) {\n    // FIXME: 应该计算连音线高度\n    // tieHeight = placement.maxTieHeight;\n  }\n  // 段落高度不是最高的音符的高度，而是上边偏移最大的音符的上部分偏移量+下边偏移最\n  // 大的音符的下部分偏移量\n  const noteHeightMap = notations.map((n) => calcNotationHeight(n));\n  const aboveOffsetMap = notations.map((n) => calcNotationAboveOffset(n));\n  const belowOffsetMap = noteHeightMap.map((v, i) => v - aboveOffsetMap[i]);\n  const maxNoteOffset =\n    Math.max(...belowOffsetMap) + Math.max(...aboveOffsetMap);\n  return tieHeight + maxNoteOffset;\n}\n\n// 计算一行中所有音符的宽度和\nfunction calcParagraphWidth(paragraph) {\n  const notations = paragraph.notations || [];\n  if (notations.length === 0) {\n    return 0;\n  }\n  return (\n    notations\n      .map((n) => calcNotationWidth(n))\n      .reduce((prev, curr) => prev + curr, 0) - store.gapBetweenNotation\n  );\n}\n\n// 计算段落中的音符中心以上偏移量的最大值\nfunction calcParagraphAboveOffset(paragraph) {\n  const notations = paragraph.notations || [];\n  if (notations.length === 0) {\n    return placement.xHeight / 2;\n  }\n  let tieHeight = 0;\n  if (_hasTie(paragraph)) {\n    // FIXME: 应该计算连音线高度\n    // tieHeight = placement.maxTieHeight;\n  }\n  const notationOffset = notations\n    .map((n) => calcNotationAboveOffset(n))\n    .reduce((prev, curr) => Math.max(prev, curr), placement.xHeight / 2);\n  return notationOffset + tieHeight;\n}\n\n// 计算音符中心位置左边的宽度\nfunction calcNotationPrefixOffset(notation) {\n  const prefixes = notation.prefixSups || [];\n  return calcSubTextWidth(prefixes.join(\"\")) + prefixes.length * 2;\n}\n\n// 计算音符中心位置以上的高度\nfunction calcNotationAboveOffset(notation) {\n  const offsets = [0];\n  const noteOffsetTop = placement.xHeight / 2;\n  offsets.push(noteOffsetTop);\n  let octaveOffset = 0;\n  if (notation.octave > 0) {\n    octaveOffset =\n      placement.octaveInitialOffsetAbove +\n      placement.octaveStepOffsetY * Math.abs(notation.octave);\n  }\n  offsets.push(octaveOffset);\n  const topDecoratorOffset =\n    octaveOffset +\n    placement.subXHeight * (notation.topDecorators?.length | 0) -\n    2;\n  offsets.push(topDecoratorOffset);\n  return Math.max(...offsets);\n}\n\n// 计算音符总体宽度\nfunction calcNotationWidth(notation) {\n  const noteWidth = calcTextWidth(notation.note) + store.gapBetweenNotation;\n  const dotWidth = 8;\n  const prefixWidth = calcNotationPrefixOffset(notation);\n  return prefixWidth + noteWidth + (notation.dotted ? dotWidth : 0);\n}\n\n// 计算音符自身高度，包含其装饰符，八度点等，不包括连音符\nfunction calcNotationHeight(notation) {\n  // 以音符中心为基准线，分别计算正方向和负方向的最大偏移，二者之和为音符自身高度\n  // 0保证取正方向偏移最值时不会取到负值，负方向亦然\n  const offsets = [0];\n  let noteOffsetTop = placement.xHeight / 2,\n    noteOffsetBottom = -placement.xHeight / 2,\n    octaveOffsetY,\n    supOffsetY;\n  offsets.push(noteOffsetTop, noteOffsetBottom);\n  const oc = notation.octave | 0;\n  const underlineOffsetY =\n    notation.underline > 0\n      ? placement.underlineInitialOffsetY +\n        placement.underlineStepOffsetY * (notation.underline | 0)\n      : 0;\n  offsets.push(underlineOffsetY);\n  const octaveInitialOffsetY =\n    notation.octave > 0\n      ? -placement.octaveInitialOffsetAbove\n      : placement.octaveInitialOffsetBelow + underlineOffsetY;\n  if (oc > 0) {\n    octaveOffsetY = octaveInitialOffsetY - 5 * Math.abs(oc);\n  } else if (oc < 0) {\n    octaveOffsetY = octaveInitialOffsetY + 5 * Math.abs(oc);\n  } else {\n    octaveOffsetY = 0;\n  }\n  offsets.push(octaveOffsetY);\n  // 前置上标的top偏移，其定位基准为字符中心，y位置为(-P.subXHeight + 4)，再\n  // 加上基准以上的半个字符的高度，得到前置上标的最大纵向偏移\n  supOffsetY = notation.prefixSups?.length ? placement.subXHeight - 4 : 0;\n  offsets.push(supOffsetY);\n  // 顶部装饰符在高八度点之上\n  let octaveOffsetYAbove = 0;\n  if (notation.octave > 0) {\n    octaveOffsetYAbove =\n      placement.octaveInitialOffsetAbove -\n      placement.octaveStepOffsetY * notation.octave;\n  }\n  const topDecoratorOffset =\n    octaveOffsetYAbove -\n    placement.subXHeight * (notation.topDecorators?.length | 0) -\n    2;\n  offsets.push(topDecoratorOffset);\n  const maxOffsetY = Math.max(...offsets);\n  const minOffsetY = Math.min(...offsets);\n  return maxOffsetY - minOffsetY;\n}\n\nexport default placement;\nexport {\n  calcNotationWidth,\n  calcNotationPrefixOffset,\n  calcNotationAboveOffset,\n  calcParagraphWidth,\n  calcParagraphHeight,\n  calcParagraphContentHeight,\n  calcParagraphAboveOffset,\n  calcTextWidth,\n  calcSubTextWidth,\n};\n","import React from \"react\";\nimport { observable } from \"mobx\";\nimport { getDefaultGlobalDataWidthNotations } from \"../util/editor\";\n\n// 全局数据及配置，需要持久化\nconst globalStore = observable(getDefaultGlobalDataWidthNotations());\n\nconst GlobalContext = React.createContext(globalStore);\n\nexport default globalStore;\nexport { GlobalContext };\n","import store from \"../store/global\";\nimport { wrappedAction } from \"../store/history\";\nimport { isNote, isPauseNote } from \"./notation\";\n\n// 音符到音数\nconst noteToLevelMap = {\n  1: 0,\n  2: 2,\n  3: 4,\n  4: 5,\n  5: 7,\n  6: 9,\n  7: 11,\n};\n// 音数到音符\nconst levelToNoteMap = {\n  0: 1,\n  1: 1,\n  2: 2,\n  3: 2,\n  4: 3,\n  5: 4,\n  6: 4,\n  7: 5,\n  8: 5,\n  9: 6,\n  10: 7,\n  11: 7,\n};\n// 升降到音数\nconst bumpSharpToLevelMap = {\n  \"♭\": -1,\n  \"♯\": 1,\n};\n// 音数到升降\nconst levelToBumpSharpMap = {\n  1: \"♯\",\n  3: \"♯\",\n  6: \"♯\",\n  8: \"♯\",\n  10: \"♭\",\n};\n\nconst toneToLevelMap = {\n  C: 0,\n  D: 2,\n  E: 4,\n  F: 5,\n  G: 7,\n  A: 9,\n  B: 11,\n};\n\n/**\n * 整体转调\n * @param {number} deltaVolume 要调整的音数\n */\nconst convertTone = wrappedAction(function (deltaVolume) {\n  deltaVolume = deltaVolume | 0;\n  store.paragraphs.forEach((p) => {\n    p.notations.forEach((n) => {\n      if (isNote(n) && !isPauseNote(n)) {\n        n.octave += Math.trunc(deltaVolume / 12);\n        let newLevel =\n          noteToLevelMap[n.note] +\n          (deltaVolume % 12) +\n          (n.prefixSups || []).reduce(\n            (prev, next) => prev + (bumpSharpToLevelMap[next] | 0),\n            0\n          );\n        if (newLevel >= 12) {\n          n.octave += 1;\n          newLevel -= 12;\n        } else if (newLevel < 0) {\n          n.octave -= 1;\n          newLevel += 12;\n        }\n        n.note = String(levelToNoteMap[newLevel]);\n        n.prefixSups = (n.prefixSups || []).filter(\n          (c) => c !== \"♯\" && c !== \"♭\"\n        );\n        if (levelToBumpSharpMap[newLevel]) {\n          n.prefixSups.unshift(levelToBumpSharpMap[newLevel]);\n        }\n      }\n    });\n  });\n});\n\n// 转到1 = *\nconst convertToneTo = wrappedAction((destTone) => {\n  let deltaVolume = -(\n    toneToLevelMap[destTone.split(\"\").at(-1)] -\n    toneToLevelMap[store.tone.split(\"\").at(-1)]\n  );\n  if (destTone.startsWith(\"♭\") || store.tone.startsWith(\"♯\")) {\n    deltaVolume -= 1;\n  }\n  if (destTone.startsWith(\"♯\") || store.tone.startsWith(\"♭\")) {\n    deltaVolume += 1;\n  }\n  convertTone(deltaVolume);\n  store.tone = destTone;\n});\n\nexport { convertTone, convertToneTo };\n","// COPIED FROM: https://github.com/tsayen/dom-to-image\n// 由于原仓库不支持高dpi改良了一下。上游合并和可引入库依赖\n\nvar util = newUtil();\nvar inliner = newInliner();\nvar fontFaces = newFontFaces();\nvar images = newImages();\nvar dpi = window.devicePixelRatio || 1;\n\n// Default impl options\nvar defaultOptions = {\n  // Default is to fail on error, no placeholder\n  imagePlaceholder: undefined,\n  // Default cache bust is false, it will use the cache\n  cacheBust: false,\n};\n\nvar domtoimage = {\n  toSvg: toSvg,\n  toPng: toPng,\n  toJpeg: toJpeg,\n  toBlob: toBlob,\n  toPixelData: toPixelData,\n  impl: {\n    fontFaces: fontFaces,\n    images: images,\n    util: util,\n    inliner: inliner,\n    options: {},\n  },\n};\n\n/**\n   * @param {Node} node - The DOM Node object to render\n   * @param {Object} options - Rendering options\n   * @param {Function} options.filter - Should return true if passed node should be included in the output\n   *          (excluding node means excluding it's children as well). Not called on the root node.\n   * @param {String} options.bgcolor - color for the background, any valid CSS color value.\n   * @param {Number} options.width - width to be applied to node before rendering.\n   * @param {Number} options.height - height to be applied to node before rendering.\n   * @param {Object} options.style - an object whose properties to be copied to node's style before rendering.\n   * @param {Number} options.quality - a Number between 0 and 1 indicating image quality (applicable to JPEG only),\n              defaults to 1.0.\n   * @param {String} options.imagePlaceholder - dataURL to use as a placeholder for failed images, default behaviour is to fail fast on images we can't fetch\n   * @param {Boolean} options.cacheBust - set to true to cache bust by appending the time to the request url\n   * @return {Promise} - A promise that is fulfilled with a SVG image data URL\n   * */\nfunction toSvg(node, options) {\n  options = options || {};\n  copyOptions(options);\n  return Promise.resolve(node)\n    .then(function (node) {\n      return cloneNode(node, options.filter, true);\n    })\n    .then(embedFonts)\n    .then(inlineImages)\n    .then(applyOptions)\n    .then(function (clone) {\n      return makeSvgDataUri(\n        clone,\n        (options.width || util.width(node)) * dpi,\n        options.height || util.height(node) * dpi\n      );\n    });\n\n  function applyOptions(clone) {\n    if (options.bgcolor) clone.style.backgroundColor = options.bgcolor;\n\n    if (options.width) clone.style.width = options.width + \"px\";\n    if (options.height) clone.style.height = options.height + \"px\";\n\n    if (options.style)\n      Object.keys(options.style).forEach(function (property) {\n        clone.style[property] = options.style[property];\n      });\n\n    return clone;\n  }\n}\n\n/**\n * @param {Node} node - The DOM Node object to render\n * @param {Object} options - Rendering options, @see {@link toSvg}\n * @return {Promise} - A promise that is fulfilled with a Uint8Array containing RGBA pixel data.\n * */\nfunction toPixelData(node, options) {\n  return draw(node, options || {}).then(function (canvas) {\n    return canvas\n      .getContext(\"2d\")\n      .getImageData(0, 0, util.width(node) * dpi, util.height(node) * dpi).data;\n  });\n}\n\n/**\n * @param {Node} node - The DOM Node object to render\n * @param {Object} options - Rendering options, @see {@link toSvg}\n * @return {Promise} - A promise that is fulfilled with a PNG image data URL\n * */\nfunction toPng(node, options) {\n  return draw(node, options || {}).then(function (canvas) {\n    return canvas.toDataURL();\n  });\n}\n\n/**\n * @param {Node} node - The DOM Node object to render\n * @param {Object} options - Rendering options, @see {@link toSvg}\n * @return {Promise} - A promise that is fulfilled with a JPEG image data URL\n * */\nfunction toJpeg(node, options) {\n  options = options || {};\n  return draw(node, options).then(function (canvas) {\n    return canvas.toDataURL(\"image/jpeg\", options.quality || 1.0);\n  });\n}\n\n/**\n * @param {Node} node - The DOM Node object to render\n * @param {Object} options - Rendering options, @see {@link toSvg}\n * @return {Promise} - A promise that is fulfilled with a PNG image blob\n * */\nfunction toBlob(node, options) {\n  return draw(node, options || {}).then(util.canvasToBlob);\n}\n\nfunction copyOptions(options) {\n  // Copy options to impl options for use in impl\n  if (typeof options.imagePlaceholder === \"undefined\") {\n    domtoimage.impl.options.imagePlaceholder = defaultOptions.imagePlaceholder;\n  } else {\n    domtoimage.impl.options.imagePlaceholder = options.imagePlaceholder;\n  }\n\n  if (typeof options.cacheBust === \"undefined\") {\n    domtoimage.impl.options.cacheBust = defaultOptions.cacheBust;\n  } else {\n    domtoimage.impl.options.cacheBust = options.cacheBust;\n  }\n}\n\nfunction draw(domNode, options) {\n  return toSvg(domNode, options)\n    .then(util.makeImage)\n    .then(util.delay(100))\n    .then(function (image) {\n      var canvas = newCanvas(domNode);\n      canvas.getContext(\"2d\").drawImage(image, 0, 0);\n      return canvas;\n    });\n\n  function newCanvas(domNode) {\n    var canvas = document.createElement(\"canvas\");\n    var width = options.width || util.width(domNode);\n    var height = options.height || util.height(domNode);\n    canvas.width = width * dpi;\n    canvas.height = height * dpi;\n    canvas.style.width = width + \"px\";\n    canvas.style.height = height + \"px\";\n\n    canvas.getContext(\"2d\").scale(dpi, dpi);\n    if (options.bgcolor) {\n      var ctx = canvas.getContext(\"2d\");\n      ctx.fillStyle = options.bgcolor;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    }\n\n    return canvas;\n  }\n}\n\nfunction cloneNode(node, filter, root) {\n  if (!root && filter && !filter(node)) return Promise.resolve();\n\n  return Promise.resolve(node)\n    .then(makeNodeCopy)\n    .then(function (clone) {\n      return cloneChildren(node, clone, filter);\n    })\n    .then(function (clone) {\n      return processClone(node, clone);\n    });\n\n  function makeNodeCopy(node) {\n    if (node instanceof HTMLCanvasElement)\n      return util.makeImage(node.toDataURL());\n    return node.cloneNode(false);\n  }\n\n  function cloneChildren(original, clone, filter) {\n    var children = original.childNodes;\n    if (children.length === 0) return Promise.resolve(clone);\n\n    return cloneChildrenInOrder(clone, util.asArray(children), filter).then(\n      function () {\n        return clone;\n      }\n    );\n\n    function cloneChildrenInOrder(parent, children, filter) {\n      var done = Promise.resolve();\n      children.forEach(function (child) {\n        done = done\n          .then(function () {\n            return cloneNode(child, filter);\n          })\n          .then(function (childClone) {\n            if (childClone) parent.appendChild(childClone);\n          });\n      });\n      return done;\n    }\n  }\n\n  function processClone(original, clone) {\n    if (!(clone instanceof Element)) return clone;\n\n    return Promise.resolve()\n      .then(cloneStyle)\n      .then(clonePseudoElements)\n      .then(copyUserInput)\n      .then(fixSvg)\n      .then(function () {\n        return clone;\n      });\n\n    function cloneStyle() {\n      copyStyle(window.getComputedStyle(original), clone.style);\n\n      function copyStyle(source, target) {\n        if (source.cssText) target.cssText = source.cssText;\n        else copyProperties(source, target);\n\n        function copyProperties(source, target) {\n          util.asArray(source).forEach(function (name) {\n            target.setProperty(\n              name,\n              source.getPropertyValue(name),\n              source.getPropertyPriority(name)\n            );\n          });\n        }\n      }\n    }\n\n    function clonePseudoElements() {\n      [\":before\", \":after\"].forEach(function (element) {\n        clonePseudoElement(element);\n      });\n\n      function clonePseudoElement(element) {\n        var style = window.getComputedStyle(original, element);\n        var content = style.getPropertyValue(\"content\");\n\n        if (content === \"\" || content === \"none\") return;\n\n        var className = util.uid();\n        clone.className = clone.className + \" \" + className;\n        var styleElement = document.createElement(\"style\");\n        styleElement.appendChild(\n          formatPseudoElementStyle(className, element, style)\n        );\n        clone.appendChild(styleElement);\n\n        function formatPseudoElementStyle(className, element, style) {\n          var selector = \".\" + className + \":\" + element;\n          var cssText = style.cssText\n            ? formatCssText(style)\n            : formatCssProperties(style);\n          return document.createTextNode(selector + \"{\" + cssText + \"}\");\n\n          function formatCssText(style) {\n            var content = style.getPropertyValue(\"content\");\n            return style.cssText + \" content: \" + content + \";\";\n          }\n\n          function formatCssProperties(style) {\n            return util.asArray(style).map(formatProperty).join(\"; \") + \";\";\n\n            function formatProperty(name) {\n              return (\n                name +\n                \": \" +\n                style.getPropertyValue(name) +\n                (style.getPropertyPriority(name) ? \" !important\" : \"\")\n              );\n            }\n          }\n        }\n      }\n    }\n\n    function copyUserInput() {\n      if (original instanceof HTMLTextAreaElement)\n        clone.innerHTML = original.value;\n      if (original instanceof HTMLInputElement)\n        clone.setAttribute(\"value\", original.value);\n    }\n\n    function fixSvg() {\n      if (!(clone instanceof SVGElement)) return;\n      clone.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n\n      if (!(clone instanceof SVGRectElement)) return;\n      [\"width\", \"height\"].forEach(function (attribute) {\n        var value = clone.getAttribute(attribute);\n        if (!value) return;\n\n        clone.style.setProperty(attribute, value);\n      });\n    }\n  }\n}\n\nfunction embedFonts(node) {\n  return fontFaces.resolveAll().then(function (cssText) {\n    var styleNode = document.createElement(\"style\");\n    node.appendChild(styleNode);\n    styleNode.appendChild(document.createTextNode(cssText));\n    return node;\n  });\n}\n\nfunction inlineImages(node) {\n  return images.inlineAll(node).then(function () {\n    return node;\n  });\n}\n\nfunction makeSvgDataUri(node, width, height) {\n  return Promise.resolve(node)\n    .then(function (node) {\n      node.setAttribute(\"xmlns\", \"http://www.w3.org/1999/xhtml\");\n      return new XMLSerializer().serializeToString(node);\n    })\n    .then(util.escapeXhtml)\n    .then(function (xhtml) {\n      return (\n        '<foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">' +\n        xhtml +\n        \"</foreignObject>\"\n      );\n    })\n    .then(function (foreignObject) {\n      return (\n        '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"' +\n        width +\n        '\" height=\"' +\n        height +\n        '\">' +\n        foreignObject +\n        \"</svg>\"\n      );\n    })\n    .then(function (svg) {\n      return \"data:image/svg+xml;charset=utf-8,\" + svg;\n    });\n}\n\nfunction newUtil() {\n  return {\n    escape: escape,\n    parseExtension: parseExtension,\n    mimeType: mimeType,\n    dataAsUrl: dataAsUrl,\n    isDataUrl: isDataUrl,\n    canvasToBlob: canvasToBlob,\n    resolveUrl: resolveUrl,\n    getAndEncode: getAndEncode,\n    uid: uid(),\n    delay: delay,\n    asArray: asArray,\n    escapeXhtml: escapeXhtml,\n    makeImage: makeImage,\n    width: width,\n    height: height,\n  };\n\n  function mimes() {\n    /*\n     * Only WOFF and EOT mime types for fonts are 'real'\n     * see http://www.iana.org/assignments/media-types/media-types.xhtml\n     */\n    var WOFF = \"application/font-woff\";\n    var JPEG = \"image/jpeg\";\n\n    return {\n      woff: WOFF,\n      woff2: WOFF,\n      ttf: \"application/font-truetype\",\n      eot: \"application/vnd.ms-fontobject\",\n      png: \"image/png\",\n      jpg: JPEG,\n      jpeg: JPEG,\n      gif: \"image/gif\",\n      tiff: \"image/tiff\",\n      svg: \"image/svg+xml\",\n    };\n  }\n\n  function parseExtension(url) {\n    var match = /\\.([^\\.\\/]*?)$/g.exec(url);\n    if (match) return match[1];\n    else return \"\";\n  }\n\n  function mimeType(url) {\n    var extension = parseExtension(url).toLowerCase();\n    return mimes()[extension] || \"\";\n  }\n\n  function isDataUrl(url) {\n    return url.search(/^(data:)/) !== -1;\n  }\n\n  function toBlob(canvas) {\n    return new Promise(function (resolve) {\n      var binaryString = window.atob(canvas.toDataURL().split(\",\")[1]);\n      var length = binaryString.length;\n      var binaryArray = new Uint8Array(length);\n\n      for (var i = 0; i < length; i++)\n        binaryArray[i] = binaryString.charCodeAt(i);\n\n      resolve(\n        new Blob([binaryArray], {\n          type: \"image/png\",\n        })\n      );\n    });\n  }\n\n  function canvasToBlob(canvas) {\n    if (canvas.toBlob)\n      return new Promise(function (resolve) {\n        canvas.toBlob(resolve);\n      });\n\n    return toBlob(canvas);\n  }\n\n  function resolveUrl(url, baseUrl) {\n    var doc = document.implementation.createHTMLDocument();\n    var base = doc.createElement(\"base\");\n    doc.head.appendChild(base);\n    var a = doc.createElement(\"a\");\n    doc.body.appendChild(a);\n    base.href = baseUrl;\n    a.href = url;\n    return a.href;\n  }\n\n  function uid() {\n    var index = 0;\n\n    return function () {\n      return \"u\" + fourRandomChars() + index++;\n\n      function fourRandomChars() {\n        /* see http://stackoverflow.com/a/6248722/2519373 */\n        return (\n          \"0000\" + ((Math.random() * Math.pow(36, 4)) << 0).toString(36)\n        ).slice(-4);\n      }\n    };\n  }\n\n  function makeImage(uri) {\n    return new Promise(function (resolve, reject) {\n      var image = new Image();\n      image.onload = function () {\n        resolve(image);\n      };\n      image.onerror = reject;\n      image.src = uri;\n    });\n  }\n\n  function getAndEncode(url) {\n    var TIMEOUT = 30000;\n    if (domtoimage.impl.options.cacheBust) {\n      // Cache bypass so we dont have CORS issues with cached images\n      // Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n      url += (/\\?/.test(url) ? \"&\" : \"?\") + new Date().getTime();\n    }\n\n    return new Promise(function (resolve) {\n      var request = new XMLHttpRequest();\n\n      request.onreadystatechange = done;\n      request.ontimeout = timeout;\n      request.responseType = \"blob\";\n      request.timeout = TIMEOUT;\n      request.open(\"GET\", url, true);\n      request.send();\n\n      var placeholder;\n      if (domtoimage.impl.options.imagePlaceholder) {\n        var split = domtoimage.impl.options.imagePlaceholder.split(/,/);\n        if (split && split[1]) {\n          placeholder = split[1];\n        }\n      }\n\n      function done() {\n        if (request.readyState !== 4) return;\n\n        if (request.status !== 200) {\n          if (placeholder) {\n            resolve(placeholder);\n          } else {\n            fail(\n              \"cannot fetch resource: \" + url + \", status: \" + request.status\n            );\n          }\n\n          return;\n        }\n\n        var encoder = new FileReader();\n        encoder.onloadend = function () {\n          var content = encoder.result.split(/,/)[1];\n          resolve(content);\n        };\n        encoder.readAsDataURL(request.response);\n      }\n\n      function timeout() {\n        if (placeholder) {\n          resolve(placeholder);\n        } else {\n          fail(\n            \"timeout of \" +\n              TIMEOUT +\n              \"ms occured while fetching resource: \" +\n              url\n          );\n        }\n      }\n\n      function fail(message) {\n        console.error(message);\n        resolve(\"\");\n      }\n    });\n  }\n\n  function dataAsUrl(content, type) {\n    return \"data:\" + type + \";base64,\" + content;\n  }\n\n  function escape(string) {\n    return string.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n  }\n\n  function delay(ms) {\n    return function (arg) {\n      return new Promise(function (resolve) {\n        setTimeout(function () {\n          resolve(arg);\n        }, ms);\n      });\n    };\n  }\n\n  function asArray(arrayLike) {\n    var array = [];\n    var length = arrayLike.length;\n    for (var i = 0; i < length; i++) array.push(arrayLike[i]);\n    return array;\n  }\n\n  function escapeXhtml(string) {\n    return string.replace(/#/g, \"%23\").replace(/\\n/g, \"%0A\");\n  }\n\n  function width(node) {\n    var leftBorder = px(node, \"border-left-width\");\n    var rightBorder = px(node, \"border-right-width\");\n    return node.scrollWidth + leftBorder + rightBorder;\n  }\n\n  function height(node) {\n    var topBorder = px(node, \"border-top-width\");\n    var bottomBorder = px(node, \"border-bottom-width\");\n    return node.scrollHeight + topBorder + bottomBorder;\n  }\n\n  function px(node, styleProperty) {\n    var value = window.getComputedStyle(node).getPropertyValue(styleProperty);\n    return parseFloat(value.replace(\"px\", \"\"));\n  }\n}\n\nfunction newInliner() {\n  var URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n\n  return {\n    inlineAll: inlineAll,\n    shouldProcess: shouldProcess,\n    impl: {\n      readUrls: readUrls,\n      inline: inline,\n    },\n  };\n\n  function shouldProcess(string) {\n    return string.search(URL_REGEX) !== -1;\n  }\n\n  function readUrls(string) {\n    var result = [];\n    var match;\n    while ((match = URL_REGEX.exec(string)) !== null) {\n      result.push(match[1]);\n    }\n    return result.filter(function (url) {\n      return !util.isDataUrl(url);\n    });\n  }\n\n  function inline(string, url, baseUrl, get) {\n    return Promise.resolve(url)\n      .then(function (url) {\n        return baseUrl ? util.resolveUrl(url, baseUrl) : url;\n      })\n      .then(get || util.getAndEncode)\n      .then(function (data) {\n        return util.dataAsUrl(data, util.mimeType(url));\n      })\n      .then(function (dataUrl) {\n        return string.replace(urlAsRegex(url), \"$1\" + dataUrl + \"$3\");\n      });\n\n    function urlAsRegex(url) {\n      return new RegExp(\n        \"(url\\\\(['\\\"]?)(\" + util.escape(url) + \")(['\\\"]?\\\\))\",\n        \"g\"\n      );\n    }\n  }\n\n  function inlineAll(string, baseUrl, get) {\n    if (nothingToInline()) return Promise.resolve(string);\n\n    return Promise.resolve(string)\n      .then(readUrls)\n      .then(function (urls) {\n        var done = Promise.resolve(string);\n        urls.forEach(function (url) {\n          done = done.then(function (string) {\n            return inline(string, url, baseUrl, get);\n          });\n        });\n        return done;\n      });\n\n    function nothingToInline() {\n      return !shouldProcess(string);\n    }\n  }\n}\n\nfunction newFontFaces() {\n  return {\n    resolveAll: resolveAll,\n    impl: {\n      readAll: readAll,\n    },\n  };\n\n  function resolveAll() {\n    return readAll(document)\n      .then(function (webFonts) {\n        return Promise.all(\n          webFonts.map(function (webFont) {\n            return webFont.resolve();\n          })\n        );\n      })\n      .then(function (cssStrings) {\n        return cssStrings.join(\"\\n\");\n      });\n  }\n\n  function readAll() {\n    return Promise.resolve(util.asArray(document.styleSheets))\n      .then(getCssRules)\n      .then(selectWebFontRules)\n      .then(function (rules) {\n        return rules.map(newWebFont);\n      });\n\n    function selectWebFontRules(cssRules) {\n      return cssRules\n        .filter(function (rule) {\n          return rule.type === CSSRule.FONT_FACE_RULE;\n        })\n        .filter(function (rule) {\n          return inliner.shouldProcess(rule.style.getPropertyValue(\"src\"));\n        });\n    }\n\n    function getCssRules(styleSheets) {\n      var cssRules = [];\n      styleSheets.forEach(function (sheet) {\n        try {\n          util\n            .asArray(sheet.cssRules || [])\n            .forEach(cssRules.push.bind(cssRules));\n        } catch (e) {\n          console.log(\n            \"Error while reading CSS rules from \" + sheet.href,\n            e.toString()\n          );\n        }\n      });\n      return cssRules;\n    }\n\n    function newWebFont(webFontRule) {\n      return {\n        resolve: function resolve() {\n          var baseUrl = (webFontRule.parentStyleSheet || {}).href;\n          return inliner.inlineAll(webFontRule.cssText, baseUrl);\n        },\n        src: function () {\n          return webFontRule.style.getPropertyValue(\"src\");\n        },\n      };\n    }\n  }\n}\n\nfunction newImages() {\n  return {\n    inlineAll: inlineAll,\n    impl: {\n      newImage: newImage,\n    },\n  };\n\n  function newImage(element) {\n    return {\n      inline: inline,\n    };\n\n    function inline(get) {\n      if (util.isDataUrl(element.src)) return Promise.resolve();\n\n      return Promise.resolve(element.src)\n        .then(get || util.getAndEncode)\n        .then(function (data) {\n          return util.dataAsUrl(data, util.mimeType(element.src));\n        })\n        .then(function (dataUrl) {\n          return new Promise(function (resolve, reject) {\n            element.onload = resolve;\n            element.onerror = reject;\n            element.src = dataUrl;\n          });\n        });\n    }\n  }\n\n  function inlineAll(node) {\n    if (!(node instanceof Element)) return Promise.resolve(node);\n\n    return inlineBackground(node).then(function () {\n      if (node instanceof HTMLImageElement) return newImage(node).inline();\n      else\n        return Promise.all(\n          util.asArray(node.childNodes).map(function (child) {\n            return inlineAll(child);\n          })\n        );\n    });\n\n    function inlineBackground(node) {\n      var background = node.style.getPropertyValue(\"background\");\n\n      if (!background) return Promise.resolve(node);\n\n      return inliner\n        .inlineAll(background)\n        .then(function (inlined) {\n          node.style.setProperty(\n            \"background\",\n            inlined,\n            node.style.getPropertyPriority(\"background\")\n          );\n        })\n        .then(function () {\n          return node;\n        });\n    }\n  }\n}\n\nexport default domtoimage;\n","import { message } from \"antd\";\nimport { toJS } from \"mobx\";\nimport store from \"../store/global\";\nimport domtoimage from \"./dom-to-image\";\nimport { VERSION } from \"./version\";\nimport { resetGlobalData } from \"./editor\";\n\nfunction read(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsText(file, \"utf8\");\n    reader.onloadend = () => {\n      resolve(JSON.parse(reader.result));\n    };\n  });\n}\n\nasync function loadFile(file) {\n  const data = await read(file);\n  if (!(data.version <= VERSION)) {\n    message.error(\"不支持的文件格式，请使用最新版本\");\n    return;\n  }\n  resetGlobalData(data);\n}\n\nfunction saveFile() {\n  const data = new Blob([JSON.stringify(toJS(store))], {\n    type: \"application/json\",\n  });\n  const downloadLink = document.createElement(\"a\");\n  downloadLink.download = (store.title || \"未标题\") + \".json\";\n  downloadLink.href = URL.createObjectURL(data);\n  downloadLink.click();\n  URL.revokeObjectURL(downloadLink.href);\n}\n\nfunction exportFile() {\n  domtoimage\n    .toPng(document.querySelector(\"#temp_svg\"), { bgcolor: \"white\" })\n    .then((dataUrl) => {\n      const downloadLink = document.createElement(\"a\");\n      downloadLink.download = (store.title || \"未标题\") + \".png\";\n      downloadLink.href = dataUrl;\n      downloadLink.click();\n    });\n}\n\nexport { saveFile, loadFile, exportFile };\n","import {\n  FolderOpenOutlined,\n  HighlightOutlined,\n  MenuUnfoldOutlined,\n  PlusOutlined,\n  RedoOutlined,\n  SaveOutlined,\n  UndoOutlined,\n} from \"@ant-design/icons\";\nimport { Menu } from \"antd\";\nimport state from \"../store/state\";\nimport store from \"../store/global\";\nimport {\n  cloneNotation,\n  createNotation,\n  isNote,\n  notations as N,\n} from \"../util/notation\";\nimport {\n  cloneParagraph,\n  createParagraph,\n  createParagraphWithNotations,\n} from \"../util/paragraph\";\nimport { convertTone, convertToneTo } from \"../util/tone-convert\";\nimport { exportFile, loadFile, saveFile } from \"../util/file\";\nimport { findParagraphAndNotation, resetGlobalData } from \"../util/editor\";\nimport {\n  go,\n  runInWrappedAction,\n  unwrappedAction,\n  wrappedAction,\n} from \"../store/history\";\n\nconst { SubMenu } = Menu;\n\nconst handleOpenFile = unwrappedAction((ev) => {\n  const file = ev.target.files[0];\n  loadFile(file);\n});\nconst handleSaveFile = () => {\n  saveFile();\n};\nconst handleExportFile = unwrappedAction(() => {\n  state.selectedNotationKey = null;\n  exportFile();\n});\nconst handleCreate = () => {\n  resetGlobalData();\n};\nconst handleEditMenu = wrappedAction(({ key }) => {\n  switch (key) {\n    case \"undo\":\n      go(-1);\n      break;\n    case \"redo\":\n      go(1);\n      break;\n    case \"reset-title\":\n      runInWrappedAction(() => {\n        store.title = \"【歌曲名称】\";\n      });\n      break;\n    case \"reset-authors\":\n      store.authors = [\n        \"【作曲者】  作曲\",\n        \"【填词者】  填词\",\n        \"【记谱者】  记谱\",\n      ];\n      break;\n    case \"add-paragraph\": {\n      store.paragraphs.push(createParagraphWithNotations());\n      break;\n    }\n    default:\n      break;\n  }\n});\nconst handleConvertMenu = ({ key }) => {\n  switch (true) {\n    case key.startsWith(\"convertTo\"):\n      const destTone = key.split(\"-\", 2)[1];\n      convertToneTo(destTone);\n      break;\n    case key === \"convert-up\":\n      convertTone(2);\n      break;\n    case key === \"convert-down\":\n      convertTone(-2);\n      break;\n    case key === \"convert-up8\":\n      convertTone(12);\n      break;\n    case key === \"convert-down8\":\n      convertTone(-12);\n      break;\n    default:\n      break;\n  }\n};\n\n// 画布上的点击事件\nconst handleClick = wrappedAction((ev) => {\n  if (state.shouldNotationBlurAfterClick && state.selectedNotationKey) {\n    state.lastSelectedNotationKey = state.selectedNotationKey;\n    state.selectedNotationKey = null;\n  }\n  state.shouldNotationBlurAfterClick = true;\n});\n\nconst handleKeyPress = wrappedAction((ev) => {\n  const inputKey = ev.key.toLowerCase();\n  const shift = ev.shiftKey;\n  const ctrl = ev.ctrlKey;\n\n  if (state.selectedNotationKey) {\n    // 仅选中符号时作用\n    if (state.helpDialogVisible || state.configDialogVisible) {\n      return;\n    }\n    const {\n      paragraph,\n      notation,\n      paragraphIndex,\n      notationIndex,\n    } = findParagraphAndNotation(state.selectedNotationKey);\n    if (!notation) {\n      return;\n    }\n    switch (true) {\n      case isNote(inputKey) && !ctrl && !shift:\n        notation.note = inputKey;\n        break;\n      case inputKey === \"-\" && !ctrl && !shift:\n        notation.note = N.extend;\n        break;\n      case inputKey === \"|\" && !ctrl:\n        notation.note = N.separator;\n        break;\n      case inputKey === \"u\" && !ctrl && !shift:\n        notation.underline += 1;\n        break;\n      case inputKey === \"u\" && !ctrl && shift:\n        notation.underline -= 1;\n        notation.underline = Math.max(0, notation.underline);\n        break;\n      case inputKey === \".\" && !ctrl && !shift:\n        notation.dotted = !notation.dotted;\n        break;\n      case inputKey === \"8\" && !ctrl && !shift:\n        notation.octave += 1;\n        break;\n      case inputKey === \"*\" && !ctrl:\n        notation.octave -= 1;\n        break;\n      case inputKey === \"#\" && !ctrl:\n        if (notation.prefixSups.indexOf(\"♯\") !== 0) {\n          if (notation.prefixSups[0] === \"♭\") {\n            notation.prefixSups.shift();\n          }\n          notation.prefixSups.unshift(\"♯\");\n        } else {\n          notation.prefixSups.shift();\n        }\n        break;\n      case inputKey === \"b\" && !ctrl && !shift: {\n        if (notation.prefixSups.indexOf(\"♭\") !== 0) {\n          if (notation.prefixSups[0] === \"♯\") {\n            notation.prefixSups.shift();\n          }\n          notation.prefixSups.unshift(\"♭\");\n        } else {\n          notation.prefixSups.shift();\n        }\n        break;\n      }\n      case inputKey === \"~\" && !ctrl: {\n        if (notation.topDecorators.includes(\"~\")) {\n          notation.topDecorators.splice(notation.topDecorators.indexOf(\"~\"), 1);\n        } else {\n          notation.topDecorators.push(\"~\");\n        }\n        break;\n      }\n      case inputKey === \"enter\" && !ctrl && !shift: {\n        if (paragraph.notations[notationIndex + 1]) {\n          state.selectedNotationKey =\n            paragraph.notations[notationIndex + 1].key;\n        } else {\n          const nextNotation = createNotation();\n          paragraph.notations.push(nextNotation);\n          state.selectedNotationKey = nextNotation.key;\n        }\n        break;\n      }\n      case inputKey === \"l\" && !ctrl && !shift: {\n        const nextNotation =\n          paragraph.notations[notationIndex + 1] ||\n          store.paragraphs[paragraphIndex + 1].notations?.at(0);\n        if (nextNotation) {\n          state.selectedNotationKey = nextNotation.key;\n        }\n        break;\n      }\n      case inputKey === \"enter\" && !ctrl && shift: {\n        if (paragraph.notations[notationIndex - 1]) {\n          state.selectedNotationKey =\n            paragraph.notations[notationIndex - 1].key;\n        }\n        break;\n      }\n      case inputKey === \"h\" && !ctrl && !shift: {\n        const prevNotation =\n          paragraph.notations[notationIndex - 1] ||\n          store.paragraphs[paragraphIndex - 1].notations?.at(-1);\n        if (prevNotation) {\n          state.selectedNotationKey = prevNotation.key;\n        }\n        break;\n      }\n      case inputKey === \"enter\" && ctrl && !shift: {\n        const newNotation = createNotation();\n        if (\n          notationIndex === paragraph.notations.length - 1 &&\n          paragraphIndex === store.paragraphs.length - 1\n        ) {\n          // 在最后一个音符时ctrl+enter插入新段落并创建符号\n          store.paragraphs.push(createParagraph({ notations: [newNotation] }));\n          state.selectedNotationKey = store.paragraphs\n            .at(-1)\n            .notations.at(0).key;\n        } else {\n          paragraph.notations.splice(notationIndex + 1, 0, newNotation);\n          state.selectedNotationKey = newNotation.key;\n        }\n        break;\n      }\n      case inputKey === \"j\" && !ctrl && !shift: {\n        const nextParagraph = store.paragraphs[paragraphIndex + 1];\n        if (nextParagraph?.notations?.length) {\n          const nextNotation =\n            nextParagraph.notations[notationIndex] ||\n            nextParagraph.notations.at(-1);\n          state.selectedNotationKey = nextNotation.key;\n        }\n        break;\n      }\n      case inputKey === \"k\" && !ctrl && !shift: {\n        const prevParagraph = store.paragraphs[paragraphIndex - 1];\n        if (prevParagraph?.notations?.length) {\n          const prevNotation =\n            prevParagraph.notations[notationIndex] ||\n            prevParagraph.notations.at(-1);\n          state.selectedNotationKey = prevNotation.key;\n        }\n        break;\n      }\n      case inputKey === \"backspace\" && !ctrl && !shift:\n      case inputKey === \"delete\" && !ctrl && !shift: {\n        paragraph.notations.splice(notationIndex, 1);\n        const currNotation =\n          paragraph.notations[notationIndex] ||\n          paragraph.notations[notationIndex - 1];\n        state.selectedNotationKey = currNotation?.key;\n        break;\n      }\n      case inputKey === \"backspace\" && !ctrl && shift:\n      case inputKey === \"delete\" && !ctrl && shift: {\n        store.paragraphs.splice(paragraphIndex, 1);\n        const currParagraph =\n          store.paragraphs[paragraphIndex] || store.paragraphs.at(-1);\n        const currNotation =\n          currParagraph?.notations?.at(notationIndex) ||\n          currParagraph?.notations?.at(-1);\n        state.selectedNotationKey = currNotation?.key;\n        break;\n      }\n      case inputKey === \"=\" && !ctrl && !shift: {\n        if (typeof paragraph.alignJustify !== \"boolean\") {\n          paragraph.alignJustify = !(\n            paragraphIndex ===\n            store.paragraphs.length - 1\n          );\n        }\n        paragraph.alignJustify = !paragraph.alignJustify;\n        break;\n      }\n      case inputKey === \"c\" && ctrl && !shift: {\n        ev.preventDefault();\n        state.clipboardContent = notation;\n        break;\n      }\n      case inputKey === \"c\" && ctrl && shift: {\n        ev.preventDefault();\n        state.clipboardContent = paragraph;\n        break;\n      }\n      case inputKey === \"v\" && ctrl && !shift: {\n        ev.preventDefault();\n        if (state.clipboardContent) {\n          switch (state.clipboardContent.type) {\n            case \"notation\":\n              paragraph.notations.splice(\n                notationIndex + 1,\n                0,\n                cloneNotation(state.clipboardContent)\n              );\n              break;\n            case \"paragraph\":\n              store.paragraphs.splice(\n                paragraphIndex + 1,\n                0,\n                cloneParagraph(state.clipboardContent)\n              );\n              break;\n            default:\n              state.clipboardContent = null;\n          }\n        }\n        break;\n      }\n      default:\n        break;\n    }\n  } else {\n    // 仅未选中符号时\n    switch (true) {\n      case [\"h\", \"j\", \"k\", \"l\"].includes(inputKey): {\n        const { notation: n } = findParagraphAndNotation(\n          state.lastSelectedNotationKey\n        );\n        state.selectedNotationKey = (\n          n || store.paragraphs?.at(0)?.notations?.at(0)\n        )?.key;\n        break;\n      }\n      default:\n        break;\n    }\n  }\n  // 全局\n  switch (true) {\n    case inputKey === \"z\" && ctrl && !shift:\n      go(-1);\n      break;\n    case inputKey === \"y\" && ctrl && !shift:\n    case inputKey === \"z\" && ctrl && shift:\n      go(1);\n      break;\n    case inputKey === \"s\" && ctrl && !shift: {\n      ev.preventDefault();\n      saveFile();\n      break;\n    }\n    case inputKey === \"o\" && ctrl && !shift: {\n      ev.preventDefault();\n      const input = document.createElement(\"input\");\n      input.type = \"file\";\n      input.accept = \".json\";\n      input.onchange = handleOpenFile;\n      input.click();\n      break;\n    }\n    case inputKey === \"?\" && !ctrl: {\n      if (state.helpDialogVisible) {\n        state.helpDialogVisible = false;\n      } else {\n        state.configDialogVisible = false;\n        state.helpDialogVisible = true;\n      }\n      break;\n    }\n    default:\n      break;\n  }\n});\n\nconst fileMenu = (\n  <Menu>\n    <Menu.Item key=\"create\" icon={<PlusOutlined />} onClick={handleCreate}>\n      新建\n    </Menu.Item>\n    <Menu.Item key=\"open\" icon={<FolderOpenOutlined />}>\n      打开\n      <input\n        onChange={handleOpenFile}\n        accept=\".json\"\n        type=\"file\"\n        title=\"\"\n        style={{\n          opacity: 0,\n          cursor: \"pointer\",\n          width: \"100%\",\n          left: 0,\n          top: 0,\n          height: \"100%\",\n          position: \"absolute\",\n        }}\n      />\n    </Menu.Item>\n    <Menu.Item key=\"save\" icon={<SaveOutlined />} onClick={handleSaveFile}>\n      保存\n    </Menu.Item>\n    <Menu.Item key=\"export\" icon={<SaveOutlined />} onClick={handleExportFile}>\n      导出为图片\n    </Menu.Item>\n  </Menu>\n);\nconst editMenu = (\n  <Menu onClick={handleEditMenu}>\n    <Menu.Item key=\"undo\" icon={<UndoOutlined />}>\n      撤销\n    </Menu.Item>\n    <Menu.Item key=\"redo\" icon={<RedoOutlined />}>\n      重做\n    </Menu.Item>\n    <Menu.Item key=\"add-paragraph\" icon={<MenuUnfoldOutlined />}>\n      添加段落\n    </Menu.Item>\n    <Menu.Item key=\"reset-title\" icon={<HighlightOutlined />}>\n      重置歌曲名称\n    </Menu.Item>\n    <Menu.Item key=\"reset-authors\" icon={<HighlightOutlined />}>\n      重置作者信息\n    </Menu.Item>\n  </Menu>\n);\n\nconst convertMenu = (\n  <Menu key=\"tone\" onClick={handleConvertMenu}>\n    <SubMenu key=\"convertTo\" title=\"转到...\">\n      <Menu.Item key=\"convertTo-C\">1 = C</Menu.Item>\n      <Menu.Item key=\"convertTo-D\">1 = D</Menu.Item>\n      <Menu.Item key=\"convertTo-E\">1 = E</Menu.Item>\n      <Menu.Item key=\"convertTo-F\">1 = F</Menu.Item>\n      <Menu.Item key=\"convertTo-G\">1 = G</Menu.Item>\n      <Menu.Item key=\"convertTo-A\">1 = A</Menu.Item>\n      <Menu.Item key=\"convertTo-B\">1 = B</Menu.Item>\n      <Menu.Item key=\"convertTo-♭D\">\n        1 = <sup>♭</sup>D\n      </Menu.Item>\n      <Menu.Item key=\"convertTo-♭E\">\n        1 = <sup>♭</sup>E\n      </Menu.Item>\n      <Menu.Item key=\"convertTo-♭G\">\n        1 = <sup>♭</sup>G\n      </Menu.Item>\n      <Menu.Item key=\"convertTo-♭A\">\n        1 = <sup>♭</sup>A\n      </Menu.Item>\n      <Menu.Item key=\"convertTo-♭B\">\n        1 = <sup>♭</sup>B\n      </Menu.Item>\n    </SubMenu>\n    <Menu.Item key=\"convert-up\">升高一个音</Menu.Item>\n    <Menu.Item key=\"convert-down\">降低一个音</Menu.Item>\n    <Menu.Item key=\"convert-up8\">升高一个八度</Menu.Item>\n    <Menu.Item key=\"convert-down8\">降低一个八度</Menu.Item>\n  </Menu>\n);\n\nexport { fileMenu, editMenu, convertMenu, handleKeyPress, handleClick };\n","import { observer } from \"mobx-react-lite\";\nimport store from \"../../store/global\";\nimport Styles from \"./index.module.css\";\n\n// ENHANCE: 增加整体缩放能力\n\n// FIXME: 修改获取svg元素的方式\nfunction Canvas({ children, ...props }) {\n  return (\n    <svg\n      id=\"temp_svg\"\n      xmlns=\" http://www.w3.org/2000/svg\"\n      className={Styles.svg}\n      // viewBox={`0 0 ${store.canvasWidth} ${store.canvasHeight}`}\n      width={store.canvasWidth}\n      height={store.canvasHeight}\n      onContextMenu={(ev) => ev.preventDefault()}\n      {...props}\n    >\n      {children}\n    </svg>\n  );\n}\n\nexport default observer(Canvas);\n","import { Button, Form, Input, Modal } from \"antd\";\nimport { observer } from \"mobx-react-lite\";\nimport { useCallback } from \"react\";\nimport store from \"../../store/global\";\nimport { getDefaultGlobalData } from \"../../util/editor\";\nimport { unwrappedAction } from \"../../store/history\";\n\nconst ImmediateNumberConfigInput = observer(({ propertyName, ...props }) => {\n  // ENHANCE: 防抖处理\n  const handleChange = unwrappedAction((ev) => {\n    const v = Number(ev.target.value) | 0;\n    store[propertyName] = v;\n  });\n  return (\n    <Input value={store[propertyName]} onChange={handleChange} {...props} />\n  );\n});\nfunction ImmediateNumberConfigItem({ propertyName, label, ...props }) {\n  return (\n    <Form.Item label={label} {...props}>\n      <ImmediateNumberConfigInput propertyName={propertyName} />\n    </Form.Item>\n  );\n}\n\nfunction ConfigModal({ visible, onVisibleChange }) {\n  const handleClose = useCallback(() => {\n    onVisibleChange?.call(null, false);\n  }, [onVisibleChange]);\n  const resetConfig = unwrappedAction(() => {\n    const {\n      canvasWidth,\n      canvasHeight,\n      marginTop,\n      marginHorizontal,\n      gapBetweenParagraph,\n      gapBetweenNotation,\n    } = getDefaultGlobalData();\n    Object.assign(store, {\n      canvasWidth,\n      canvasHeight,\n      marginTop,\n      marginHorizontal,\n      gapBetweenParagraph,\n      gapBetweenNotation,\n    });\n  });\n\n  return (\n    <Modal\n      style={{ top: 20 }}\n      visible={visible}\n      title=\"配置\"\n      onCancel={handleClose}\n      footer={[\n        <Button key=\"reset\" onClick={resetConfig}>\n          重置为默认\n        </Button>,\n        <Button key=\"close\" type=\"primary\" onClick={handleClose}>\n          关闭\n        </Button>,\n      ]}\n    >\n      <Form labelAlign=\"right\" labelCol={{ span: 4 }}>\n        <Form.Item label=\"画布大小\">\n          <Input.Group>\n            <ImmediateNumberConfigInput\n              propertyName=\"canvasWidth\"\n              style={{ width: \"45%\", textAlign: \"center\" }}\n            />\n\n            <Input\n              className=\"site-input-split\"\n              style={{\n                width: \"10%\",\n                borderLeft: 0,\n                borderRight: 0,\n                textAlign: \"center\",\n                pointerEvents: \"none\",\n              }}\n              placeholder=\"x\"\n              disabled\n            />\n            <ImmediateNumberConfigInput\n              propertyName=\"canvasHeight\"\n              style={{ width: \"45%\", textAlign: \"center\" }}\n            />\n          </Input.Group>\n        </Form.Item>\n        <ImmediateNumberConfigItem label=\"顶部边距\" propertyName=\"marginTop\" />\n        <ImmediateNumberConfigItem\n          label=\"左右边距\"\n          propertyName=\"marginHorizontal\"\n        />\n        <ImmediateNumberConfigItem\n          label=\"段间距\"\n          propertyName=\"gapBetweenParagraph\"\n        />\n        <ImmediateNumberConfigItem\n          label=\"音符间距\"\n          propertyName=\"gapBetweenNotation\"\n        />\n      </Form>\n    </Modal>\n  );\n}\n\nexport default ConfigModal;\n","let dirty = false;\nlet memoizedRect = { x: 0, y: 0 };\nlet container;\n\nfunction getPopoverContainer() {\n  if (!container) {\n    container = document.createElement(\"div\");\n    container.id = \"svg-popover-container\";\n    container.style = `\n      position: absolute;\n      left: 0;\n      top: 0;\n    `;\n    document.body.appendChild(container);\n    document.addEventListener(\"scroll\", () => void (dirty = true));\n  }\n  return container;\n}\n\nfunction getContainerOffset() {\n  if (dirty) {\n    const rect = getPopoverContainer().getBoundingClientRect();\n    memoizedRect = {\n      x: -rect.x,\n      y: -rect.y,\n    };\n    dirty = false;\n  }\n  return memoizedRect;\n}\n\nexport { getPopoverContainer, getContainerOffset };\n","import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport Styles from \"./index.module.css\";\nimport { getContainerOffset, getPopoverContainer } from \"./container\";\n\n// ENHANCE: smart placement\nfunction PopoverOnSvg({\n  children,\n  renderContent,\n  renderPopover,\n  darkMode,\n  globalClassName,\n  offset,\n  placement,\n  style,\n  title,\n  trigger,\n  visible,\n  autoHide,\n  showArrow,\n  onVisibilityChange,\n}) {\n  const triggerBoxRef = useRef({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n  });\n  const initFlagRef = useRef(false);\n  const triggerRef = useRef();\n  const popoverRef = useRef();\n  // initially, always set innerVisible to false. If the prop *visible* is\n  // true, we'll update it after dom mounted, because we cannot calculate\n  // correct position of popover before react mounting it.\n  const [innerVisible, setInnerVisible] = useState(false);\n  const [lastContextCord, setLastContextCord] = useState({ x: 0, y: 0 });\n  const [, forceUpdate] = useState();\n  const popoverClassNames = [Styles.popover, globalClassName].filter(Boolean);\n  const arrowClassNames = [Styles.arrow];\n  const headerClassNames = [Styles.header];\n  let offsetX = (offset && offset.x) || 0;\n  let offsetY = (offset && offset.y) || 0;\n  let mergedStyles = {\n    transform: \"\",\n  };\n  const arrowStyles = {};\n  placement = placement.toLowerCase();\n\n  const makeOffset = function (x, y = 0) {\n    offsetX += x;\n    offsetY += y;\n  };\n  const changeVisibility = useCallback(\n    function (shouldShow) {\n      shouldShow = shouldShow ?? !innerVisible;\n      let newVisibility = visible === undefined ? shouldShow : visible;\n      if (newVisibility) {\n        if (!triggerRef.current) {\n          setTimeout(changeVisibility, 0);\n          return;\n        }\n        // re-get box of trigger element\n        triggerBoxRef.current = triggerRef.current.getBoundingClientRect();\n      }\n      setInnerVisible(newVisibility);\n      // FIXME: visible由false变为true时React Warning: Cannot update a component (`EditableContent`) while rendering a different component (`PopoverOnSvg`).\n      onVisibilityChange && onVisibilityChange(shouldShow);\n    },\n    [visible, innerVisible, onVisibilityChange]\n  );\n  const handleContextMenu = useCallback(\n    (ev) => {\n      setLastContextCord({ x: ev.pageX, y: ev.pageY });\n      ev.preventDefault();\n      changeVisibility(true);\n    },\n    [changeVisibility]\n  );\n  useEffect(() => {\n    initFlagRef.current = true;\n  }, []);\n  useEffect(() => {\n    if (autoHide === false) {\n      return;\n    }\n    const handler = (ev) => {\n      if (ev.type === \"keydown\" && ev.key === \"Escape\") {\n        changeVisibility(false);\n      } else if (ev.type === \"mouseup\") {\n        for (let target = ev.target; target; target = target.parentElement) {\n          if (target === popoverRef.current) {\n            return;\n          } else if (target === triggerRef.current) {\n            if (trigger === \"context\" && ev.button !== 2) {\n              continue;\n            } else if (trigger === \"click\" && ev.button !== 0) {\n              continue;\n            }\n            return;\n          }\n        }\n        changeVisibility(false);\n      }\n    };\n    if (innerVisible) {\n      document.addEventListener(\"mouseup\", handler);\n      document.addEventListener(\"keydown\", handler);\n    }\n    return () => {\n      document.removeEventListener(\"mouseup\", handler);\n      document.removeEventListener(\"keydown\", handler);\n    };\n  }, [innerVisible, autoHide, changeVisibility, trigger]);\n\n  if (visible !== undefined && visible !== innerVisible) {\n    if (initFlagRef.current) {\n      changeVisibility();\n    } else {\n      setTimeout(() => {\n        // this is the first-time render, trigger dom has not mounted, so we\n        // have to delay the rendering\n        forceUpdate([]);\n      }, 0);\n    }\n  }\n  if (trigger !== \"context\") {\n    const box = triggerBoxRef.current;\n    switch (true) {\n      case /^(left|right)(top|center|bottom)?$/i.test(placement):\n        mergedStyles.minHeight = \"32px\";\n        if (placement.startsWith(\"right\")) {\n          mergedStyles.left = box.right + \"px\";\n        } else {\n          mergedStyles.left = box.left + \"px\";\n          mergedStyles.transform += \" translate(-100%, 0)\";\n        }\n        if (placement.endsWith(\"top\")) {\n          mergedStyles.top = box.top + \"px\";\n          mergedStyles.transform += \" translate(0, 0)\";\n          arrowStyles.top = \"16px\";\n        } else if (placement.endsWith(\"bottom\")) {\n          mergedStyles.top = box.bottom + \"px\";\n          mergedStyles.transform += \" translate(0, -100%)\";\n          arrowStyles.bottom = \"0\";\n        } else {\n          mergedStyles.top = box.y + box.height / 2 + \"px\";\n          mergedStyles.transform += \" translate(0, -50%)\";\n          arrowStyles.top = \"50%\";\n        }\n        break;\n      case /^(top|bottom)(left|center|right)?$/i.test(placement):\n      default:\n        if (placement.startsWith(\"bottom\")) {\n          mergedStyles.top = box.bottom + \"px\";\n        } else {\n          mergedStyles.top = box.y + \"px\";\n          mergedStyles.transform += \" translate(0, -100%)\";\n        }\n        if (placement.endsWith(\"left\")) {\n          mergedStyles.left = box.left + \"px\";\n          arrowStyles.left = \"16px\";\n        } else if (placement.endsWith(\"right\")) {\n          mergedStyles.left = box.right + \"px\";\n          mergedStyles.transform += \" translate(-100%, 0)\";\n          arrowStyles.right = \"0\";\n        } else {\n          mergedStyles.left = box.right - box.width / 2 + \"px\";\n          mergedStyles.transform += \" translateX(-50%)\";\n          arrowStyles.left = \"50%\";\n        }\n        break;\n    }\n    switch (true) {\n      case !showArrow:\n        break;\n      case placement.startsWith(\"left\"):\n        makeOffset(-8);\n        arrowClassNames.push(\"left\");\n        break;\n      case placement.startsWith(\"right\"):\n        makeOffset(8);\n        arrowClassNames.push(\"right\");\n        break;\n      case placement.startsWith(\"bottom\"):\n        makeOffset(0, 8);\n        arrowClassNames.push(\"bottom\");\n        break;\n      case placement.startsWith(\"top\"):\n      default:\n        makeOffset(0, -8);\n        arrowClassNames.push(\"top\");\n        break;\n    }\n    makeOffset(getContainerOffset().x, getContainerOffset().y);\n    mergedStyles.transform += ` translate(${offsetX}px, ${offsetY}px)`;\n  } else {\n    mergedStyles.left = lastContextCord.x;\n    mergedStyles.top = lastContextCord.y;\n    mergedStyles.transform = `translate(${offsetX}px, ${offsetY}px)`;\n  }\n  if (darkMode) {\n    popoverClassNames.push(\"dark\");\n    arrowClassNames.push(\"dark\");\n    headerClassNames.push(\"dark\");\n  }\n  mergedStyles = Object.assign(mergedStyles, style);\n  return (\n    <>\n      []\n      <g\n        type=\"noop\"\n        ref={triggerRef}\n        onClick={trigger === \"click\" ? () => changeVisibility() : undefined}\n        onMouseEnter={\n          trigger === \"hover\" ? () => changeVisibility(true) : undefined\n        }\n        onMouseLeave={\n          trigger === \"hover\" ? () => changeVisibility(false) : undefined\n        }\n        onContextMenu={trigger === \"context\" ? handleContextMenu : undefined}\n      >\n        {children}\n      </g>\n      {innerVisible &&\n        createPortal(\n          <div\n            ref={popoverRef}\n            className={popoverClassNames.join(\" \")}\n            style={mergedStyles}\n          >\n            {renderPopover ? (\n              typeof renderPopover === \"function\" ? (\n                renderPopover()\n              ) : (\n                renderPopover\n              )\n            ) : (\n              <>\n                {showArrow && (\n                  <div\n                    className={arrowClassNames.join(\" \")}\n                    style={arrowStyles}\n                  ></div>\n                )}\n                {title && (\n                  <header className={headerClassNames.join(\" \")}>\n                    {title}\n                  </header>\n                )}\n                <div className={title ? Styles.content : null}>\n                  {typeof renderContent === \"function\"\n                    ? renderContent()\n                    : renderContent ?? null}\n                </div>\n              </>\n            )}\n          </div>,\n          getPopoverContainer()\n        )}\n    </>\n  );\n}\n\nPopoverOnSvg.defaultProps = {\n  trigger: \"click\",\n  placement: \"top\",\n  showArrow: true,\n};\n\nexport default React.memo(PopoverOnSvg);\n","import React, { useCallback, useImperativeHandle, useState } from \"react\";\nimport { Button, Input, Menu } from \"antd\";\nimport PopoverOnSvg from \"../PopoverOnSvg\";\nimport Styles from \"./index.module.css\";\n\nconst EditableContent = function (\n  {\n    children,\n    title,\n    initialValue,\n    inputType,\n    // ENHANCE: 去除这个prop，使用overlay代替\n    options,\n    // 选择模式要渲染的菜单，如果没有提供则根据options生成\n    overlay,\n    onChange,\n    popoverProps,\n  },\n  ref\n) {\n  const [inputValue, setInputValue] = useState(initialValue);\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  useImperativeHandle(\n    ref,\n    () => ({\n      showPopover: setPopoverVisible.bind(null, true),\n      hidePopover: setPopoverVisible.bind(null, false),\n    }),\n    []\n  );\n  const handleVisibilityChange = useCallback(\n    function (value) {\n      setPopoverVisible(value);\n      if (!value) {\n        setInputValue(initialValue);\n      }\n    },\n    [initialValue]\n  );\n  const handleInput = useCallback(function (ev) {\n    setInputValue(ev.target.value);\n  }, []);\n  const handleConfirm = useCallback(\n    async function (value) {\n      const v = value === undefined ? inputValue : value;\n      const success = await (onChange && onChange(v));\n      success !== false && setPopoverVisible(false);\n    },\n    [inputValue, onChange]\n  );\n  const handleHideContextMenu = useCallback(() => {\n    setPopoverVisible(false);\n  }, []);\n  const handleCancel = useCallback(\n    function () {\n      setInputValue(initialValue);\n      setPopoverVisible(false);\n    },\n    [initialValue]\n  );\n  const renderTextInputPopover = useCallback(\n    () => (\n      <>\n        <Input\n          autoFocus\n          value={inputValue}\n          onChange={handleInput}\n          onPressEnter={() => handleConfirm()}\n        />\n        <div className={Styles.buttonGroup}>\n          <Button\n            type=\"primary\"\n            className={Styles.button}\n            onClick={() => handleConfirm()}\n          >\n            确定\n          </Button>\n          <Button onClick={handleCancel}>取消</Button>\n        </div>\n      </>\n    ),\n    [inputValue, handleInput, handleConfirm, handleCancel]\n  );\n  const renderSelectionPopover = useCallback(() => {\n    if (overlay) {\n      return <div onClick={handleHideContextMenu}>{overlay}</div>;\n    }\n    return (\n      <Menu className={Styles.menu}>\n        {(options || [])\n          .filter((op) => op.visible !== false)\n          .map((option) => (\n            <Menu.Item\n              icon={option.icon}\n              key={option.key}\n              className={\n                Styles.menuItem +\n                (option.key === initialValue ? \" selected\" : \"\")\n              }\n              onClick={() => handleConfirm(option.key)}\n            >\n              {option.text}\n            </Menu.Item>\n          ))}\n      </Menu>\n    );\n  }, [initialValue, options, handleConfirm, handleHideContextMenu, overlay]);\n  let renderContent, renderPopover;\n  switch (inputType) {\n    case \"select\":\n      renderContent = renderSelectionPopover;\n      break;\n    case \"number\":\n    case \"text\":\n    default:\n      renderContent = renderTextInputPopover;\n  }\n\n  return (\n    <PopoverOnSvg\n      trigger={inputType === \"select\" ? \"context\" : \"click\"}\n      title={title}\n      renderContent={renderContent}\n      renderPopover={renderPopover}\n      visible={popoverVisible}\n      placement=\"bottom\"\n      onVisibilityChange={handleVisibilityChange}\n      {...popoverProps}\n    >\n      {children}\n    </PopoverOnSvg>\n  );\n};\n\nexport default React.forwardRef(EditableContent);\n","export default function Row({\n  children,\n  type,\n  editable,\n  offset,\n  offsetX,\n  offsetY,\n  ...props\n}) {\n  offsetX = (offset?.x ?? offsetX) | 0;\n  offsetY = (offset?.y ?? offsetY) | 0;\n  return (\n    <g\n      type={type}\n      transform={`translate(${offsetX},${offsetY})`}\n      style={\n        editable\n          ? {\n              cursor: \"pointer\",\n            }\n          : null\n      }\n      {...props}\n    >\n      {children}\n    </g>\n  );\n}\n","// 为了解决svg text不渲染连续空格，对html转义并替换空格为&nbsp;\nexport default function escapeHtml(text) {\n  const span = document.createElement(\"span\");\n  span.appendChild(document.createTextNode(text));\n  return span.innerHTML.replace(/\\s/g, \"&nbsp;\");\n}\n","import escapeHtml from \"../../util/html-escape\";\n\nexport default function Text({ children, editable, ...props }) {\n  if (typeof children === \"string\") {\n    return (\n      <text\n        x=\"0\"\n        y=\"0\"\n        style={\n          editable\n            ? {\n                cursor: \"pointer\",\n              }\n            : null\n        }\n        dominantBaseline=\"hanging\"\n        stroke=\"none\"\n        fontWeight=\"bold\"\n        fill=\"currentColor\"\n        dangerouslySetInnerHTML={{ __html: escapeHtml(children) }}\n        {...props}\n      ></text>\n    );\n  }\n  return (\n    <text\n      x=\"0\"\n      y=\"0\"\n      style={\n        editable\n          ? {\n              cursor: \"pointer\",\n            }\n          : null\n      }\n      dominantBaseline=\"hanging\"\n      stroke=\"none\"\n      fontWeight=\"bold\"\n      fill=\"currentColor\"\n      {...props}\n    >\n      {children}\n    </text>\n  );\n}\n","import { message } from \"antd\";\nimport { observer } from \"mobx-react-lite\";\nimport EditableContent from \"../../../component/EditableContent\";\nimport P from \"../../../util/placement\";\nimport store from \"../../../store/global\";\nimport { wrappedAction } from \"../../../store/history\";\nimport Row from \"../../Row\";\nimport Text from \"../../Text\";\n\nconst tones = [\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"A\",\n  \"B\",\n  \"♭C\",\n  \"♭D\",\n  \"♭E\",\n  \"♭F\",\n  \"♭G\",\n  \"♭A\",\n  \"♭B\",\n].map((t) => ({ key: t, text: t }));\nconst handleChangeTone = wrappedAction(function (value) {\n  store.tone = value;\n});\nconst handleChangeSpeed = wrappedAction(function (value) {\n  store.speed = value;\n});\nconst handleChangeBeat = wrappedAction(function (value) {\n  const beat = String(value).split(\"/\");\n  if (beat.length !== 2) {\n    message.error(\"请以【*/*】的格式输入节拍！\");\n    return false;\n  }\n  const [c, t] = [parseInt(beat[0], 10), parseInt(beat[1], 10)];\n  if (c > 0 && t > 0) {\n    store.beat = [c, t];\n  } else {\n    message.error(\"请输入大于0的拍数和时值！\");\n    return false;\n  }\n});\n\nfunction LeftInfoBlock() {\n  return (\n    <>\n      <EditableContent\n        inputType=\"select\"\n        initialValue={store.tone}\n        options={tones}\n        onChange={handleChangeTone}\n        popoverProps={{ trigger: \"click\" }}\n      >\n        <Row\n          type=\"tone\"\n          editable\n          offsetX={store.marginHorizontal}\n          offsetY={P.titleOffsetY}\n        >\n          <Text>1&nbsp;&nbsp;= </Text>\n          {store.tone.startsWith(\"♭\") && (\n            <Text x=\"27\" y=\"-2\" fontSize={store.defaultSubFontSize}>\n              ♭\n            </Text>\n          )}\n\n          <Text editable x={store.tone.startsWith(\"♭\") ? 36 : 29}>\n            {store.tone.at(-1)}\n          </Text>\n        </Row>\n      </EditableContent>\n      <EditableContent\n        title=\"节拍：\"\n        inputType=\"number\"\n        initialValue={store.beat.join(\"/\")}\n        onChange={handleChangeBeat}\n      >\n        <Row\n          type=\"beat\"\n          editable\n          offsetX={store.marginHorizontal + 64}\n          offsetY={P.titleOffsetY}\n        >\n          <Text x=\"0\" y=\"-8\" textAnchor=\"middle\">\n            {store.beat[0]}\n          </Text>\n          <Text x=\"0\" y=\"12\" textAnchor=\"middle\">\n            {store.beat[1]}\n          </Text>\n          <line x1=\"-8\" y1=\"8\" x2=\"8\" y2=\"8\" stroke=\"currentColor\" />\n        </Row>\n      </EditableContent>\n      <EditableContent\n        title=\"速度（bps）：\"\n        inputType=\"number\"\n        initialValue={store.speed}\n        onChange={handleChangeSpeed}\n      >\n        <Row\n          editable\n          type=\"speed\"\n          offsetX={store.marginHorizontal}\n          offsetY={P.titleOffsetY + 22}\n        >\n          <Text x=\"-4\">♩</Text>\n          <Text x=\"16\">=&nbsp;{store.speed}</Text>\n        </Row>\n      </EditableContent>\n    </>\n  );\n}\n\nexport default observer(LeftInfoBlock);\n","import { DeleteOutlined, PlusOutlined } from \"@ant-design/icons\";\nimport { Modal } from \"antd\";\nimport { observer } from \"mobx-react-lite\";\nimport EditableContent from \"../../../component/EditableContent\";\nimport P from \"../../../util/placement\";\nimport store from \"../../../store/global\";\nimport { wrappedAction } from \"../../../store/history\";\nimport Row from \"../../Row\";\nimport Text from \"../../Text\";\n\nconst authorContextMenu = [\n  {\n    key: \"create\",\n    text: \"添加\",\n    icon: <PlusOutlined />,\n    onClick: () => {\n      store.authors.push(\"作者信息\");\n    },\n  },\n  {\n    key: \"delete\",\n    text: \"删除\",\n    icon: <DeleteOutlined />,\n    onClick: (index) => {\n      store.authors.splice(index, 1);\n    },\n  },\n];\nconst blockContextMenu = [\n  {\n    key: \"create\",\n    text: \"添加作者信息\",\n    icon: <PlusOutlined />,\n    onClick: () => {\n      store.authors.push(\"【记谱者】  记谱\");\n    },\n  },\n];\nconst handleSelectMenu = wrappedAction((index, value) => {\n  const menu = authorContextMenu.find((m) => m.key === value);\n  menu?.onClick(index);\n});\nconst handleSelectBlockMenu = wrappedAction((value) => {\n  const menu = blockContextMenu.find((m) => m.key === value);\n  menu?.onClick();\n});\nconst handleChangeAuthor = wrappedAction((index, value) => {\n  if (!value) {\n    return new Promise((resolve) => {\n      Modal.confirm({\n        title: \"删除这条作者信息？\",\n        okText: \"确定\",\n        cancelText: \"取消\",\n        onOk: () => {\n          resolve(true);\n          store.authors.splice(index, 1);\n        },\n        onCancel: () => {\n          resolve(true);\n        },\n      });\n    });\n  }\n  store.authors[index] = value;\n});\n\nfunction RightInfoBlock() {\n  return (\n    <Row\n      type=\"authors\"\n      offsetX={store.canvasWidth - store.marginHorizontal}\n      offsetY={P.titleOffsetY}\n    >\n      <EditableContent\n        inputType=\"select\"\n        options={blockContextMenu}\n        popoverProps={{ trigger: \"context\" }}\n        onChange={handleSelectBlockMenu}\n      >\n        <rect\n          x={store.marginHorizontal - 150}\n          y=\"-64\"\n          width={150}\n          height={150}\n          fill={store.authors.length ? \"none\" : \"transparent\"}\n          // className={Styles.hotCorner}\n        ></rect>\n      </EditableContent>\n      {store.authors.map((author, i) => (\n        <EditableContent\n          key={i + author}\n          inputType=\"select\"\n          options={authorContextMenu}\n          popoverProps={{ trigger: \"context\" }}\n          onChange={handleSelectMenu.bind(null, i)}\n        >\n          <EditableContent\n            title=\"作者信息：\"\n            initialValue={author}\n            onChange={handleChangeAuthor.bind(null, i)}\n          >\n            <Text editable y={i * 22} textAnchor=\"end\">\n              {author}\n            </Text>\n          </EditableContent>\n        </EditableContent>\n      ))}\n    </Row>\n  );\n}\n\nexport default observer(RightInfoBlock);\n","import { observer } from \"mobx-react-lite\";\nimport { useRef } from \"react\";\nimport EditableContent from \"../../../component/EditableContent\";\nimport store from \"../../../store/global\";\nimport { wrappedAction } from \"../../../store/history\";\nimport Row from \"../../Row\";\nimport Text from \"../../Text\";\nconst handleChangeTitle = wrappedAction((value) => {\n  store.title = value;\n});\n\nfunction Title() {\n  const ref = useRef();\n  return (\n    <Row type=\"title\" offsetY={store.marginTop}>\n      <EditableContent\n        ref={ref}\n        title=\"歌曲名称：\"\n        initialValue={store.title}\n        onChange={handleChangeTitle}\n      >\n        <Text\n          editable\n          x=\"50%\"\n          fontSize=\"32\"\n          fill=\"currentColor\"\n          stroke=\"none\"\n          textAnchor=\"middle\"\n        >\n          {store.title}\n        </Text>\n      </EditableContent>\n    </Row>\n  );\n}\n\nexport default observer(Title);\n","import React from \"react\";\nimport LeftInfoBlock from \"./LeftInfoBlock\";\nimport RightInfoBlock from \"./RightInfoBlock\";\nimport Title from \"./Title\";\n\nfunction Header() {\n  return (\n    <>\n      <Title></Title>\n      <LeftInfoBlock></LeftInfoBlock>\n      <RightInfoBlock></RightInfoBlock>\n    </>\n  );\n}\n\nexport default React.memo(Header);\n","import { Button, Modal } from \"antd\";\nimport { useCallback } from \"react\";\nimport Styles from \"./index.module.css\";\n\nfunction KeyboardDescItem({ kbd, desc }) {\n  return (\n    <li className={Styles.listItem}>\n      <kbd className={Styles.kbd}>{kbd}</kbd>\n      <span>{desc}</span>\n    </li>\n  );\n}\n\nfunction HelpModal({ visible, onVisibleChange }) {\n  const handleClose = useCallback(() => {\n    onVisibleChange?.call(null, false);\n  }, [onVisibleChange]);\n\n  return (\n    <Modal\n      width=\"100%\"\n      height=\"90%\"\n      style={{ top: \"4%\" }}\n      visible={visible}\n      title=\"帮助\"\n      onCancel={handleClose}\n      footer={\n        <Button key=\"close\" type=\"primary\" onClick={handleClose}>\n          确定\n        </Button>\n      }\n    >\n      <h2>快捷键</h2>\n      <h3>全局</h3>\n      <ul className={Styles.list}>\n        <KeyboardDescItem kbd=\"？\" desc=\"显示此帮助\" />\n        <KeyboardDescItem kbd=\"Ctrl+Z\" desc=\"撤销\" />\n        <KeyboardDescItem kbd=\"Ctrl+Shift+Z\" desc=\"重做\" />\n        <KeyboardDescItem kbd=\"Ctrl+O\" desc=\"打开文件\" />\n        <KeyboardDescItem kbd=\"h j k l\" desc=\"移动焦点\" />\n      </ul>\n      <h3>仅选中符号时</h3>\n      <h4>输入</h4>\n      <ul className={Styles.list}>\n        <KeyboardDescItem kbd=\"0~7, -\" desc=\"输入音符\" />\n        <KeyboardDescItem kbd=\"|\" desc=\"输入小节线\" />\n        <KeyboardDescItem kbd=\".\" desc=\"输入附点\" />\n        <KeyboardDescItem kbd=\"~\" desc=\"颤音符号\" />\n        <KeyboardDescItem kbd=\"u / U\" desc=\"增减时线\" />\n        <KeyboardDescItem kbd=\"8 / *\" desc=\"八度圆点\" />\n        <KeyboardDescItem kbd=\"# / b\" desc=\"音符升/降\" />\n      </ul>\n      <h4>操作</h4>\n      <ul className={Styles.list}>\n        <KeyboardDescItem kbd=\"Enter\" desc=\"移动到下一个音符\" />\n        <KeyboardDescItem kbd=\"Shift+Enter\" desc=\"移动到上一个音符\" />\n        <KeyboardDescItem kbd=\"Ctrl+Enter\" desc=\"在当前位置后插入音符\" />\n        <KeyboardDescItem kbd=\"Delete\" desc=\"删除当前音符\" />\n        <KeyboardDescItem kbd=\"Shift+Delete\" desc=\"删除当前段落\" />\n        <KeyboardDescItem kbd=\"=\" desc=\"段落是否两端对齐\" />\n        <KeyboardDescItem kbd=\"h j k l\" desc=\"Vi风格移动焦点\" />\n        <KeyboardDescItem kbd=\"Ctrl+C\" desc=\"复制当前音符\" />\n        <KeyboardDescItem kbd=\"Ctrl+Shift+C\" desc=\"复制当前段落\" />\n        <KeyboardDescItem kbd=\"Ctrl+V\" desc=\"粘贴\" />\n      </ul>\n      <h2>提示</h2>\n      <ul className={Styles.list}>\n        <li>段落上可以右键单击弹出操作菜单</li>\n        <li>增减时线默认连续，可在音符右键菜单中选择打断</li>\n      </ul>\n    </Modal>\n  );\n}\n\nexport default HelpModal;\n","import { DeleteOutlined, EnterOutlined } from \"@ant-design/icons\";\nimport { Menu } from \"antd\";\nimport store from \"../store/global\";\nimport { createNotation, notations } from \"../util/notation\";\nimport { createParagraph } from \"../util/paragraph\";\nimport { wrappedAction } from \"../store/history\";\n\nfunction getParagraphMenuOptions(paragraph) {\n  const handleMenu = wrappedAction(({ key }) => {\n    switch (key) {\n      case \"add\": {\n        const idx = store.paragraphs.findIndex((p) => p.key === paragraph.key);\n        const para = createParagraph({\n          notations: [\n            createNotation({ note: \"0\" }),\n            createNotation({ note: \"0\" }),\n            createNotation({ note: \"0\" }),\n            createNotation({ note: \"0\" }),\n            createNotation({ note: notations.separator }),\n          ],\n        });\n        if (idx !== -1) {\n          store.paragraphs.splice(idx + 1, 0, para);\n        } else {\n          store.paragraphs.push(para);\n        }\n        break;\n      }\n      case \"delete\":\n        const idx = store.paragraphs.findIndex((p) => p.key === paragraph.key);\n        if (idx !== -1) {\n          store.paragraphs.splice(idx, 1);\n        }\n        break;\n      default:\n        break;\n    }\n  });\n\n  return (\n    <Menu onClick={handleMenu}>\n      <Menu.Item key=\"add\" icon={<EnterOutlined />}>\n        添加段落\n      </Menu.Item>\n      <Menu.Item danger key=\"delete\" icon={<DeleteOutlined />}>\n        删除段落\n      </Menu.Item>\n    </Menu>\n  );\n}\n\nexport { getParagraphMenuOptions };\n","import {\n  DeleteOutlined,\n  RadiusSettingOutlined,\n  StopOutlined,\n} from \"@ant-design/icons\";\nimport { Menu } from \"antd\";\nimport state from \"../store/state\";\nimport { findParagraphAndNotation } from \"../util/editor\";\nimport { isNote } from \"../util/notation\";\nimport { runInWrappedAction, wrappedAction } from \"../store/history\";\n\nconst getNotationContextMenu = (notation, paragraph) => {\n  const hasTie = notation.tieTo;\n  const handleMenu = wrappedAction(function ({ key }) {\n    switch (true) {\n      case key === \"tie\": {\n        if (!hasTie) {\n          state.tieSourceKey = notation.key;\n          return;\n        }\n        const { notation: tieDesc } = findParagraphAndNotation(notation.tieTo);\n        if (tieDesc) {\n          tieDesc.tieTo = null;\n        }\n        notation.tieTo = null;\n        break;\n      }\n      case key === \"break-underline\":\n        notation.breakUnderline = !notation.breakUnderline;\n        break;\n      case key.startsWith(\"separator-\"): {\n        const separator = key.split(\"-\", 2)[1];\n        notation.note = separator;\n        break;\n      }\n      default:\n        break;\n    }\n  });\n\n  return (\n    // ENHANCE: 分音符类型显示菜单项\n    <Menu onClick={handleMenu} style={{ minWidth: \"80px\" }}>\n      {isNote(notation) && (\n        <Menu.Item key=\"break-underline\" icon={<StopOutlined />}>\n          {notation.breakUnderline\n            ? \"在此处延续增减时线\"\n            : \"在此处打断增减时线\"}\n        </Menu.Item>\n      )}\n      {isNote(notation) && (\n        <Menu.Item\n          key=\"tie\"\n          icon={<RadiusSettingOutlined />}\n          notation={notation}\n        >\n          {notation.tieTo ? \"删除连音线\" : \"从此处添加连音线到...\"}\n        </Menu.Item>\n      )}\n      <Menu.Item key=\"delete\" icon={<DeleteOutlined />}>\n        删除符号\n      </Menu.Item>\n    </Menu>\n  );\n};\n\n// ENHANCE: 使用EditableContent组件的overlay属性传入菜单\n// 执行选项回调。。\nfunction handleNotationContext(options, key) {\n  runInWrappedAction(() => (state.shouldNotationBlurAfterClick = false));\n  const callback = options.find((ops) => ops.key === key)?.onClick;\n  callback && callback();\n}\n\nexport { getNotationContextMenu, handleNotationContext };\n","import { message } from \"antd\";\nimport { observer } from \"mobx-react-lite\";\nimport EditableContent from \"../../component/EditableContent\";\nimport state from \"../../store/state\";\nimport store from \"../../store/global\";\nimport P, { calcSubTextWidth } from \"../../util/placement\";\nimport { findParagraphAndNotation } from \"../../util/editor\";\nimport { getNotationContextMenu } from \"../../menu/notation\";\nimport { isNote, notations } from \"../../util/notation\";\nimport { wrappedAction } from \"../../store/history\";\nimport Row from \"../Row\";\nimport Text from \"../Text\";\nimport Styles from \"./index.module.css\";\n\nfunction composeArray(octave) {\n  const len = Math.abs(Number(octave));\n  if (!Number.isInteger(len)) {\n    return [];\n  }\n  return Array(len).fill(0, 0, len);\n}\n\nfunction Notation({ offsetX, notation, paragraph }) {\n  const handleClick = wrappedAction(() => {\n    state.selectedNotationKey = notation.key;\n    state.shouldNotationBlurAfterClick = false;\n    if (state.tieSourceKey) {\n      // 处理连音线\n      if (state.tieSourceKey === notation.key) {\n        state.tieSourceKey = null;\n        // NOTICE: 如果要添加其他逻辑注意这里的return\n        return;\n      }\n      const {\n        notation: sourceNotation,\n        paragraph: sourceParagraph,\n      } = findParagraphAndNotation(state.tieSourceKey);\n      if (!sourceNotation) {\n        state.tieSourceKey = null;\n        return;\n      }\n      if (!sourceParagraph.notations.includes(notation)) {\n        message.warn(\"只允许相同段落的音符相连！\");\n      } else if (!isNote(notation)) {\n        message.warn(\"只允许在音符上添加连音线！\");\n      } else {\n        sourceNotation.tieTo = notation.key;\n        notation.tieTo = sourceNotation.key;\n      }\n      state.tieSourceKey = null;\n    }\n  });\n\n  const underlineOffset = P.underlineStepOffsetY * (notation.underline | 0);\n  const octaveInitialOffset =\n    notation.octave > 0\n      ? -P.octaveInitialOffsetAbove\n      : P.octaveInitialOffsetBelow + underlineOffset;\n  const octaveStepOffset = (notation.octave > 0 ? -1 : 1) * P.octaveStepOffsetY;\n  let topDecoratorOffset = 0;\n  if (notation.octave > 0) {\n    // 如果有高八度圆点，将顶部装饰符渲染到其上方\n    topDecoratorOffset = octaveStepOffset * Math.abs(notation.octave);\n  }\n\n  const renderPrefixSups = () => {\n    const sups = notation.prefixSups || [];\n    const rendered = sups.map((s, i) => (\n      <Text\n        key={i + s}\n        dominantBaseline=\"middle\"\n        textAnchor=\"middle\"\n        fontSize={store.defaultSubFontSize}\n        x={-P.xWidth - (calcSubTextWidth(sups.slice(0, i).join(\"\")) + 2 * i)}\n        y={-P.subXHeight / 2 + 2}\n      >\n        {s}\n      </Text>\n    ));\n    return rendered;\n  };\n\n  const renderTopDecorators = () => {\n    const decs = notation.topDecorators || [];\n    const rendered = decs.map((d, i) => (\n      <Text\n        key={i + d}\n        dominantBaseline=\"middle\"\n        textAnchor=\"middle\"\n        fontSize={store.defaultSubFontSize}\n        y={topDecoratorOffset - (i + 1) * P.subXHeight + 2}\n      >\n        {d}\n      </Text>\n    ));\n    return rendered;\n  };\n\n  const renderNote = () => {\n    let transform;\n    if (notation.note === notations.extend) {\n      // 延音符太长了缩短一点\n      transform = \"scale(0.8, 1)\";\n    }\n    return (\n      <Text dominantBaseline=\"middle\" textAnchor=\"middle\" transform={transform}>\n        {notation.note}\n      </Text>\n    );\n  };\n\n  const renderOctave = () => {\n    return composeArray(notation.octave).map((oc, i) => (\n      <circle\n        key={i}\n        type=\"octave\"\n        cx=\"0\"\n        cy={octaveInitialOffset + octaveStepOffset * i}\n        fill=\"currentColor\"\n        r=\"2\"\n      ></circle>\n    ));\n  };\n  return (\n    <EditableContent\n      inputType=\"select\"\n      popoverProps={{ trigger: \"context\" }}\n      overlay={getNotationContextMenu(notation, paragraph)}\n    >\n      <Row\n        editable\n        type=\"notation\"\n        offsetX={offsetX}\n        onClick={handleClick}\n        className={\n          state.selectedNotationKey === notation.key\n            ? Styles.selectedNotation\n            : \"\"\n        }\n      >\n        {renderPrefixSups()}\n        {renderTopDecorators()}\n        {renderNote()}\n        {notation.dotted && (\n          <circle\n            type=\"dot\"\n            cx={P.xWidth + 4}\n            cy=\"-2\"\n            r=\"2\"\n            fill=\"currentColor\"\n          ></circle>\n        )}\n        {renderOctave()}\n      </Row>\n    </EditableContent>\n  );\n}\n\nNotation.defaultProps = {\n  offsetX: 0,\n  offsetY: 0,\n};\n\nexport default observer(Notation);\n","import { observer } from \"mobx-react-lite\";\nimport EditableContent from \"../../component/EditableContent\";\nimport P, {\n  calcNotationAboveOffset,\n  calcNotationPrefixOffset,\n  calcNotationWidth,\n  calcParagraphAboveOffset,\n  calcParagraphContentHeight,\n  calcParagraphWidth,\n} from \"../../util/placement\";\nimport { getParagraphMenuOptions } from \"../../menu/paragraph\";\nimport Notation from \"../Notation\";\nimport Row from \"../Row\";\n\nfunction Paragraph({ paragraph, offsetY, alignJustify }) {\n  const notations = paragraph.notations || [];\n  const widthCache = [];\n  let itemFlexOffset = 0;\n  if (alignJustify && paragraph.notations?.length > 1) {\n    const realWidth = calcParagraphWidth(paragraph);\n    itemFlexOffset =\n      (P.maxContentWidth - realWidth) / (paragraph.notations.length - 1);\n  }\n\n  // 计算前n个音符的宽度\n  const accumulate = (index) => {\n    let width = 0;\n    for (let i = 0; i < index; i++) {\n      const n = notations[i];\n      widthCache[i] = widthCache[i] || calcNotationWidth(n);\n      width += widthCache[i];\n    }\n    // 音符的定位基准是其中心，因此要加上当前音符的前缀部分偏移\n    width += calcNotationPrefixOffset(notations[index]);\n    return width;\n  };\n\n  // 缓存音符偏移量\n  const noteOffsets = notations.map((_, i) => {\n    return (\n      // 渲染音符时坐标为其中心，故偏移半个音符宽\n      P.xWidth / 2 +\n      // 偏移前面音符的宽度\n      accumulate(i) +\n      // 两端对齐时自动偏移\n      itemFlexOffset * i\n    );\n  });\n\n  // 绘制音符的增减时线\n  const renderUnderLine = (offsetY, fromIndex, toIndex) => {\n    return (\n      <line\n        key={`${fromIndex}_${toIndex}_${offsetY}`}\n        x1={noteOffsets[fromIndex] - P.xWidth}\n        x2={noteOffsets[toIndex] + P.xWidth}\n        y1={offsetY}\n        y2={offsetY}\n        stroke=\"currentColor\"\n      ></line>\n    );\n  };\n  const renderUnderlines = () => {\n    const lines = [];\n    // 记录音符当前需要绘制的增减时线的条数\n    let helpMap = notations.map((n) => (n.underline > 0 ? n.underline : 0));\n    let baseOffsetY = P.underlineInitialOffsetY;\n    while (helpMap.some((n) => n > 0)) {\n      let fromIndex = -1;\n      let toIndex = fromIndex;\n      for (let i = 0; i < notations.length; ++i) {\n        const n = notations[i];\n        if (helpMap[i] > 0) {\n          // 当前音符需要添加增减时线\n          if (fromIndex >= 0) {\n            // 其前面的音符也需要添加增减时线\n            if (n.breakUnderline) {\n              // 当前音符禁止和前面的增减时线连续，绘制前面的增减时线\n              lines.push(renderUnderLine(baseOffsetY, fromIndex, toIndex));\n              // 记录当前音符位置等待绘制\n              fromIndex = toIndex = i;\n            } else {\n              // 当前音符可能和下一个音符的增减时线连续，本次循环不绘制\n              toIndex = i;\n            }\n          } else {\n            fromIndex = toIndex = i;\n          }\n          if (i === notations.length - 1) {\n            // 已是最后一个音符，直接绘制增减时线\n            lines.push(renderUnderLine(baseOffsetY, fromIndex, toIndex));\n            fromIndex = toIndex = -1;\n          }\n          --helpMap[i];\n        } else {\n          // 当前音符不需要绘制增减时线\n          if (fromIndex >= 0) {\n            lines.push(renderUnderLine(baseOffsetY, fromIndex, toIndex));\n            fromIndex = toIndex = -1;\n          }\n        }\n      }\n      baseOffsetY += P.underlineStepOffsetY;\n    }\n    return lines;\n  };\n\n  // 渲染连音线\n  const renderTie = (offsetY, fromIndex, toIndex) => {\n    const bezierX1 = noteOffsets[fromIndex];\n    const bezierX2 = bezierX1 + 4;\n    const bezierX4 = noteOffsets[toIndex];\n    const bezierX3 = bezierX4 - 4;\n    const x = bezierX4 - bezierX1;\n    // ENHANCE: 优化贝赛尔曲线\n    let y =\n      0.000021917145491103032 * x * x * x -\n      0.0062948773732605465 * x * x +\n      0.6378785891964498 * x -\n      0.6843414475200537;\n    y = Math.max(Math.min(y, P.maxTieBezierOffset), P.minTieHeight);\n    const bezierY = offsetY - y;\n    return (\n      <path\n        key={`${fromIndex}_${toIndex}_${offsetY}`}\n        d={`M${bezierX1} ${offsetY} C${bezierX2} ${bezierY} ${bezierX3} ${bezierY} ${bezierX4} ${offsetY}`}\n        stroke=\"currentColor\"\n        fill=\"none\"\n      ></path>\n    );\n  };\n  const renderTies = () => {\n    const ties = [];\n    const offsetMap = new Map();\n    for (let i = 0; i < notations.length; ++i) {\n      const n = notations[i];\n      if (n.tieTo) {\n        const toIndex = notations.findIndex((nn) => nn.key === n.tieTo);\n        if (toIndex <= i) {\n          // tieTo属性应该是双向的，仅遍历到第一个节点时渲染\n          continue;\n        }\n        let minOffsetY = 0;\n        for (let j = i; j <= toIndex; ++j) {\n          let offset;\n          if (offsetMap.has(notations[j].key)) {\n            offset = offsetMap.get(notations[j].key);\n          } else {\n            offset = -calcNotationAboveOffset(notations[j]);\n            offsetMap.set(notations[j].key, offset);\n          }\n          minOffsetY = Math.min(minOffsetY, offset);\n        }\n        ties.push(renderTie(minOffsetY, i, toIndex));\n      }\n    }\n    return ties;\n  };\n\n  const renderParagraphMask = () => {\n    const height = calcParagraphContentHeight(paragraph);\n    return (\n      <EditableContent\n        inputType=\"select\"\n        overlay={getParagraphMenuOptions(paragraph)}\n      >\n        <rect\n          x={-P.xWidth / 2}\n          y={-calcParagraphAboveOffset(paragraph)}\n          width={P.maxContentWidth}\n          height={height}\n          fill=\"transparent\"\n        ></rect>\n      </EditableContent>\n    );\n  };\n\n  return (\n    <Row type=\"paragraph\" offsetY={offsetY}>\n      {renderParagraphMask()}\n      {renderTies()}\n      {paragraph.notations.map((n, i) => (\n        <Notation\n          key={n.key}\n          notation={n}\n          paragraph={paragraph}\n          offsetX={noteOffsets[i]}\n        />\n      ))}\n      {renderUnderlines()}\n    </Row>\n  );\n}\n\nexport default observer(Paragraph);\n","import { Button, Dropdown } from \"antd\";\nimport {\n  EditOutlined,\n  FileTextOutlined,\n  QuestionOutlined,\n  RetweetOutlined,\n  SettingOutlined,\n} from \"@ant-design/icons\";\nimport { observer } from \"mobx-react-lite\";\nimport { useEffect } from \"react\";\nimport state from \"../../store/state\";\nimport store from \"../../store/global\";\nimport P, {\n  calcParagraphAboveOffset,\n  calcParagraphHeight,\n} from \"../../util/placement\";\nimport {\n  convertMenu,\n  editMenu,\n  fileMenu,\n  handleClick,\n  handleKeyPress,\n} from \"../../menu/editor\";\nimport { unwrappedAction } from \"../../store/history\";\nimport Canvas from \"../Canvas\";\nimport ConfigModal from \"../ConfigModal\";\nimport Header from \"../Header\";\nimport HelpModal from \"../HelpModal\";\nimport Paragraph from \"../Paragraph\";\nimport Row from \"../Row\";\nimport Styles from \"./index.module.css\";\n\nfunction Editor() {\n  const heightCache = [];\n  function accumulate(index) {\n    const paragraphs = store.paragraphs || [];\n    let height = 0;\n    for (let i = 0; i < index; i++) {\n      const p = paragraphs[i];\n      heightCache[i] = heightCache[i] || calcParagraphHeight(p);\n      height += heightCache[i];\n    }\n    // 段落渲染定位基于段落中心，因此加上上半部分的偏移量\n    height += calcParagraphAboveOffset(paragraphs[index]);\n    return height;\n  }\n  const handleChangeConfigModalVisibility = unwrappedAction((visible) => {\n    state.configDialogVisible = visible;\n  });\n  const handleChangeHelpModalVisibility = unwrappedAction((visible) => {\n    state.helpDialogVisible = visible;\n  });\n  const handleShowConfigDialog = () => {\n    handleChangeConfigModalVisibility(true);\n  };\n  const handleShowHelpDialog = () => {\n    handleChangeHelpModalVisibility(true);\n  };\n  useEffect(() => {\n    document.addEventListener(\"keydown\", handleKeyPress);\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyPress);\n    };\n  }, []);\n\n  return (\n    <div\n      className={Styles.container}\n      style={{ width: store.canvasWidth + \"px\" }}\n    >\n      <div className={Styles.headerWrapper}>\n        <div\n          className={Styles.header}\n          style={{ width: store.canvasWidth + \"px\" }}\n        >\n          <Dropdown overlay={fileMenu} placement=\"bottomLeft\">\n            <Button icon={<FileTextOutlined />} type=\"text\">\n              文件\n            </Button>\n          </Dropdown>\n          <Dropdown overlay={editMenu} placement=\"bottomLeft\">\n            <Button icon={<EditOutlined />} type=\"text\">\n              编辑\n            </Button>\n          </Dropdown>\n          <Dropdown overlay={convertMenu} placement=\"bottomLeft\">\n            <Button icon={<RetweetOutlined />} type=\"text\">\n              转调\n            </Button>\n          </Dropdown>\n          <Button\n            icon={<SettingOutlined />}\n            type=\"text\"\n            onClick={handleShowConfigDialog}\n          >\n            配置\n          </Button>\n          <Button\n            icon={<QuestionOutlined />}\n            type=\"text\"\n            onClick={handleShowHelpDialog}\n          >\n            帮助\n          </Button>\n        </div>\n      </div>\n      <Canvas onClick={handleClick}>\n        <Header />\n        <Row offsetX={store.marginHorizontal} offsetY={P.headerOffsetY}>\n          {store.paragraphs.map((p, i) => {\n            let alignJustify = p.alignJustify;\n            if (typeof alignJustify !== \"boolean\") {\n              alignJustify = !(i === store.paragraphs.length - 1);\n            }\n            return (\n              <Paragraph\n                key={p.key}\n                paragraph={p}\n                offsetY={accumulate(i)}\n                alignJustify={alignJustify}\n              />\n            );\n          })}\n        </Row>\n      </Canvas>\n      <ConfigModal\n        visible={state.configDialogVisible}\n        onVisibleChange={handleChangeConfigModalVisibility}\n      ></ConfigModal>\n      <HelpModal\n        visible={state.helpDialogVisible}\n        onVisibleChange={handleChangeHelpModalVisibility}\n      ></HelpModal>\n    </div>\n  );\n}\n\nexport default observer(Editor);\n","import { resetGlobalData } from \"./editor\";\n\nasync function loadExample() {\n  const regex = /(\\?|&)loadExample(&|$)/;\n  if (regex.test(window.location.search)) {\n    const data = await import(\"../example/烟雨.json\");\n    resetGlobalData(data.default);\n  }\n}\n\nexport { loadExample };\n","import { useEffect } from \"react\";\nimport Editor from \"./view/Editor\";\nimport globalStore, { GlobalContext } from \"./store/global\";\nimport { loadExample } from \"./util/load-example\";\n\n// ENHANCE: 替换掉antd组件库。。一堆莫名其妙的毛病\nfunction App() {\n  useEffect(() => {\n    loadExample();\n  }, []);\n  return (\n    <GlobalContext.Provider value={globalStore}>\n      <Editor></Editor>\n    </GlobalContext.Provider>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"antd/dist/antd.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport \"./index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"HelpModal_list__syZn2\",\"listItem\":\"HelpModal_listItem__34m_q\",\"kbd\":\"HelpModal_kbd__RCRud\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"popover\":\"PopoverOnSvg_popover__3bN4H\",\"arrow\":\"PopoverOnSvg_arrow__22-aj\",\"content\":\"PopoverOnSvg_content__1rAgR\",\"header\":\"PopoverOnSvg_header__URzxW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"buttonGroup\":\"EditableContent_buttonGroup__2qXGn\",\"button\":\"EditableContent_button__6qyvP\",\"menu\":\"EditableContent_menu__2ah_9\",\"menuItem\":\"EditableContent_menuItem__3P1Eu\"};"],"sourceRoot":""}